import{_ as u,r as p,o as k,c as r,a as n,b as s,d as a,w as t,e as o}from"./app-C8q1F3U4.js";const d="/blog/assets/19-DjudAkp7.png",m="/blog/assets/20-C9nmsGvS.png",v="/blog/assets/21-C7h4pZcj.png",b="/blog/assets/22-jTVPEuhQ.png",h="/blog/assets/clientCnnfig-Dw3hu83V.png",y={},g=o('<h1 id="nettyå…¥é—¨" tabindex="-1"><a class="header-anchor" href="#nettyå…¥é—¨"><span>Nettyå…¥é—¨</span></a></h1><h2 id="ä¸€ã€æ¦‚è¿°" tabindex="-1"><a class="header-anchor" href="#ä¸€ã€æ¦‚è¿°"><span>ä¸€ã€æ¦‚è¿°</span></a></h2><h3 id="_1ã€netty-æ˜¯ä»€ä¹ˆ" tabindex="-1"><a class="header-anchor" href="#_1ã€netty-æ˜¯ä»€ä¹ˆ"><span>1ã€Netty æ˜¯ä»€ä¹ˆï¼Ÿ</span></a></h3><blockquote><p>Netty is an asynchronous event-driven network application framework for rapid development of maintainable high performance protocol servers &amp; clients.</p></blockquote><p>Netty æ˜¯ä¸€ä¸ª<strong>å¼‚æ­¥</strong>çš„ã€<strong>åŸºäºäº‹ä»¶é©±åŠ¨</strong>çš„<strong>ç½‘ç»œåº”ç”¨æ¡†æ¶</strong>ï¼Œç”¨äºå¿«é€Ÿå¼€å‘å¯ç»´æŠ¤ã€é«˜æ€§èƒ½çš„ç½‘ç»œæœåŠ¡å™¨å’Œå®¢æˆ·ç«¯ã€‚</p><blockquote><p>åº•å±‚åŸºäº NIO ï¼Œæ‰€ä»¥ Netty è¿è¡Œåœ¨ JVM ä¸Šã€‚</p></blockquote><h3 id="_2ã€netty-çš„ä½œè€…" tabindex="-1"><a class="header-anchor" href="#_2ã€netty-çš„ä½œè€…"><span>2ã€Netty çš„ä½œè€…</span></a></h3><p><img src="'+d+'" alt=""></p>',8),f={href:"https://mina.apache.org/mina-project/quick-start-guide.html",target:"_blank",rel:"noopener noreferrer"},w=o(`<h3 id="_3ã€netty-çš„åœ°ä½" tabindex="-1"><a class="header-anchor" href="#_3ã€netty-çš„åœ°ä½"><span>3ã€Netty çš„åœ°ä½</span></a></h3><p>Netty åœ¨ Java ç½‘ç»œåº”ç”¨æ¡†æ¶ä¸­çš„åœ°ä½å°±å¥½æ¯”ï¼šSpring æ¡†æ¶åœ¨ JavaEE å¼€å‘ä¸­çš„åœ°ä½</p><p>ä»¥ä¸‹çš„æ¡†æ¶éƒ½ä½¿ç”¨äº† Nettyï¼Œå› ä¸ºå®ƒä»¬æœ‰ç½‘ç»œé€šä¿¡éœ€æ±‚ï¼</p><ul><li>Cassandra - nosql æ•°æ®åº“</li><li>Spark - å¤§æ•°æ®åˆ†å¸ƒå¼è®¡ç®—æ¡†æ¶</li><li>Hadoop - å¤§æ•°æ®åˆ†å¸ƒå¼å­˜å‚¨æ¡†æ¶</li><li>RocketMQ - ali å¼€æºçš„æ¶ˆæ¯é˜Ÿåˆ—</li><li>ElasticSearch - æœç´¢å¼•æ“</li><li>gRPC - rpc æ¡†æ¶</li><li>Dubbo - rpc æ¡†æ¶</li><li>Spring 5.x - flux api å®Œå…¨æŠ›å¼ƒäº† tomcat ï¼Œä½¿ç”¨ netty ä½œä¸ºæœåŠ¡å™¨ç«¯</li><li>Zookeeper - åˆ†å¸ƒå¼åè°ƒæ¡†æ¶</li></ul><h3 id="_4ã€netty-çš„ä¼˜åŠ¿" tabindex="-1"><a class="header-anchor" href="#_4ã€netty-çš„ä¼˜åŠ¿"><span>4ã€Netty çš„ä¼˜åŠ¿</span></a></h3><ul><li>Netty vs NIOï¼Œå·¥ä½œé‡å¤§ï¼Œbug å¤š <ul><li>éœ€è¦è‡ªå·±æ„å»ºåè®®</li><li>è§£å†³ TCP ä¼ è¾“é—®é¢˜ï¼Œå¦‚ç²˜åŒ…ã€åŠåŒ…</li><li>epoll ç©ºè½®è¯¢å¯¼è‡´ CPU 100%</li><li>å¯¹ API è¿›è¡Œå¢å¼ºï¼Œä½¿ä¹‹æ›´æ˜“ç”¨ï¼Œå¦‚ FastThreadLocal =&gt; ThreadLocalï¼ŒByteBuf =&gt; ByteBuffer</li></ul></li><li>Netty vs å…¶å®ƒç½‘ç»œåº”ç”¨æ¡†æ¶ <ul><li>Mina ç”± apache ç»´æŠ¤ï¼Œå°†æ¥ 3.x ç‰ˆæœ¬å¯èƒ½ä¼šæœ‰è¾ƒå¤§é‡æ„ï¼Œç ´å API å‘ä¸‹å…¼å®¹æ€§ï¼ŒNetty çš„å¼€å‘è¿­ä»£æ›´è¿…é€Ÿï¼ŒAPI æ›´ç®€æ´ã€æ–‡æ¡£æ›´ä¼˜ç§€</li><li>ä¹…ç»è€ƒéªŒï¼Œ16å¹´ï¼ŒNetty ç‰ˆæœ¬ <ul><li>2.x 2004</li><li>3.x 2008</li><li>4.x 2013</li><li>5.x å·²åºŸå¼ƒï¼ˆæ²¡æœ‰æ˜æ˜¾çš„æ€§èƒ½æå‡ï¼Œç»´æŠ¤æˆæœ¬é«˜ï¼‰</li></ul></li></ul></li></ul><h2 id="äºŒã€å¿«é€Ÿå…¥é—¨" tabindex="-1"><a class="header-anchor" href="#äºŒã€å¿«é€Ÿå…¥é—¨"><span>äºŒã€å¿«é€Ÿå…¥é—¨</span></a></h2><h3 id="_1ã€ç›®æ ‡" tabindex="-1"><a class="header-anchor" href="#_1ã€ç›®æ ‡"><span>1ã€ç›®æ ‡</span></a></h3><p>å¼€å‘ä¸€ä¸ªç®€å•çš„æœåŠ¡å™¨ç«¯å’Œå®¢æˆ·ç«¯</p><ul><li>å®¢æˆ·ç«¯å‘æœåŠ¡å™¨ç«¯å‘é€ hello, world</li><li>æœåŠ¡å™¨ä»…æ¥æ”¶ï¼Œä¸è¿”å›</li></ul><p>åŠ å…¥ä¾èµ–</p><div class="language-xml line-numbers-mode" data-ext="xml" data-title="xml"><pre class="language-xml"><code>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>io.netty<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>netty-all<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>4.1.59.Final<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2ã€æœåŠ¡å™¨ç«¯" tabindex="-1"><a class="header-anchor" href="#_2ã€æœåŠ¡å™¨ç«¯"><span>2ã€æœåŠ¡å™¨ç«¯</span></a></h3><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>bootstrap<span class="token punctuation">.</span></span><span class="token class-name">ServerBootstrap</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span></span><span class="token class-name">ChannelHandlerContext</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span></span><span class="token class-name">ChannelInboundHandlerAdapter</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span></span><span class="token class-name">ChannelInitializer</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span>nio<span class="token punctuation">.</span></span><span class="token class-name">NioEventLoopGroup</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span>socket<span class="token punctuation">.</span>nio<span class="token punctuation">.</span></span><span class="token class-name">NioServerSocketChannel</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span>socket<span class="token punctuation">.</span>nio<span class="token punctuation">.</span></span><span class="token class-name">NioSocketChannel</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>handler<span class="token punctuation">.</span>codec<span class="token punctuation">.</span>string<span class="token punctuation">.</span></span><span class="token class-name">StringDecoder</span></span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
 * nettyæœåŠ¡ç«¯
 *
 * <span class="token keyword">@author</span> kingsley
 * <span class="token keyword">@date</span> 2024/4/7 21:41
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HelloServer</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 1ã€å¯åŠ¨å™¨ï¼Œè´Ÿè´£ç»„è£…nettyç»„ä»¶ï¼Œå¯åŠ¨æœåŠ¡å™¨</span>
        <span class="token keyword">new</span> <span class="token class-name">ServerBootstrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token comment">/*
                 * 2ã€åˆ›å»º NioEventLoopGroupï¼Œå¯ä»¥ç®€å•ç†è§£ä¸º BossEventLoop å’Œ WorkerEventLoop(selector, thread)
                 * NioEventLoopGroup åŒ…å« BossEventLoop å’Œ WorkerEventLoopï¼Œå¯ç®€å•ç†è§£ä¸ºNIOåŸºç¡€ä¸­å­¦åˆ°çš„ Boss å’Œ Worker
                 * WorkerEventLoopä¸­æœ‰æœ€é‡è¦çš„ä¸¤éƒ¨åˆ†ï¼šselectorï¼Œçº¿ç¨‹ã€‚
                 *  - selectorï¼šç”¨äºç›‘å¬å®¢æˆ·ç«¯è¿æ¥ã€å¤„ç†ç½‘ç»œäº‹ä»¶ï¼ˆå¯è¯»ã€å¯å†™ï¼‰ï¼›
                 *  - threadï¼šå¤„ç†å…·ä½“çš„ç½‘ç»œäº‹ä»¶ï¼Œå……åˆ†åˆ©ç”¨CPU
                 */</span>
                <span class="token punctuation">.</span><span class="token function">group</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">NioEventLoopGroup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token comment">/*
                 * 3ã€é€‰æ‹©æœåŠ¡å™¨çš„ServerSocketChannelå®ç°
                 *  - NioServerSocketChannelï¼šNIO
                 *  - OioServerSocketChannelï¼šBIO
                 * åœ¨å¯åŠ¨æ—¶ä¼šåå°„è°ƒç”¨NioServerSocketChannelçš„æ„é€ æ–¹æ³•ï¼Œåˆ›å»ºå¯¹è±¡
                 */</span>
                <span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token class-name">NioServerSocketChannel</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
                <span class="token comment">/*
                 * 4ã€bossè´Ÿè´£å¤„ç†è¿æ¥ï¼Œworkerï¼ˆchildï¼‰è´Ÿè´£å¤„ç†è¯»å†™ï¼Œå†³å®šäº†workerèƒ½æ‰§è¡Œå“ªäº›æ“ä½œï¼ˆhandlerï¼‰
                 */</span>
                <span class="token punctuation">.</span><span class="token function">childHandler</span><span class="token punctuation">(</span>
                        <span class="token comment">/*
                         * 5ã€æ·»åŠ å’Œå®¢æˆ·ç«¯è¿›è¡Œæ•°æ®è¯»å†™çš„é€šé“çš„åˆå§‹åŒ–å™¨ï¼Œå®ƒæœ¬èº«æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„handlerï¼Œå®ƒçš„ä½œç”¨æ˜¯ç®¡ç†ä¸€ç³»åˆ—çš„handlerï¼Œå¯ä»¥ç†è§£ä¸ºæ‹¦æˆªå™¨
                         * è¯¥æ–¹æ³•ä¸ä¼šç«‹å³æ‰§è¡Œåˆå§‹åŒ–æ“ä½œï¼Œè€Œæ˜¯ç­‰å¾…è¿æ¥å»ºç«‹åæ‰ä¼šæ‰§è¡Œåˆå§‹åŒ–
                         */</span>
                        <span class="token keyword">new</span> <span class="token class-name">ChannelInitializer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">NioSocketChannel</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                            <span class="token annotation punctuation">@Override</span>
                            <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">initChannel</span><span class="token punctuation">(</span><span class="token class-name">NioSocketChannel</span> ch<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                                <span class="token comment">/*
                                 * 6ã€æ·»åŠ å…·ä½“çš„handler
                                 *  - StringDecoderï¼šå°†æ¥æ”¶åˆ°çš„ByteBufè½¬æ¢ä¸ºå­—ç¬¦ä¸²
                                 *  - ChannelInboundHandlerAdapterï¼šè‡ªå®šä¹‰handler
                                 */</span>
                                ch<span class="token punctuation">.</span><span class="token function">pipeline</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">StringDecoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                                ch<span class="token punctuation">.</span><span class="token function">pipeline</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ChannelInboundHandlerAdapter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                                    <span class="token comment">/*
                                     * 7ã€channelReadå¤„ç†è¯»äº‹ä»¶
                                     */</span>
                                    <span class="token annotation punctuation">@Override</span>
                                    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">channelRead</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">,</span> <span class="token class-name">Object</span> msg<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                                        <span class="token comment">/*
                                         * 8ã€æ¥æ”¶åˆ°æ¶ˆæ¯å¹¶å¤„ç†ï¼Œè¿™é‡Œæ‰“å°ä¸Šä¸€æ­¥è½¬æ¢å¥½çš„å­—ç¬¦ä¸²
                                         */</span>
                                        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;æ”¶åˆ°çš„æ¶ˆæ¯ï¼š&quot;</span> <span class="token operator">+</span> msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
                                    <span class="token punctuation">}</span>
                                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                            <span class="token punctuation">}</span>
                        <span class="token punctuation">}</span><span class="token punctuation">)</span>
                <span class="token comment">/*
                 * 9ã€ç»‘å®šç›‘å¬ç«¯å£å¹¶å¯åŠ¨æœåŠ¡å™¨
                 */</span>
                <span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token number">8080</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="ä»£ç è§£è¯»" tabindex="-1"><a class="header-anchor" href="#ä»£ç è§£è¯»"><span>ä»£ç è§£è¯»</span></a></h4><ul><li>2å¤„ï¼Œåˆ›å»º NioEventLoopGroupï¼Œå¯ä»¥ç®€å•ç†è§£ä¸º çº¿ç¨‹æ±  + Selector åé¢ä¼šè¯¦ç»†å±•å¼€</li><li>3å¤„ï¼Œé€‰æ‹©æœåŠ¡ Scoket å®ç°ç±»ï¼Œå…¶ä¸­ NioServerSocketChannel è¡¨ç¤ºåŸºäº NIO çš„æœåŠ¡å™¨ç«¯å®ç°ï¼Œå…¶å®ƒå®ç°è¿˜æœ‰ <img src="`+m+`" alt="img.png"></li><li>4å¤„ï¼Œä¸ºå•¥æ–¹æ³•å« childHandlerï¼Œæ˜¯æ¥ä¸‹æ¥æ·»åŠ çš„å¤„ç†å™¨éƒ½æ˜¯ç»™ SocketChannel ç”¨çš„ï¼Œè€Œä¸æ˜¯ç»™ ServerSocketChannelã€‚ChannelInitializer å¤„ç†å™¨ï¼ˆä»…æ‰§è¡Œä¸€æ¬¡ï¼‰ï¼Œå®ƒçš„ä½œç”¨æ˜¯å¾…å®¢æˆ·ç«¯ SocketChannel å»ºç«‹è¿æ¥åï¼Œæ‰§è¡Œ initChannel ä»¥ä¾¿æ·»åŠ æ›´å¤šçš„å¤„ç†å™¨</li><li>6å¤„ï¼ŒSocketChannel çš„å¤„ç†å™¨ï¼Œè§£ç  ByteBuf =&gt; String</li><li>7å¤„ï¼ŒSocketChannel çš„ä¸šåŠ¡å¤„ç†å™¨ï¼Œä½¿ç”¨ä¸Šä¸€ä¸ªå¤„ç†å™¨çš„å¤„ç†ç»“æœ</li></ul><h3 id="_3ã€å®¢æˆ·ç«¯" tabindex="-1"><a class="header-anchor" href="#_3ã€å®¢æˆ·ç«¯"><span>3ã€å®¢æˆ·ç«¯</span></a></h3><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>bootstrap<span class="token punctuation">.</span></span><span class="token class-name">Bootstrap</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span></span><span class="token class-name">ChannelInitializer</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span>nio<span class="token punctuation">.</span></span><span class="token class-name">NioEventLoopGroup</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span>socket<span class="token punctuation">.</span>nio<span class="token punctuation">.</span></span><span class="token class-name">NioSocketChannel</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>handler<span class="token punctuation">.</span>codec<span class="token punctuation">.</span>string<span class="token punctuation">.</span></span><span class="token class-name">StringEncoder</span></span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
 * nettyå®¢æˆ·ç«¯
 * <span class="token keyword">@author</span> kingsley
 * <span class="token keyword">@date</span> 2024/4/7 22:02
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HelloClient</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
        <span class="token comment">// 1ã€åˆ›å»ºå®¢æˆ·ç«¯å¯åŠ¨å¯¹è±¡</span>
        <span class="token keyword">new</span> <span class="token class-name">Bootstrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token comment">// 2ã€æ·»åŠ EventLoop</span>
                <span class="token punctuation">.</span><span class="token function">group</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">NioEventLoopGroup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token comment">// 3ã€é€‰æ‹©å®¢æˆ·ç«¯channelå®ç°ç±»</span>
                <span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token class-name">NioSocketChannel</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
                <span class="token comment">// 4ã€æ·»åŠ å¤„ç†å™¨</span>
                <span class="token punctuation">.</span><span class="token function">handler</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ChannelInitializer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">NioSocketChannel</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token comment">// åˆå§‹åŒ–channelï¼Œåœ¨è¿æ¥æˆåŠŸä¹‹åè°ƒç”¨</span>
                    <span class="token annotation punctuation">@Override</span>
                    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">initChannel</span><span class="token punctuation">(</span><span class="token class-name">NioSocketChannel</span> ch<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token comment">// 5ã€å¾€pipelineé“¾ä¸­æ·»åŠ ä¸€ä¸ªhandlerå¤„ç†å™¨ï¼Œè¿™é‡Œä½¿ç”¨ StringEncoder å°†å­—ç¬¦ä¸²ç¼–ç æˆ ByteBuf</span>
                        ch<span class="token punctuation">.</span><span class="token function">pipeline</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">StringEncoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span>
                <span class="token comment">// 6ã€å¯åŠ¨å®¢æˆ·ç«¯è¿æ¥æœåŠ¡å™¨ï¼Œç­‰å¾…è¿æ¥æˆåŠŸ</span>
                <span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token string">&quot;127.0.0.1&quot;</span><span class="token punctuation">,</span> <span class="token number">8080</span><span class="token punctuation">)</span>
                <span class="token comment">// 7ã€é˜»å¡æ–¹æ³•ï¼Œç­‰å¾…è¿æ¥æˆåŠŸ</span>
                <span class="token punctuation">.</span><span class="token function">sync</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token comment">// 8ã€ä»£è¡¨è¿æ¥å¯¹è±¡ï¼Œå¯ä»¥ç†è§£ä¸ºé€šé“ï¼Œé€šè¿‡è¯¥å¯¹è±¡å¯ä»¥å‘é€æ¶ˆæ¯ç»™æœåŠ¡å™¨</span>
                <span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token comment">// 9ã€å‘æœåŠ¡å™¨å‘é€æ•°æ®</span>
                <span class="token punctuation">.</span><span class="token function">writeAndFlush</span><span class="token punctuation">(</span><span class="token string">&quot;hello, netty&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="ä»£ç è§£è¯»-1" tabindex="-1"><a class="header-anchor" href="#ä»£ç è§£è¯»-1"><span>ä»£ç è§£è¯»</span></a></h4><ul><li>2å¤„ï¼Œåˆ›å»º NioEventLoopGroupï¼ŒåŒ Server</li><li>3å¤„ï¼Œé€‰æ‹©å®¢æˆ·ç«¯ Socket å®ç°ç±»ï¼ŒNioSocketChannel è¡¨ç¤ºåŸºäº NIO çš„å®¢æˆ·ç«¯å®ç°ï¼Œå…¶å®ƒå®ç°è¿˜æœ‰ <img src="`+v+'" alt="img.png"></li><li>4å¤„ï¼Œæ·»åŠ  SocketChannel çš„å¤„ç†å™¨ï¼ŒChannelInitializer å¤„ç†å™¨ï¼ˆä»…æ‰§è¡Œä¸€æ¬¡ï¼‰ï¼Œå®ƒçš„ä½œç”¨æ˜¯å¾…å®¢æˆ·ç«¯ SocketChannel å»ºç«‹è¿æ¥åï¼Œæ‰§è¡Œ initChannel ä»¥ä¾¿æ·»åŠ æ›´å¤šçš„å¤„ç†å™¨</li><li>5å¤„ï¼Œæ¶ˆæ¯ä¼šç»è¿‡é€šé“ handler å¤„ç†ï¼Œè¿™é‡Œæ˜¯å°† String =&gt; ByteBuf å‘å‡º</li><li>6å¤„ï¼Œå¯åŠ¨å®¢æˆ·ç«¯è¿æ¥æœåŠ¡å™¨ï¼Œç­‰å¾…è¿æ¥æˆåŠŸ</li><li>7å¤„ï¼ŒNetty ä¸­å¾ˆå¤šæ–¹æ³•éƒ½æ˜¯å¼‚æ­¥çš„ï¼Œå¦‚ connectï¼Œè¿™æ—¶éœ€è¦ä½¿ç”¨ sync æ–¹æ³•ç­‰å¾… connect å»ºç«‹è¿æ¥å®Œæ¯•</li><li>8å¤„ï¼Œè·å– channel å¯¹è±¡ï¼Œå®ƒå³ä¸ºé€šé“æŠ½è±¡ï¼Œå¯ä»¥è¿›è¡Œæ•°æ®è¯»å†™æ“ä½œ</li><li>9å¤„ï¼Œå†™å…¥æ¶ˆæ¯å¹¶æ¸…ç©ºç¼“å†²åŒº</li></ul><h3 id="_4ã€æµç¨‹æ¢³ç†" tabindex="-1"><a class="header-anchor" href="#_4ã€æµç¨‹æ¢³ç†"><span>4ã€æµç¨‹æ¢³ç†</span></a></h3><p><img src="'+b+`" alt="img.png"></p><p>ğŸ’¡ æç¤º</p><blockquote><p><strong>ä¸€å¼€å§‹éœ€è¦æ ‘ç«‹æ­£ç¡®çš„è§‚å¿µ</strong></p><ul><li>æŠŠ channel ç†è§£ä¸ºæ•°æ®çš„é€šé“</li><li>æŠŠ msg ç†è§£ä¸ºæµåŠ¨çš„æ•°æ®ï¼Œæœ€å¼€å§‹è¾“å…¥æ˜¯ ByteBufï¼Œä½†ç»è¿‡ pipeline çš„åŠ å·¥ï¼Œä¼šå˜æˆå…¶å®ƒç±»å‹å¯¹è±¡ï¼Œæœ€åè¾“å‡ºåˆå˜æˆ ByteBuf</li><li>æŠŠ handler ç†è§£ä¸ºæ•°æ®çš„å¤„ç†å·¥åº</li></ul></blockquote><ul><li>å·¥åºæœ‰å¤šé“ï¼Œåˆåœ¨ä¸€èµ·å°±æ˜¯ pipelineï¼Œpipeline è´Ÿè´£å‘å¸ƒäº‹ä»¶ï¼ˆè¯»ã€è¯»å–å®Œæˆ...ï¼‰ä¼ æ’­ç»™æ¯ä¸ª handlerï¼Œ handler å¯¹è‡ªå·±æ„Ÿå…´è¶£çš„äº‹ä»¶è¿›è¡Œå¤„ç†ï¼ˆé‡å†™äº†ç›¸åº”äº‹ä»¶å¤„ç†æ–¹æ³•ï¼‰</li></ul><blockquote><ul><li>handler åˆ† Inbound å’Œ Outbound ä¸¤ç±»</li><li>æŠŠ eventLoop ç†è§£ä¸ºå¤„ç†æ•°æ®çš„å·¥äºº</li></ul></blockquote><ul><li>å·¥äººå¯ä»¥ç®¡ç†å¤šä¸ª channel çš„ IO æ“ä½œï¼Œå¹¶ä¸”ä¸€æ—¦å·¥äººè´Ÿè´£äº†æŸä¸ª channelï¼Œå°±è¦è´Ÿè´£åˆ°åº•ï¼ˆç»‘å®šï¼‰ï¼Œç›®çš„æ˜¯ä¸ºäº†çº¿ç¨‹å®‰å…¨ã€‚ <blockquote><p>æ€»ç»“èµ·æ¥å°±è¯´æ˜¯ï¼š<strong>ä¸€ä¸ª eventLoop åªè´Ÿè´£ä¸€ä¸ª NioEventLoopGroup ä¸­çš„ä¸€ä¸ªçº¿ç¨‹ï¼Œè¿™ä¸ªçº¿ç¨‹å¯ä»¥ç®¡ç†å¤šä¸ª channelï¼Œä½†ä¸€ä¸ª channel åªèƒ½ç”±ä¸€ä¸ª eventLoop ç®¡ç†</strong></p></blockquote></li></ul><blockquote><ul><li>å·¥äººæ—¢å¯ä»¥æ‰§è¡Œ IO æ“ä½œï¼Œä¹Ÿå¯ä»¥è¿›è¡Œä»»åŠ¡å¤„ç†ï¼Œæ¯ä½å·¥äººæœ‰ä»»åŠ¡é˜Ÿåˆ—ï¼Œé˜Ÿåˆ—é‡Œå¯ä»¥å †æ”¾å¤šä¸ª channel çš„å¾…å¤„ç†ä»»åŠ¡ï¼Œä»»åŠ¡åˆ†ä¸ºæ™®é€šä»»åŠ¡ã€å®šæ—¶ä»»åŠ¡</li></ul></blockquote><ul><li>å·¥äººæŒ‰ç…§ pipeline é¡ºåºï¼Œä¾æ¬¡æŒ‰ç…§ handler çš„è§„åˆ’ï¼ˆä»£ç ï¼‰å¤„ç†æ•°æ®ï¼Œå¯ä»¥ä¸ºæ¯é“å·¥åºæŒ‡å®šä¸åŒçš„å·¥äºº</li></ul><h2 id="ä¸‰ã€ç»„ä»¶" tabindex="-1"><a class="header-anchor" href="#ä¸‰ã€ç»„ä»¶"><span>ä¸‰ã€ç»„ä»¶</span></a></h2><h3 id="_1ã€eventloop" tabindex="-1"><a class="header-anchor" href="#_1ã€eventloop"><span>1ã€EventLoop</span></a></h3><p>äº‹ä»¶å¾ªç¯å¯¹è±¡ï¼Œæœ¬è´¨æ˜¯ä¸€ä¸ªå•çº¿ç¨‹æ‰§è¡Œå™¨ï¼ˆåŒæ—¶ç»´æŠ¤äº†ä¸€ä¸ª Selectorï¼‰ï¼Œé‡Œé¢æœ‰ run æ–¹æ³•å¤„ç† Channel ä¸Šæºæºä¸æ–­çš„ IO äº‹ä»¶ã€‚</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">OrderedEventExecutor</span></span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
 * Will handle all the I/O operations for a <span class="token punctuation">{</span><span class="token keyword">@link</span> <span class="token reference"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span></span><span class="token class-name">Channel</span></span><span class="token punctuation">}</span> once registered.
 * One <span class="token punctuation">{</span><span class="token keyword">@link</span> <span class="token reference"><span class="token class-name">EventLoop</span></span><span class="token punctuation">}</span> instance will usually handle more than one <span class="token punctuation">{</span><span class="token keyword">@link</span> <span class="token reference"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span></span><span class="token class-name">Channel</span></span><span class="token punctuation">}</span> but this may depend on
 * implementation details and internals.
 *
 */</span>
<span class="token annotation punctuation">@SuppressWarnings</span><span class="token punctuation">(</span><span class="token string">&quot;all&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">EventLoop</span> <span class="token keyword">extends</span> <span class="token class-name">OrderedEventExecutor</span><span class="token punctuation">,</span> <span class="token class-name">EventLoopGroup</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token class-name">EventLoopGroup</span> <span class="token function">parent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å®ƒçš„ç»§æ‰¿å…³ç³»æ¯”è¾ƒå¤æ‚</p><ul><li>ä¸€æ¡çº¿æ˜¯ç»§æ‰¿è‡ª java.util.concurrent.ScheduledExecutorServiceï¼Œå› æ­¤åŒ…å«äº†çº¿ç¨‹æ± ä¸­æ‰€æœ‰çš„æ–¹æ³•</li><li>å¦ä¸€æ¡çº¿æ˜¯ç»§æ‰¿è‡ª netty è‡ªå·±çš„ OrderedEventExecutor <ul><li>æä¾›äº† boolean inEventLoop(Thread thread) æ–¹æ³•åˆ¤æ–­ä¸€ä¸ªçº¿ç¨‹æ˜¯å¦å±äºæ­¤ EventLoop</li><li>æä¾›äº† parent æ–¹æ³•æ¥çœ‹çœ‹è‡ªå·±å±äºå“ªä¸ª EventLoopGroup</li></ul></li></ul><h3 id="_2ã€eventloopgroup" tabindex="-1"><a class="header-anchor" href="#_2ã€eventloopgroup"><span>2ã€EventLoopGroup</span></a></h3><p>äº‹ä»¶å¾ªç¯ç»„ï¼Œæ˜¯ä¸€ç»„ EventLoopã€‚Channel ä¸€èˆ¬ä¼šè°ƒç”¨ EventLoopGroup çš„ register æ–¹æ³•æ¥ç»‘å®šå…¶ä¸­ä¸€ä¸ª EventLoopï¼Œåç»­è¿™ä¸ª Channel ä¸Šçš„ IO äº‹ä»¶éƒ½ç”±æ­¤ EventLoop æ¥å¤„ç†ï¼ˆä¿è¯äº† IO äº‹ä»¶å¤„ç†æ—¶çš„çº¿ç¨‹å®‰å…¨ï¼‰</p><ul><li>ç»§æ‰¿è‡ª netty è‡ªå·±çš„ EventExecutorGroup <ul><li>å®ç°äº† Iterable æ¥å£æä¾›éå† EventLoop çš„èƒ½åŠ›</li><li>å¦æœ‰ next æ–¹æ³•è·å–é›†åˆä¸­ä¸‹ä¸€ä¸ª EventLoop</li></ul></li></ul><p>ä»¥ä¸€ä¸ªç®€å•çš„å®ç°ä¸ºä¾‹ï¼š</p>`,39),C=n("div",{class:"language-java line-numbers-mode","data-ext":"java","data-title":"java"},[n("pre",{class:"language-java"},[n("code",null,[n("span",{class:"token keyword"},"package"),s(),n("span",{class:"token namespace"},[s("com"),n("span",{class:"token punctuation"},"."),s("kingsley"),n("span",{class:"token punctuation"},"."),s("netty"),n("span",{class:"token punctuation"},"."),s("c2")]),n("span",{class:"token punctuation"},";"),s(`

`),n("span",{class:"token keyword"},"import"),s(),n("span",{class:"token import"},[n("span",{class:"token namespace"},[s("io"),n("span",{class:"token punctuation"},"."),s("netty"),n("span",{class:"token punctuation"},"."),s("channel"),n("span",{class:"token punctuation"},".")]),n("span",{class:"token class-name"},"EventLoopGroup")]),n("span",{class:"token punctuation"},";"),s(`
`),n("span",{class:"token keyword"},"import"),s(),n("span",{class:"token import"},[n("span",{class:"token namespace"},[s("io"),n("span",{class:"token punctuation"},"."),s("netty"),n("span",{class:"token punctuation"},"."),s("channel"),n("span",{class:"token punctuation"},"."),s("nio"),n("span",{class:"token punctuation"},".")]),n("span",{class:"token class-name"},"NioEventLoopGroup")]),n("span",{class:"token punctuation"},";"),s(`
`),n("span",{class:"token keyword"},"import"),s(),n("span",{class:"token import"},[n("span",{class:"token namespace"},[s("io"),n("span",{class:"token punctuation"},"."),s("netty"),n("span",{class:"token punctuation"},"."),s("util"),n("span",{class:"token punctuation"},"."),s("concurrent"),n("span",{class:"token punctuation"},".")]),n("span",{class:"token class-name"},"EventExecutor")]),n("span",{class:"token punctuation"},";"),s(`
`),n("span",{class:"token keyword"},"import"),s(),n("span",{class:"token import"},[n("span",{class:"token namespace"},[s("lombok"),n("span",{class:"token punctuation"},"."),s("extern"),n("span",{class:"token punctuation"},"."),s("slf4j"),n("span",{class:"token punctuation"},".")]),n("span",{class:"token class-name"},"Slf4j")]),n("span",{class:"token punctuation"},";"),s(`

`),n("span",{class:"token keyword"},"import"),s(),n("span",{class:"token import"},[n("span",{class:"token namespace"},[s("java"),n("span",{class:"token punctuation"},"."),s("util"),n("span",{class:"token punctuation"},"."),s("concurrent"),n("span",{class:"token punctuation"},".")]),n("span",{class:"token class-name"},"TimeUnit")]),n("span",{class:"token punctuation"},";"),s(`

`),n("span",{class:"token doc-comment comment"},[s(`/**
 * EventLoopæµ‹è¯•
 *
 * `),n("span",{class:"token keyword"},"@author"),s(` kingsley
 * `),n("span",{class:"token keyword"},"@date"),s(` 2024/4/7 23:46
 */`)]),s(`
`),n("span",{class:"token annotation punctuation"},"@Slf4j"),s(`
`),n("span",{class:"token keyword"},"public"),s(),n("span",{class:"token keyword"},"class"),s(),n("span",{class:"token class-name"},"TestEventLoop"),s(),n("span",{class:"token punctuation"},"{"),s(`

    `),n("span",{class:"token keyword"},"public"),s(),n("span",{class:"token keyword"},"static"),s(),n("span",{class:"token keyword"},"void"),s(),n("span",{class:"token function"},"main"),n("span",{class:"token punctuation"},"("),n("span",{class:"token class-name"},"String"),n("span",{class:"token punctuation"},"["),n("span",{class:"token punctuation"},"]"),s(" args"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token keyword"},"throws"),s(),n("span",{class:"token class-name"},"InterruptedException"),s(),n("span",{class:"token punctuation"},"{"),s(`
        `),n("span",{class:"token comment"},`/*
         * 1ã€åˆ›å»ºäº‹ä»¶å¾ªç¯ç»„ï¼Œè¿™é‡Œè®¾ç½®2ä¸ªçº¿ç¨‹ï¼Œ2ä¸ªçº¿ç¨‹å°±æ˜¯2ä¸ªEventLoop
         * NioEventLoopGroupï¼šå¯å¤„ç†IOäº‹ä»¶ã€æ™®é€šä»»åŠ¡ã€å®šæ—¶ä»»åŠ¡
         * DefaultEventLoopGroupï¼šå¤„ç†æ™®é€šä»»åŠ¡ã€å®šæ—¶ä»»åŠ¡
         */`),s(`
        `),n("span",{class:"token class-name"},"EventLoopGroup"),s(" group "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token keyword"},"new"),s(),n("span",{class:"token class-name"},"NioEventLoopGroup"),n("span",{class:"token punctuation"},"("),n("span",{class:"token number"},"2"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
        `),n("span",{class:"token comment"},"// 2ã€è·å–ä¸‹ä¸€ä¸ªäº‹ä»¶å¾ªç¯å¯¹è±¡"),s(`
        log`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"info"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"EventLoop: {}"'),n("span",{class:"token punctuation"},","),s(" group"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"next"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
        log`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"info"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"EventLoop: {}"'),n("span",{class:"token punctuation"},","),s(" group"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"next"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
        log`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"info"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"EventLoop: {}"'),n("span",{class:"token punctuation"},","),s(" group"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"next"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
        log`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"info"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"---------"'),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
        `),n("span",{class:"token comment"},"// ä¹Ÿå¯ä»¥ä½¿ç”¨ for å¾ªç¯"),s(`
        `),n("span",{class:"token keyword"},"for"),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token class-name"},"EventExecutor"),s(" eventLoop "),n("span",{class:"token operator"},":"),s(" group"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
            log`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"info"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"EventLoop: {}"'),n("span",{class:"token punctuation"},","),s(" eventLoop"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
        `),n("span",{class:"token punctuation"},"}"),s(`

        `),n("span",{class:"token comment"},"// å¤„ç†æ™®é€šä»»åŠ¡"),s(`
        group`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"next"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"execute"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"->"),s(),n("span",{class:"token punctuation"},"{"),s(`
            `),n("span",{class:"token keyword"},"try"),s(),n("span",{class:"token punctuation"},"{"),s(`
                `),n("span",{class:"token class-name"},"Thread"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"sleep"),n("span",{class:"token punctuation"},"("),n("span",{class:"token number"},"1000"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
            `),n("span",{class:"token punctuation"},"}"),s(),n("span",{class:"token keyword"},"catch"),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token class-name"},"InterruptedException"),s(" e"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
                e`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"printStackTrace"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
            `),n("span",{class:"token punctuation"},"}"),s(`
            log`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"info"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"æ‰§è¡Œæ™®é€šä»»åŠ¡"'),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
        `),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`

        `),n("span",{class:"token comment"},"// å¤„ç†å®šæ—¶ä»»åŠ¡"),s(`
        group`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"next"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"schedule"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"->"),s(),n("span",{class:"token punctuation"},"{"),s(`
            log`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"info"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"æ‰§è¡Œå®šæ—¶ä»»åŠ¡1"'),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
        `),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token number"},"10"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token class-name"},"TimeUnit"),n("span",{class:"token punctuation"},"."),n("span",{class:"token constant"},"MILLISECONDS"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
        group`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"next"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"schedule"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"->"),s(),n("span",{class:"token punctuation"},"{"),s(`
            log`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"info"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"æ‰§è¡Œå®šæ—¶ä»»åŠ¡2"'),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
        `),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token number"},"10"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token class-name"},"TimeUnit"),n("span",{class:"token punctuation"},"."),n("span",{class:"token constant"},"MILLISECONDS"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`

        `),n("span",{class:"token comment"},"// é˜»å¡ä¸»çº¿ç¨‹"),s(`
        `),n("span",{class:"token class-name"},"TimeUnit"),n("span",{class:"token punctuation"},"."),n("span",{class:"token constant"},"MILLISECONDS"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"sleep"),n("span",{class:"token punctuation"},"("),n("span",{class:"token number"},"200"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`

        `),n("span",{class:"token comment"},"// 3ã€ä¼˜é›…çš„å…³é—­"),s(`
        group`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"shutdownGracefully"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`

        log`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"info"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"main"'),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token punctuation"},"}"),s(`

`),n("span",{class:"token punctuation"},"}"),s(`
`)])]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"})])],-1),E=n("div",{class:"language-bash line-numbers-mode","data-ext":"sh","data-title":"sh"},[n("pre",{class:"language-bash"},[n("code",null,[n("span",{class:"token number"},"2024"),s("-04-08 00:09:05.465 INFO  "),n("span",{class:"token punctuation"},"["),s("main"),n("span",{class:"token punctuation"},"]"),s(" com.kingsley.netty.c2.TestEventLoop               "),n("span",{class:"token builtin class-name"},":"),s(` EventLoop: io.netty.channel.nio.NioEventLoop@28feb3fa
`),n("span",{class:"token number"},"2024"),s("-04-08 00:09:05.465 INFO  "),n("span",{class:"token punctuation"},"["),s("main"),n("span",{class:"token punctuation"},"]"),s(" com.kingsley.netty.c2.TestEventLoop               "),n("span",{class:"token builtin class-name"},":"),s(` EventLoop: io.netty.channel.nio.NioEventLoop@675d3402
`),n("span",{class:"token number"},"2024"),s("-04-08 00:09:05.465 INFO  "),n("span",{class:"token punctuation"},"["),s("main"),n("span",{class:"token punctuation"},"]"),s(" com.kingsley.netty.c2.TestEventLoop               "),n("span",{class:"token builtin class-name"},":"),s(` EventLoop: io.netty.channel.nio.NioEventLoop@28feb3fa
`),n("span",{class:"token number"},"2024"),s("-04-08 00:09:05.465 INFO  "),n("span",{class:"token punctuation"},"["),s("main"),n("span",{class:"token punctuation"},"]"),s(" com.kingsley.netty.c2.TestEventLoop               "),n("span",{class:"token builtin class-name"},":"),s(` ---------
`),n("span",{class:"token number"},"2024"),s("-04-08 00:09:05.465 INFO  "),n("span",{class:"token punctuation"},"["),s("main"),n("span",{class:"token punctuation"},"]"),s(" com.kingsley.netty.c2.TestEventLoop               "),n("span",{class:"token builtin class-name"},":"),s(` EventLoop: io.netty.channel.nio.NioEventLoop@28feb3fa
`),n("span",{class:"token number"},"2024"),s("-04-08 00:09:05.465 INFO  "),n("span",{class:"token punctuation"},"["),s("main"),n("span",{class:"token punctuation"},"]"),s(" com.kingsley.netty.c2.TestEventLoop               "),n("span",{class:"token builtin class-name"},":"),s(` EventLoop: io.netty.channel.nio.NioEventLoop@675d3402
`),n("span",{class:"token number"},"2024"),s("-04-08 00:09:05.551 INFO  "),n("span",{class:"token punctuation"},"["),s("nioEventLoopGroup-2-2"),n("span",{class:"token punctuation"},"]"),s(" com.kingsley.netty.c2.TestEventLoop               "),n("span",{class:"token builtin class-name"},":"),s(` æ‰§è¡Œå®šæ—¶ä»»åŠ¡1
`),n("span",{class:"token number"},"2024"),s("-04-08 00:09:05.741 INFO  "),n("span",{class:"token punctuation"},"["),s("main"),n("span",{class:"token punctuation"},"]"),s(" com.kingsley.netty.c2.TestEventLoop               "),n("span",{class:"token builtin class-name"},":"),s(` main
`),n("span",{class:"token number"},"2024"),s("-04-08 00:09:06.545 INFO  "),n("span",{class:"token punctuation"},"["),s("nioEventLoopGroup-2-1"),n("span",{class:"token punctuation"},"]"),s(" com.kingsley.netty.c2.TestEventLoop               "),n("span",{class:"token builtin class-name"},":"),s(` æ‰§è¡Œæ™®é€šä»»åŠ¡
`),n("span",{class:"token number"},"2024"),s("-04-08 00:09:06.546 INFO  "),n("span",{class:"token punctuation"},"["),s("nioEventLoopGroup-2-1"),n("span",{class:"token punctuation"},"]"),s(" com.kingsley.netty.c2.TestEventLoop               "),n("span",{class:"token builtin class-name"},":"),s(` æ‰§è¡Œå®šæ—¶ä»»åŠ¡2
`)])]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"})])],-1),L=o('<h4 id="ğŸ’¡-ä¼˜é›…å…³é—­" tabindex="-1"><a class="header-anchor" href="#ğŸ’¡-ä¼˜é›…å…³é—­"><span>ğŸ’¡ ä¼˜é›…å…³é—­</span></a></h4><p>ä¼˜é›…å…³é—­ shutdownGracefully æ–¹æ³•ã€‚è¯¥æ–¹æ³•ä¼šé¦–å…ˆåˆ‡æ¢ EventLoopGroup åˆ°å…³é—­çŠ¶æ€ä»è€Œæ‹’ç»æ–°çš„ä»»åŠ¡çš„åŠ å…¥ï¼Œç„¶ååœ¨ä»»åŠ¡é˜Ÿåˆ—çš„ä»»åŠ¡éƒ½å¤„ç†å®Œæˆåï¼Œåœæ­¢çº¿ç¨‹çš„è¿è¡Œã€‚ä»è€Œç¡®ä¿æ•´ä½“åº”ç”¨æ˜¯åœ¨æ­£å¸¸æœ‰åºçš„çŠ¶æ€ä¸‹é€€å‡ºçš„</p><h4 id="nioeventloop-å¤„ç†-io-äº‹ä»¶" tabindex="-1"><a class="header-anchor" href="#nioeventloop-å¤„ç†-io-äº‹ä»¶"><span>NioEventLoop å¤„ç† io äº‹ä»¶</span></a></h4><p>æœåŠ¡å™¨ç«¯ä¸¤ä¸ª nio worker å·¥äººï¼Œé…ç½®å››ä¸ªå®¢æˆ·ç«¯ï¼Œé€šè¿‡å‘½ä»¤è¡Œå‚æ•°è®¾ç½®å®¢æˆ·ç«¯IDï¼Œç„¶åå¿«é€Ÿä¾æ¬¡å¯åŠ¨</p><p><img src="'+h+'" alt="img.png"><img src="https://cdn.jsdelivr.net/gh/taozhang1029/static-repository@master/img/202404172353544.png" alt=""></p>',5),S=n("div",{class:"language-java line-numbers-mode","data-ext":"java","data-title":"java"},[n("pre",{class:"language-java"},[n("code",null,[n("span",{class:"token keyword"},"package"),s(),n("span",{class:"token namespace"},[s("com"),n("span",{class:"token punctuation"},"."),s("kingsley"),n("span",{class:"token punctuation"},"."),s("netty"),n("span",{class:"token punctuation"},"."),s("c3")]),n("span",{class:"token punctuation"},";"),s(`

`),n("span",{class:"token keyword"},"import"),s(),n("span",{class:"token import"},[n("span",{class:"token namespace"},[s("io"),n("span",{class:"token punctuation"},"."),s("netty"),n("span",{class:"token punctuation"},"."),s("bootstrap"),n("span",{class:"token punctuation"},".")]),n("span",{class:"token class-name"},"ServerBootstrap")]),n("span",{class:"token punctuation"},";"),s(`
`),n("span",{class:"token keyword"},"import"),s(),n("span",{class:"token import"},[n("span",{class:"token namespace"},[s("io"),n("span",{class:"token punctuation"},"."),s("netty"),n("span",{class:"token punctuation"},"."),s("buffer"),n("span",{class:"token punctuation"},".")]),n("span",{class:"token class-name"},"ByteBuf")]),n("span",{class:"token punctuation"},";"),s(`
`),n("span",{class:"token keyword"},"import"),s(),n("span",{class:"token import"},[n("span",{class:"token namespace"},[s("io"),n("span",{class:"token punctuation"},"."),s("netty"),n("span",{class:"token punctuation"},"."),s("channel"),n("span",{class:"token punctuation"},".")]),n("span",{class:"token class-name"},"ChannelHandlerContext")]),n("span",{class:"token punctuation"},";"),s(`
`),n("span",{class:"token keyword"},"import"),s(),n("span",{class:"token import"},[n("span",{class:"token namespace"},[s("io"),n("span",{class:"token punctuation"},"."),s("netty"),n("span",{class:"token punctuation"},"."),s("channel"),n("span",{class:"token punctuation"},".")]),n("span",{class:"token class-name"},"ChannelInboundHandlerAdapter")]),n("span",{class:"token punctuation"},";"),s(`
`),n("span",{class:"token keyword"},"import"),s(),n("span",{class:"token import"},[n("span",{class:"token namespace"},[s("io"),n("span",{class:"token punctuation"},"."),s("netty"),n("span",{class:"token punctuation"},"."),s("channel"),n("span",{class:"token punctuation"},".")]),n("span",{class:"token class-name"},"ChannelInitializer")]),n("span",{class:"token punctuation"},";"),s(`
`),n("span",{class:"token keyword"},"import"),s(),n("span",{class:"token import"},[n("span",{class:"token namespace"},[s("io"),n("span",{class:"token punctuation"},"."),s("netty"),n("span",{class:"token punctuation"},"."),s("channel"),n("span",{class:"token punctuation"},"."),s("nio"),n("span",{class:"token punctuation"},".")]),n("span",{class:"token class-name"},"NioEventLoopGroup")]),n("span",{class:"token punctuation"},";"),s(`
`),n("span",{class:"token keyword"},"import"),s(),n("span",{class:"token import"},[n("span",{class:"token namespace"},[s("io"),n("span",{class:"token punctuation"},"."),s("netty"),n("span",{class:"token punctuation"},"."),s("channel"),n("span",{class:"token punctuation"},"."),s("socket"),n("span",{class:"token punctuation"},"."),s("nio"),n("span",{class:"token punctuation"},".")]),n("span",{class:"token class-name"},"NioServerSocketChannel")]),n("span",{class:"token punctuation"},";"),s(`
`),n("span",{class:"token keyword"},"import"),s(),n("span",{class:"token import"},[n("span",{class:"token namespace"},[s("io"),n("span",{class:"token punctuation"},"."),s("netty"),n("span",{class:"token punctuation"},"."),s("channel"),n("span",{class:"token punctuation"},"."),s("socket"),n("span",{class:"token punctuation"},"."),s("nio"),n("span",{class:"token punctuation"},".")]),n("span",{class:"token class-name"},"NioSocketChannel")]),n("span",{class:"token punctuation"},";"),s(`
`),n("span",{class:"token keyword"},"import"),s(),n("span",{class:"token import"},[n("span",{class:"token namespace"},[s("lombok"),n("span",{class:"token punctuation"},"."),s("extern"),n("span",{class:"token punctuation"},"."),s("slf4j"),n("span",{class:"token punctuation"},".")]),n("span",{class:"token class-name"},"Slf4j")]),n("span",{class:"token punctuation"},";"),s(`

`),n("span",{class:"token keyword"},"import"),s(),n("span",{class:"token import"},[n("span",{class:"token namespace"},[s("java"),n("span",{class:"token punctuation"},"."),s("nio"),n("span",{class:"token punctuation"},"."),s("charset"),n("span",{class:"token punctuation"},".")]),n("span",{class:"token class-name"},"Charset")]),n("span",{class:"token punctuation"},";"),s(`

`),n("span",{class:"token doc-comment comment"},[s(`/**
 * `),n("span",{class:"token keyword"},"@author"),s(` kingsley
 * `),n("span",{class:"token keyword"},"@date"),s(` 2024/4/17 22:43
 */`)]),s(`
`),n("span",{class:"token annotation punctuation"},"@Slf4j"),s(`
`),n("span",{class:"token keyword"},"public"),s(),n("span",{class:"token keyword"},"class"),s(),n("span",{class:"token class-name"},"EventLoopServer"),s(),n("span",{class:"token punctuation"},"{"),s(`

    `),n("span",{class:"token doc-comment comment"},`/**
     * ä¸»ç¨‹åºå…¥å£ã€‚
     * ä½¿ç”¨ServerBootstrapå¯åŠ¨ä¸€ä¸ªæœåŠ¡å™¨ï¼Œé…ç½®ä½¿ç”¨NIOä¼ è¾“ï¼Œç»‘å®šåˆ°8080ç«¯å£ã€‚
     * å¯¹æ¯ä¸ªæ–°è¿æ¥ï¼Œä½¿ç”¨ChannelInitializeråˆå§‹åŒ–Channelï¼ŒåŠ å…¥è‡ªå®šä¹‰çš„ChannelInboundHandlerAdapterä»¥å¤„ç†å…¥ç«™äº‹ä»¶ã€‚
     */`),s(`
    `),n("span",{class:"token keyword"},"public"),s(),n("span",{class:"token keyword"},"static"),s(),n("span",{class:"token keyword"},"void"),s(),n("span",{class:"token function"},"main"),n("span",{class:"token punctuation"},"("),n("span",{class:"token class-name"},"String"),n("span",{class:"token punctuation"},"["),n("span",{class:"token punctuation"},"]"),s(" args"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
        `),n("span",{class:"token keyword"},"new"),s(),n("span",{class:"token class-name"},"ServerBootstrap"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token comment"},"// åˆ›å»ºServerBootstrapå®ä¾‹ï¼Œç”¨äºå¯åŠ¨æœåŠ¡å™¨"),s(`
                `),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"group"),n("span",{class:"token punctuation"},"("),n("span",{class:"token keyword"},"new"),s(),n("span",{class:"token class-name"},"NioEventLoopGroup"),n("span",{class:"token punctuation"},"("),n("span",{class:"token number"},"1"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token keyword"},"new"),s(),n("span",{class:"token class-name"},"NioEventLoopGroup"),n("span",{class:"token punctuation"},"("),n("span",{class:"token number"},"2"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token comment"},"// æŒ‡å®šä½¿ç”¨NIOäº‹ä»¶å¾ªç¯ç»„"),s(`
                `),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"channel"),n("span",{class:"token punctuation"},"("),n("span",{class:"token class-name"},"NioServerSocketChannel"),n("span",{class:"token punctuation"},"."),n("span",{class:"token keyword"},"class"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token comment"},"// æŒ‡å®šä½¿ç”¨NIOæœåŠ¡å™¨å¥—æ¥å­—é€šé“"),s(`
                `),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"childHandler"),n("span",{class:"token punctuation"},"("),n("span",{class:"token keyword"},"new"),s(),n("span",{class:"token class-name"},"ChannelInitializer"),n("span",{class:"token generics"},[n("span",{class:"token punctuation"},"<"),n("span",{class:"token class-name"},"NioSocketChannel"),n("span",{class:"token punctuation"},">")]),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(),n("span",{class:"token comment"},"// å®šä¹‰å­é€šé“ï¼ˆå³æ¯ä¸ªæ–°è¿æ¥ï¼‰çš„åˆå§‹åŒ–å¤„ç†å™¨"),s(`
                    `),n("span",{class:"token annotation punctuation"},"@Override"),s(`
                    `),n("span",{class:"token keyword"},"protected"),s(),n("span",{class:"token keyword"},"void"),s(),n("span",{class:"token function"},"initChannel"),n("span",{class:"token punctuation"},"("),n("span",{class:"token class-name"},"NioSocketChannel"),s(" ch"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token keyword"},"throws"),s(),n("span",{class:"token class-name"},"Exception"),s(),n("span",{class:"token punctuation"},"{"),s(`
                        ch`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"pipeline"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"addLast"),n("span",{class:"token punctuation"},"("),n("span",{class:"token keyword"},"new"),s(),n("span",{class:"token class-name"},"ChannelInboundHandlerAdapter"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(),n("span",{class:"token comment"},"// å‘é€šé“å¤„ç†é“¾ä¸­æ·»åŠ è‡ªå®šä¹‰çš„å…¥ç«™äº‹ä»¶å¤„ç†å™¨"),s(`
                            `),n("span",{class:"token annotation punctuation"},"@Override"),s(`
                            `),n("span",{class:"token keyword"},"public"),s(),n("span",{class:"token keyword"},"void"),s(),n("span",{class:"token function"},"channelRead"),n("span",{class:"token punctuation"},"("),n("span",{class:"token class-name"},"ChannelHandlerContext"),s(" ctx"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token class-name"},"Object"),s(" msg"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(),n("span",{class:"token comment"},"// å½“æœ‰æ•°æ®è¯»å–æ—¶"),s(`
                                `),n("span",{class:"token class-name"},"ByteBuf"),s(" buf "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token class-name"},"ByteBuf"),n("span",{class:"token punctuation"},")"),s(" msg"),n("span",{class:"token punctuation"},";"),s(),n("span",{class:"token comment"},"// å°†æ¥æ”¶åˆ°çš„æ¶ˆæ¯è½¬æ¢ä¸ºByteBufç±»å‹"),s(`
                                log`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"info"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"receive: {}"'),n("span",{class:"token punctuation"},","),s(" buf"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"toString"),n("span",{class:"token punctuation"},"("),n("span",{class:"token class-name"},"Charset"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"defaultCharset"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(),n("span",{class:"token comment"},"// æ‰“å°æ¥æ”¶åˆ°çš„æ•°æ®"),s(`
                            `),n("span",{class:"token punctuation"},"}"),s(`
                        `),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
                    `),n("span",{class:"token punctuation"},"}"),s(`
                `),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"bind"),n("span",{class:"token punctuation"},"("),n("span",{class:"token number"},"8080"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(),n("span",{class:"token comment"},"// ç»‘å®šåˆ°8080ç«¯å£å¹¶å¯åŠ¨æœåŠ¡å™¨"),s(`
    `),n("span",{class:"token punctuation"},"}"),s(`

`),n("span",{class:"token punctuation"},"}"),s(`
`)])]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"})])],-1),N=n("div",{class:"language-java line-numbers-mode","data-ext":"java","data-title":"java"},[n("pre",{class:"language-java"},[n("code",null,[n("span",{class:"token keyword"},"package"),s(),n("span",{class:"token namespace"},[s("com"),n("span",{class:"token punctuation"},"."),s("kingsley"),n("span",{class:"token punctuation"},"."),s("netty"),n("span",{class:"token punctuation"},"."),s("c3")]),n("span",{class:"token punctuation"},";"),s(`

`),n("span",{class:"token keyword"},"import"),s(),n("span",{class:"token import"},[n("span",{class:"token namespace"},[s("io"),n("span",{class:"token punctuation"},"."),s("netty"),n("span",{class:"token punctuation"},"."),s("bootstrap"),n("span",{class:"token punctuation"},".")]),n("span",{class:"token class-name"},"Bootstrap")]),n("span",{class:"token punctuation"},";"),s(`
`),n("span",{class:"token keyword"},"import"),s(),n("span",{class:"token import"},[n("span",{class:"token namespace"},[s("io"),n("span",{class:"token punctuation"},"."),s("netty"),n("span",{class:"token punctuation"},"."),s("channel"),n("span",{class:"token punctuation"},".")]),n("span",{class:"token class-name"},"Channel")]),n("span",{class:"token punctuation"},";"),s(`
`),n("span",{class:"token keyword"},"import"),s(),n("span",{class:"token import"},[n("span",{class:"token namespace"},[s("io"),n("span",{class:"token punctuation"},"."),s("netty"),n("span",{class:"token punctuation"},"."),s("channel"),n("span",{class:"token punctuation"},".")]),n("span",{class:"token class-name"},"ChannelInitializer")]),n("span",{class:"token punctuation"},";"),s(`
`),n("span",{class:"token keyword"},"import"),s(),n("span",{class:"token import"},[n("span",{class:"token namespace"},[s("io"),n("span",{class:"token punctuation"},"."),s("netty"),n("span",{class:"token punctuation"},"."),s("channel"),n("span",{class:"token punctuation"},"."),s("nio"),n("span",{class:"token punctuation"},".")]),n("span",{class:"token class-name"},"NioEventLoopGroup")]),n("span",{class:"token punctuation"},";"),s(`
`),n("span",{class:"token keyword"},"import"),s(),n("span",{class:"token import"},[n("span",{class:"token namespace"},[s("io"),n("span",{class:"token punctuation"},"."),s("netty"),n("span",{class:"token punctuation"},"."),s("channel"),n("span",{class:"token punctuation"},"."),s("socket"),n("span",{class:"token punctuation"},"."),s("nio"),n("span",{class:"token punctuation"},".")]),n("span",{class:"token class-name"},"NioSocketChannel")]),n("span",{class:"token punctuation"},";"),s(`
`),n("span",{class:"token keyword"},"import"),s(),n("span",{class:"token import"},[n("span",{class:"token namespace"},[s("io"),n("span",{class:"token punctuation"},"."),s("netty"),n("span",{class:"token punctuation"},"."),s("handler"),n("span",{class:"token punctuation"},"."),s("codec"),n("span",{class:"token punctuation"},"."),s("string"),n("span",{class:"token punctuation"},".")]),n("span",{class:"token class-name"},"StringEncoder")]),n("span",{class:"token punctuation"},";"),s(`
`),n("span",{class:"token keyword"},"import"),s(),n("span",{class:"token import"},[n("span",{class:"token namespace"},[s("lombok"),n("span",{class:"token punctuation"},"."),s("extern"),n("span",{class:"token punctuation"},"."),s("slf4j"),n("span",{class:"token punctuation"},".")]),n("span",{class:"token class-name"},"Slf4j")]),n("span",{class:"token punctuation"},";"),s(`

`),n("span",{class:"token keyword"},"import"),s(),n("span",{class:"token import"},[n("span",{class:"token namespace"},[s("java"),n("span",{class:"token punctuation"},"."),s("util"),n("span",{class:"token punctuation"},".")]),n("span",{class:"token class-name"},"Arrays")]),n("span",{class:"token punctuation"},";"),s(`

`),n("span",{class:"token doc-comment comment"},[s(`/**
 * nettyå®¢æˆ·ç«¯
 *
 * `),n("span",{class:"token keyword"},"@author"),s(` kingsley
 * `),n("span",{class:"token keyword"},"@date"),s(` 2024/4/7 22:02
 */`)]),s(`
`),n("span",{class:"token annotation punctuation"},"@Slf4j"),s(`
`),n("span",{class:"token keyword"},"public"),s(),n("span",{class:"token keyword"},"class"),s(),n("span",{class:"token class-name"},"EventLoopClient"),s(),n("span",{class:"token punctuation"},"{"),s(`

    `),n("span",{class:"token keyword"},"public"),s(),n("span",{class:"token keyword"},"static"),s(),n("span",{class:"token keyword"},"void"),s(),n("span",{class:"token function"},"main"),n("span",{class:"token punctuation"},"("),n("span",{class:"token class-name"},"String"),n("span",{class:"token punctuation"},"["),n("span",{class:"token punctuation"},"]"),s(" args"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token keyword"},"throws"),s(),n("span",{class:"token class-name"},"InterruptedException"),s(),n("span",{class:"token punctuation"},"{"),s(`
        `),n("span",{class:"token comment"},"// 1ã€åˆ›å»ºå®¢æˆ·ç«¯å¯åŠ¨å¯¹è±¡"),s(`
        `),n("span",{class:"token class-name"},"Channel"),s(" channel "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token keyword"},"new"),s(),n("span",{class:"token class-name"},"Bootstrap"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(`
                `),n("span",{class:"token comment"},"// 2ã€æ·»åŠ EventLoop"),s(`
                `),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"group"),n("span",{class:"token punctuation"},"("),n("span",{class:"token keyword"},"new"),s(),n("span",{class:"token class-name"},"NioEventLoopGroup"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),s(`
                `),n("span",{class:"token comment"},"// 3ã€é€‰æ‹©å®¢æˆ·ç«¯channelå®ç°ç±»"),s(`
                `),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"channel"),n("span",{class:"token punctuation"},"("),n("span",{class:"token class-name"},"NioSocketChannel"),n("span",{class:"token punctuation"},"."),n("span",{class:"token keyword"},"class"),n("span",{class:"token punctuation"},")"),s(`
                `),n("span",{class:"token comment"},"// 4ã€æ·»åŠ å¤„ç†å™¨"),s(`
                `),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"handler"),n("span",{class:"token punctuation"},"("),n("span",{class:"token keyword"},"new"),s(),n("span",{class:"token class-name"},"ChannelInitializer"),n("span",{class:"token generics"},[n("span",{class:"token punctuation"},"<"),n("span",{class:"token class-name"},"NioSocketChannel"),n("span",{class:"token punctuation"},">")]),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
                    `),n("span",{class:"token comment"},"// åˆå§‹åŒ–channelï¼Œåœ¨è¿æ¥æˆåŠŸä¹‹åè°ƒç”¨"),s(`
                    `),n("span",{class:"token annotation punctuation"},"@Override"),s(`
                    `),n("span",{class:"token keyword"},"protected"),s(),n("span",{class:"token keyword"},"void"),s(),n("span",{class:"token function"},"initChannel"),n("span",{class:"token punctuation"},"("),n("span",{class:"token class-name"},"NioSocketChannel"),s(" ch"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
                        `),n("span",{class:"token comment"},"// 5ã€å¾€pipelineé“¾ä¸­æ·»åŠ ä¸€ä¸ªhandlerå¤„ç†å™¨ï¼Œè¿™é‡Œä½¿ç”¨ StringEncoder å°†å­—ç¬¦ä¸²ç¼–ç æˆ ByteBuf"),s(`
                        ch`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"pipeline"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"addLast"),n("span",{class:"token punctuation"},"("),n("span",{class:"token keyword"},"new"),s(),n("span",{class:"token class-name"},"StringEncoder"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
                    `),n("span",{class:"token punctuation"},"}"),s(`
                `),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},")"),s(`
                `),n("span",{class:"token comment"},"// 6ã€å¯åŠ¨å®¢æˆ·ç«¯è¿æ¥æœåŠ¡å™¨ï¼Œç­‰å¾…è¿æ¥æˆåŠŸ"),s(`
                `),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"connect"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"127.0.0.1"'),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token number"},"8080"),n("span",{class:"token punctuation"},")"),s(`
                `),n("span",{class:"token comment"},"// é˜»å¡æ–¹æ³•ï¼Œç­‰å¾…è¿æ¥æˆåŠŸ"),s(`
                `),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"sync"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(`
                `),n("span",{class:"token comment"},"// ä»£è¡¨è¿æ¥å¯¹è±¡"),s(`
                `),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"channel"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
        `),n("span",{class:"token class-name"},"String"),s(" clientId "),n("span",{class:"token operator"},"="),s(" args"),n("span",{class:"token punctuation"},"["),n("span",{class:"token number"},"0"),n("span",{class:"token punctuation"},"]"),n("span",{class:"token punctuation"},";"),s(`
        log`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"info"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"å®¢æˆ·ç«¯è¿æ¥æˆåŠŸï¼Œchannel: {}, clientId: {}"'),n("span",{class:"token punctuation"},","),s(" channel"),n("span",{class:"token punctuation"},","),s(" clientId"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
        `),n("span",{class:"token comment"},"// 7ã€å‘æœåŠ¡å™¨å‘é€æ•°æ®"),s(`
        channel`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"writeAndFlush"),n("span",{class:"token punctuation"},"("),s("clientId "),n("span",{class:"token operator"},"+"),s(),n("span",{class:"token string"},'" ===> hello, netty1"'),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
        `),n("span",{class:"token class-name"},"Thread"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"sleep"),n("span",{class:"token punctuation"},"("),n("span",{class:"token number"},"10000"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
        channel`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"writeAndFlush"),n("span",{class:"token punctuation"},"("),s("clientId "),n("span",{class:"token operator"},"+"),s(),n("span",{class:"token string"},'"hello, netty2"'),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token punctuation"},"}"),s(`
`),n("span",{class:"token punctuation"},"}"),s(`
`)])]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"})])],-1),x=n("div",{class:"language-bash line-numbers-mode","data-ext":"sh","data-title":"sh"},[n("pre",{class:"language-bash"},[n("code",null,[n("span",{class:"token number"},"2024"),s("-04-17 "),n("span",{class:"token number"},"23"),s(":55:39.875 DEBUG "),n("span",{class:"token punctuation"},"["),s("nioEventLoopGroup-3-1"),n("span",{class:"token punctuation"},"]"),s(" io.netty.util.Recycler                            "),n("span",{class:"token builtin class-name"},":"),s(" -Dio.netty.recycler.maxCapacityPerThread: "),n("span",{class:"token number"},"4096"),s(`
`),n("span",{class:"token number"},"2024"),s("-04-17 "),n("span",{class:"token number"},"23"),s(":55:39.876 DEBUG "),n("span",{class:"token punctuation"},"["),s("nioEventLoopGroup-3-1"),n("span",{class:"token punctuation"},"]"),s(" io.netty.util.Recycler                            "),n("span",{class:"token builtin class-name"},":"),s(" -Dio.netty.recycler.maxSharedCapacityFactor: "),n("span",{class:"token number"},"2"),s(`
`),n("span",{class:"token number"},"2024"),s("-04-17 "),n("span",{class:"token number"},"23"),s(":55:39.876 DEBUG "),n("span",{class:"token punctuation"},"["),s("nioEventLoopGroup-3-1"),n("span",{class:"token punctuation"},"]"),s(" io.netty.util.Recycler                            "),n("span",{class:"token builtin class-name"},":"),s(" -Dio.netty.recycler.linkCapacity: "),n("span",{class:"token number"},"16"),s(`
`),n("span",{class:"token number"},"2024"),s("-04-17 "),n("span",{class:"token number"},"23"),s(":55:39.876 DEBUG "),n("span",{class:"token punctuation"},"["),s("nioEventLoopGroup-3-1"),n("span",{class:"token punctuation"},"]"),s(" io.netty.util.Recycler                            "),n("span",{class:"token builtin class-name"},":"),s(" -Dio.netty.recycler.ratio: "),n("span",{class:"token number"},"8"),s(`
`),n("span",{class:"token number"},"2024"),s("-04-17 "),n("span",{class:"token number"},"23"),s(":55:39.876 DEBUG "),n("span",{class:"token punctuation"},"["),s("nioEventLoopGroup-3-1"),n("span",{class:"token punctuation"},"]"),s(" io.netty.util.Recycler                            "),n("span",{class:"token builtin class-name"},":"),s(" -Dio.netty.recycler.delayedQueue.ratio: "),n("span",{class:"token number"},"8"),s(`
`),n("span",{class:"token number"},"2024"),s("-04-17 "),n("span",{class:"token number"},"23"),s(":55:39.889 DEBUG "),n("span",{class:"token punctuation"},"["),s("nioEventLoopGroup-3-1"),n("span",{class:"token punctuation"},"]"),s(" io.netty.buffer.AbstractByteBuf                   "),n("span",{class:"token builtin class-name"},":"),s(" -Dio.netty.buffer.checkAccessible: "),n("span",{class:"token boolean"},"true"),s(`
`),n("span",{class:"token number"},"2024"),s("-04-17 "),n("span",{class:"token number"},"23"),s(":55:39.890 DEBUG "),n("span",{class:"token punctuation"},"["),s("nioEventLoopGroup-3-1"),n("span",{class:"token punctuation"},"]"),s(" io.netty.buffer.AbstractByteBuf                   "),n("span",{class:"token builtin class-name"},":"),s(" -Dio.netty.buffer.checkBounds: "),n("span",{class:"token boolean"},"true"),s(`
`),n("span",{class:"token number"},"2024"),s("-04-17 "),n("span",{class:"token number"},"23"),s(":55:39.893 DEBUG "),n("span",{class:"token punctuation"},"["),s("nioEventLoopGroup-3-1"),n("span",{class:"token punctuation"},"]"),s(" io.netty.util.ResourceLeakDetectorFactory         "),n("span",{class:"token builtin class-name"},":"),s(` Loaded default ResourceLeakDetector: io.netty.util.ResourceLeakDetector@452b789e
`),n("span",{class:"token number"},"2024"),s("-04-17 "),n("span",{class:"token number"},"23"),s(":55:39.899 INFO  "),n("span",{class:"token punctuation"},"["),s("nioEventLoopGroup-3-1"),n("span",{class:"token punctuation"},"]"),s(" com.kingsley.netty.c3.EventLoopServer             "),n("span",{class:"token builtin class-name"},":"),s(" receive: client2 "),n("span",{class:"token operator"},"=="),n("span",{class:"token operator"},"="),n("span",{class:"token operator"},">"),s(` hello, netty1
`),n("span",{class:"token number"},"2024"),s("-04-17 "),n("span",{class:"token number"},"23"),s(":55:40.430 INFO  "),n("span",{class:"token punctuation"},"["),s("nioEventLoopGroup-3-2"),n("span",{class:"token punctuation"},"]"),s(" com.kingsley.netty.c3.EventLoopServer             "),n("span",{class:"token builtin class-name"},":"),s(" receive: client3 "),n("span",{class:"token operator"},"=="),n("span",{class:"token operator"},"="),n("span",{class:"token operator"},">"),s(` hello, netty1
`),n("span",{class:"token number"},"2024"),s("-04-17 "),n("span",{class:"token number"},"23"),s(":55:41.053 INFO  "),n("span",{class:"token punctuation"},"["),s("nioEventLoopGroup-3-1"),n("span",{class:"token punctuation"},"]"),s(" com.kingsley.netty.c3.EventLoopServer             "),n("span",{class:"token builtin class-name"},":"),s(" receive: client4 "),n("span",{class:"token operator"},"=="),n("span",{class:"token operator"},"="),n("span",{class:"token operator"},">"),s(` hello, netty1
`),n("span",{class:"token number"},"2024"),s("-04-17 "),n("span",{class:"token number"},"23"),s(":55:41.603 INFO  "),n("span",{class:"token punctuation"},"["),s("nioEventLoopGroup-3-2"),n("span",{class:"token punctuation"},"]"),s(" com.kingsley.netty.c3.EventLoopServer             "),n("span",{class:"token builtin class-name"},":"),s(" receive: client1 "),n("span",{class:"token operator"},"=="),n("span",{class:"token operator"},"="),n("span",{class:"token operator"},">"),s(` hello, netty1
`),n("span",{class:"token number"},"2024"),s("-04-17 "),n("span",{class:"token number"},"23"),s(":55:49.858 INFO  "),n("span",{class:"token punctuation"},"["),s("nioEventLoopGroup-3-1"),n("span",{class:"token punctuation"},"]"),s(" com.kingsley.netty.c3.EventLoopServer             "),n("span",{class:"token builtin class-name"},":"),s(" receive: client2 "),n("span",{class:"token operator"},"=="),n("span",{class:"token operator"},"="),n("span",{class:"token operator"},">"),s(` hello, netty2
`),n("span",{class:"token number"},"2024"),s("-04-17 "),n("span",{class:"token number"},"23"),s(":55:50.419 INFO  "),n("span",{class:"token punctuation"},"["),s("nioEventLoopGroup-3-2"),n("span",{class:"token punctuation"},"]"),s(" com.kingsley.netty.c3.EventLoopServer             "),n("span",{class:"token builtin class-name"},":"),s(" receive: client3 "),n("span",{class:"token operator"},"=="),n("span",{class:"token operator"},"="),n("span",{class:"token operator"},">"),s(` hello, netty2
`),n("span",{class:"token number"},"2024"),s("-04-17 "),n("span",{class:"token number"},"23"),s(":55:51.045 INFO  "),n("span",{class:"token punctuation"},"["),s("nioEventLoopGroup-3-1"),n("span",{class:"token punctuation"},"]"),s(" com.kingsley.netty.c3.EventLoopServer             "),n("span",{class:"token builtin class-name"},":"),s(" receive: client4 "),n("span",{class:"token operator"},"=="),n("span",{class:"token operator"},"="),n("span",{class:"token operator"},">"),s(` hello, netty2
`),n("span",{class:"token number"},"2024"),s("-04-17 "),n("span",{class:"token number"},"23"),s(":55:51.599 INFO  "),n("span",{class:"token punctuation"},"["),s("nioEventLoopGroup-3-2"),n("span",{class:"token punctuation"},"]"),s(" com.kingsley.netty.c3.EventLoopServer             "),n("span",{class:"token builtin class-name"},":"),s(" receive: client1 "),n("span",{class:"token operator"},"=="),n("span",{class:"token operator"},"="),n("span",{class:"token operator"},">"),s(` hello, netty2
`)])]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"})])],-1),_=o(`<blockquote><ul><li>ä»å‰å››ä¸ªè¯»äº‹ä»¶æ—¥å¿—å¯ä»¥çœ‹å‡ºï¼ŒæœåŠ¡ç«¯ä¾æ¬¡ä½¿ç”¨ nioEventLoopGroup-3-1ã€nioEventLoopGroup-3-2 çº¿ç¨‹å¤„ç†å®¢æˆ·ç«¯çš„è¯·æ±‚ã€‚è¯æ˜ä¸€ä¸ªçº¿ç¨‹(EventLoop) å¯ä»¥å¤„ç†å¤šä¸ªå®¢æˆ·ç«¯çš„è¯·æ±‚ï¼Œå¹¶ä¸”æ˜¯é€šè¿‡è½®è¯¢çš„æ–¹å¼è·å–çº¿ç¨‹(EventLoop)æ¥å¤„ç†å®¢æˆ·ç«¯çš„è¯·æ±‚</li><li>æ ¹æ®åå››æ¬¡è¯»äº‹ä»¶æ—¥å¿—å¯ä»¥çœ‹å‡ºï¼Œå¯¹äºåŒä¸€ä¸ªå®¢æˆ·ç«¯è¿æ¥é€šé“ï¼ŒæœåŠ¡ç«¯ä½¿ç”¨ç›¸åŒçš„çº¿ç¨‹(EventLoop)å¤„ç†è¯·æ±‚</li></ul></blockquote><p><img src="https://cdn.jsdelivr.net/gh/taozhang1029/static-repository@master/img/202404180052346.png" alt=""></p><h4 id="â“ä¸Šè¿°æœåŠ¡ç«¯çš„ä»£ç æ˜¯å¦å­˜åœ¨é—®é¢˜å‘¢" tabindex="-1"><a class="header-anchor" href="#â“ä¸Šè¿°æœåŠ¡ç«¯çš„ä»£ç æ˜¯å¦å­˜åœ¨é—®é¢˜å‘¢"><span>â“ä¸Šè¿°æœåŠ¡ç«¯çš„ä»£ç æ˜¯å¦å­˜åœ¨é—®é¢˜å‘¢ï¼Ÿ</span></a></h4><p>ç”±äºæœåŠ¡ç«¯çš„ä¸€ä¸ªçº¿ç¨‹å¯èƒ½è¦å¤„ç†å¤šä¸ªå®¢æˆ·ç«¯çš„è¯·æ±‚ï¼Œå¦‚æœæŸä¸€ä¸ªå®¢æˆ·ç«¯çš„è¯·æ±‚å¤„ç†æ—¶é—´è¿‡é•¿ï¼Œé‚£ä¹ˆæœåŠ¡ç«¯çº¿ç¨‹å°±ä¼šé˜»å¡ï¼Œå¯¼è‡´å…¶ä»–å®¢æˆ·ç«¯çš„è¯·æ±‚æ— æ³•å¤„ç†ã€‚è¿™ç§æƒ…å†µä¸‹æœåŠ¡ç«¯çš„ååé‡å°±ä¼šå› ä¸ºä¸€ä¸ªå®¢æˆ·ç«¯çš„å½±å“è€Œä¸‹é™ã€‚</p><p>ğŸ’¡ è§£å†³æ–¹æ¡ˆ</p><p>åˆ›å»ºä¸€ä¸ªç‹¬ç«‹çš„ EventLoopGroup ä¸“é—¨å¤„ç†ä¸šåŠ¡é€»è¾‘</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>kingsley<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>c3</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>bootstrap<span class="token punctuation">.</span></span><span class="token class-name">ServerBootstrap</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>buffer<span class="token punctuation">.</span></span><span class="token class-name">ByteBuf</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span>nio<span class="token punctuation">.</span></span><span class="token class-name">NioEventLoopGroup</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span>socket<span class="token punctuation">.</span>nio<span class="token punctuation">.</span></span><span class="token class-name">NioServerSocketChannel</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span>socket<span class="token punctuation">.</span>nio<span class="token punctuation">.</span></span><span class="token class-name">NioSocketChannel</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">lombok<span class="token punctuation">.</span>extern<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span></span><span class="token class-name">Slf4j</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>nio<span class="token punctuation">.</span>charset<span class="token punctuation">.</span></span><span class="token class-name">Charset</span></span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
 * <span class="token keyword">@author</span> kingsley
 * <span class="token keyword">@date</span> 2024/4/17 22:43
 */</span>
<span class="token annotation punctuation">@Slf4j</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">EventLoopServer2</span> <span class="token punctuation">{</span>

    <span class="token doc-comment comment">/**
     * ä¸»ç¨‹åºå…¥å£ã€‚
     * ä½¿ç”¨ServerBootstrapå¯åŠ¨ä¸€ä¸ªæœåŠ¡å™¨ï¼Œé…ç½®ä½¿ç”¨NIOä¼ è¾“ï¼Œç»‘å®šåˆ°8080ç«¯å£ã€‚
     * å¯¹æ¯ä¸ªæ–°è¿æ¥ï¼Œä½¿ç”¨ChannelInitializeråˆå§‹åŒ–Channelï¼ŒåŠ å…¥è‡ªå®šä¹‰çš„ChannelInboundHandlerAdapterä»¥å¤„ç†å…¥ç«™äº‹ä»¶ã€‚
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// åˆ›å»ºä¸€ä¸ªç‹¬ç«‹çš„ EventLoopGroup</span>
        <span class="token class-name">EventLoopGroup</span> group <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DefaultEventLoopGroup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">new</span> <span class="token class-name">ServerBootstrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">group</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">NioEventLoopGroup</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">NioEventLoopGroup</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token class-name">NioServerSocketChannel</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">childHandler</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ChannelInitializer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">NioSocketChannel</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token annotation punctuation">@Override</span>
                    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">initChannel</span><span class="token punctuation">(</span><span class="token class-name">NioSocketChannel</span> ch<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        ch<span class="token punctuation">.</span><span class="token function">pipeline</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                                <span class="token comment">// ä½¿ç”¨ NioEventLoopGroup å¤„ç†</span>
                                <span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ChannelInboundHandlerAdapter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                                    <span class="token annotation punctuation">@Override</span>
                                    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">channelRead</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">,</span> <span class="token class-name">Object</span> msg<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                                        <span class="token class-name">ByteBuf</span> buf <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">ByteBuf</span><span class="token punctuation">)</span> msg<span class="token punctuation">;</span>
                                        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;receive: {}&quot;</span><span class="token punctuation">,</span> buf<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token class-name">Charset</span><span class="token punctuation">.</span><span class="token function">defaultCharset</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                                        <span class="token comment">// å°†æ¶ˆæ¯ä¼ é€’åˆ°ä¸‹ä¸€ä¸ª handler å¤„ç†ï¼Œå¿…é¡»åŠ è¿™ä¸€è¡Œä»£ç  ï¼ï¼ï¼ å¦åˆ™åœ¨è¿™å°±æ–­äº†ï¼Œä¸ä¼šå°†æ¶ˆæ¯äº¤ç»™åç»­ handler å¤„ç†</span>
                                        ctx<span class="token punctuation">.</span><span class="token function">fireChannelRead</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
                                    <span class="token punctuation">}</span>
                                <span class="token punctuation">}</span><span class="token punctuation">)</span>
                                <span class="token comment">// ä½¿ç”¨ DefaultEventLoop å¤„ç†</span>
                                <span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span>group<span class="token punctuation">,</span> <span class="token string">&quot;handler2&quot;</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">ChannelInboundHandlerAdapter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                                    <span class="token annotation punctuation">@Override</span>
                                    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">channelRead</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">,</span> <span class="token class-name">Object</span> msg<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                                        <span class="token class-name">ByteBuf</span> buf <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">ByteBuf</span><span class="token punctuation">)</span> msg<span class="token punctuation">;</span> <span class="token comment">// å°†æ¥æ”¶åˆ°çš„æ¶ˆæ¯è½¬æ¢ä¸ºByteBufç±»å‹</span>
                                        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;handler2 use defaultEventLoop process receive: {}&quot;</span><span class="token punctuation">,</span> buf<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token class-name">Charset</span><span class="token punctuation">.</span><span class="token function">defaultCharset</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                                    <span class="token punctuation">}</span>
                                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token number">8080</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å…ˆå¯åŠ¨æœåŠ¡ç«¯ï¼Œç„¶ååŒæ—¶å¯åŠ¨å®¢æˆ·ç«¯1ã€å®¢æˆ·ç«¯2ï¼ŒæœåŠ¡ç«¯è¾“å‡ºï¼š</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token number">2024</span>-04-18 00:28:42.995 INFO  <span class="token punctuation">[</span>nioEventLoopGroup-4-1<span class="token punctuation">]</span> com.kingsley.netty.c3.EventLoopServer2            <span class="token builtin class-name">:</span> receive: client2 <span class="token operator">==</span><span class="token operator">=</span><span class="token operator">&gt;</span> hello, netty1
<span class="token number">2024</span>-04-18 00:28:42.996 INFO  <span class="token punctuation">[</span>defaultEventLoopGroup-2-1<span class="token punctuation">]</span> com.kingsley.netty.c3.EventLoopServer2            <span class="token builtin class-name">:</span> handler2 use defaultEventLoop process receive: client2 <span class="token operator">==</span><span class="token operator">=</span><span class="token operator">&gt;</span> hello, netty1
<span class="token number">2024</span>-04-18 00:28:43.585 INFO  <span class="token punctuation">[</span>nioEventLoopGroup-4-2<span class="token punctuation">]</span> com.kingsley.netty.c3.EventLoopServer2            <span class="token builtin class-name">:</span> receive: client1 <span class="token operator">==</span><span class="token operator">=</span><span class="token operator">&gt;</span> hello, netty1
<span class="token number">2024</span>-04-18 00:28:43.586 INFO  <span class="token punctuation">[</span>defaultEventLoopGroup-2-2<span class="token punctuation">]</span> com.kingsley.netty.c3.EventLoopServer2            <span class="token builtin class-name">:</span> handler2 use defaultEventLoop process receive: client1 <span class="token operator">==</span><span class="token operator">=</span><span class="token operator">&gt;</span> hello, netty1
<span class="token number">2024</span>-04-18 00:28:52.970 INFO  <span class="token punctuation">[</span>nioEventLoopGroup-4-1<span class="token punctuation">]</span> com.kingsley.netty.c3.EventLoopServer2            <span class="token builtin class-name">:</span> receive: client2 <span class="token operator">==</span><span class="token operator">=</span><span class="token operator">&gt;</span> hello, netty2
<span class="token number">2024</span>-04-18 00:28:52.972 INFO  <span class="token punctuation">[</span>defaultEventLoopGroup-2-1<span class="token punctuation">]</span> com.kingsley.netty.c3.EventLoopServer2            <span class="token builtin class-name">:</span> handler2 use defaultEventLoop process receive: client2 <span class="token operator">==</span><span class="token operator">=</span><span class="token operator">&gt;</span> hello, netty2
<span class="token number">2024</span>-04-18 00:28:53.580 INFO  <span class="token punctuation">[</span>nioEventLoopGroup-4-2<span class="token punctuation">]</span> com.kingsley.netty.c3.EventLoopServer2            <span class="token builtin class-name">:</span> receive: client1 <span class="token operator">==</span><span class="token operator">=</span><span class="token operator">&gt;</span> hello, netty2
<span class="token number">2024</span>-04-18 00:28:53.583 INFO  <span class="token punctuation">[</span>defaultEventLoopGroup-2-2<span class="token punctuation">]</span> com.kingsley.netty.c3.EventLoopServer2            <span class="token builtin class-name">:</span> handler2 use defaultEventLoop process receive: client1 <span class="token operator">==</span><span class="token operator">=</span><span class="token operator">&gt;</span> hello, netty2
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¯ä»¥å‘ç°ç¬¬äºŒä¸ªhandlerä½¿ç”¨çš„æ˜¯ defaultEventLoopGroupï¼Œå¹¶ä¸”ä¹Ÿæ˜¯è½®è¯¢ç»‘å®šæœºåˆ¶</p><p><img src="https://cdn.jsdelivr.net/gh/taozhang1029/static-repository@master/img/202404180053271.png" alt=""></p><h4 id="ğŸ’¡-handler-æ‰§è¡Œä¸­å¦‚ä½•æ¢çº¿ç¨‹-eventloopgroup-å¤„ç†" tabindex="-1"><a class="header-anchor" href="#ğŸ’¡-handler-æ‰§è¡Œä¸­å¦‚ä½•æ¢çº¿ç¨‹-eventloopgroup-å¤„ç†"><span>ğŸ’¡ handler æ‰§è¡Œä¸­å¦‚ä½•æ¢çº¿ç¨‹ï¼ˆEventLoopGroupï¼‰å¤„ç†ï¼Ÿ</span></a></h4><p>å…³é”®ä»£ç </p>`,13),I=o(`<div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">invokeChannelRead</span><span class="token punctuation">(</span><span class="token keyword">final</span> <span class="token class-name">AbstractChannelHandlerContext</span> next<span class="token punctuation">,</span> <span class="token class-name">Object</span> msg<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">final</span> <span class="token class-name">Object</span> m <span class="token operator">=</span> next<span class="token punctuation">.</span>pipeline<span class="token punctuation">.</span><span class="token function">touch</span><span class="token punctuation">(</span><span class="token class-name">ObjectUtil</span><span class="token punctuation">.</span><span class="token function">checkNotNull</span><span class="token punctuation">(</span>msg<span class="token punctuation">,</span> <span class="token string">&quot;msg&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> next<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">EventExecutor</span> executor <span class="token operator">=</span> next<span class="token punctuation">.</span><span class="token function">executor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// ä¸‹ä¸€ä¸ª handler çš„äº‹ä»¶å¾ªç¯æ˜¯å¦ä¸å½“å‰çš„äº‹ä»¶å¾ªç¯æ˜¯åŒä¸€ä¸ªçº¿ç¨‹</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>executor<span class="token punctuation">.</span><span class="token function">inEventLoop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// æ˜¯ï¼Œç›´æ¥è°ƒç”¨</span>
        next<span class="token punctuation">.</span><span class="token function">invokeChannelRead</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token comment">// ä¸æ˜¯ï¼Œå°†è¦æ‰§è¡Œçš„ä»£ç ä½œä¸ºä»»åŠ¡æäº¤ç»™ä¸‹ä¸€ä¸ªäº‹ä»¶å¾ªç¯å¤„ç†ï¼ˆæ¢äººï¼‰</span>
        executor<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Runnable</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                next<span class="token punctuation">.</span><span class="token function">invokeChannelRead</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>å¦‚æœä¸¤ä¸ª handler ç»‘å®šçš„æ˜¯åŒä¸€ä¸ªçº¿ç¨‹ï¼Œé‚£ä¹ˆå°±ç›´æ¥è°ƒç”¨</li><li>å¦åˆ™ï¼ŒæŠŠè¦è°ƒç”¨çš„ä»£ç å°è£…ä¸ºä¸€ä¸ªä»»åŠ¡å¯¹è±¡ï¼Œç”±ä¸‹ä¸€ä¸ª handler çš„çº¿ç¨‹æ¥è°ƒç”¨</li></ul><h3 id="_3ã€channel" tabindex="-1"><a class="header-anchor" href="#_3ã€channel"><span>3ã€Channel</span></a></h3><p>channel çš„ä¸»è¦ä½œç”¨</p><ul><li>close() å¯ä»¥ç”¨æ¥å…³é—­ channel</li><li>closeFuture() ç”¨æ¥å¤„ç† channel çš„å…³é—­ <ul><li>sync æ–¹æ³•ä½œç”¨æ˜¯åŒæ­¥ç­‰å¾… channel å…³é—­</li><li>è€Œ addListener æ–¹æ³•æ˜¯å¼‚æ­¥ç­‰å¾… channel å…³é—­</li></ul></li><li>pipeline() æ–¹æ³•æ·»åŠ å¤„ç†å™¨</li><li>write() æ–¹æ³•å°†æ•°æ®å†™å…¥</li><li>writeAndFlush() æ–¹æ³•å°†æ•°æ®å†™å…¥å¹¶åˆ·å‡º</li></ul><h4 id="channelfuture" tabindex="-1"><a class="header-anchor" href="#channelfuture"><span>ChannelFuture</span></a></h4><p>å°†ä¹‹å‰çš„å®¢æˆ·ç«¯ä»£ç æ‹†å¼€æ¥çœ‹</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code>
<span class="token annotation punctuation">@Slf4j</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">EventLoopClient</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
        <span class="token class-name">ChannelFuture</span> channelFuture <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Bootstrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">group</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">NioEventLoopGroup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token class-name">NioSocketChannel</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">handler</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ChannelInitializer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">NioSocketChannel</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token annotation punctuation">@Override</span>
                    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">initChannel</span><span class="token punctuation">(</span><span class="token class-name">NioSocketChannel</span> ch<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        ch<span class="token punctuation">.</span><span class="token function">pipeline</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">StringEncoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token string">&quot;127.0.0.1&quot;</span><span class="token punctuation">,</span> <span class="token number">8080</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 1</span>

        channelFuture<span class="token punctuation">.</span><span class="token function">sync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">writeAndFlush</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;: hello netty!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>1 å¤„è¿”å›çš„æ˜¯ ChannelFuture å¯¹è±¡ï¼Œå®ƒçš„ä½œç”¨æ˜¯åˆ©ç”¨ channel() æ–¹æ³•æ¥è·å– Channel å¯¹è±¡</p></blockquote><p><strong>æ³¨æ„</strong> connect æ–¹æ³•æ˜¯å¼‚æ­¥çš„ï¼Œæ„å‘³ç€ä¸ç­‰è¿æ¥å»ºç«‹ï¼Œæ–¹æ³•æ‰§è¡Œå°±è¿”å›äº†ã€‚å› æ­¤ channelFuture å¯¹è±¡ä¸­ä¸èƒ½ã€ç«‹åˆ»ã€‘è·å¾—åˆ°æ­£ç¡®çš„ Channel å¯¹è±¡</p><p><strong>éªŒè¯ä»£ç </strong></p>`,11),j=n("div",{class:"language-java line-numbers-mode","data-ext":"java","data-title":"java"},[n("pre",{class:"language-java"},[n("code",null,[s(`
`),n("span",{class:"token annotation punctuation"},"@Slf4j"),s(`
`),n("span",{class:"token keyword"},"public"),s(),n("span",{class:"token keyword"},"class"),s(),n("span",{class:"token class-name"},"ChannelFutureClient"),s(),n("span",{class:"token punctuation"},"{"),s(`
    `),n("span",{class:"token keyword"},"public"),s(),n("span",{class:"token keyword"},"static"),s(),n("span",{class:"token keyword"},"void"),s(),n("span",{class:"token function"},"main"),n("span",{class:"token punctuation"},"("),n("span",{class:"token class-name"},"String"),n("span",{class:"token punctuation"},"["),n("span",{class:"token punctuation"},"]"),s(" args"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
        `),n("span",{class:"token class-name"},"ChannelFuture"),s(" channelFuture "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token keyword"},"new"),s(),n("span",{class:"token class-name"},"Bootstrap"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(`
                `),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"group"),n("span",{class:"token punctuation"},"("),n("span",{class:"token keyword"},"new"),s(),n("span",{class:"token class-name"},"NioEventLoopGroup"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),s(`
                `),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"channel"),n("span",{class:"token punctuation"},"("),n("span",{class:"token class-name"},"NioSocketChannel"),n("span",{class:"token punctuation"},"."),n("span",{class:"token keyword"},"class"),n("span",{class:"token punctuation"},")"),s(`
                `),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"handler"),n("span",{class:"token punctuation"},"("),n("span",{class:"token keyword"},"new"),s(),n("span",{class:"token class-name"},"ChannelInitializer"),n("span",{class:"token generics"},[n("span",{class:"token punctuation"},"<"),n("span",{class:"token class-name"},"Channel"),n("span",{class:"token punctuation"},">")]),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
                    `),n("span",{class:"token annotation punctuation"},"@Override"),s(`
                    `),n("span",{class:"token keyword"},"protected"),s(),n("span",{class:"token keyword"},"void"),s(),n("span",{class:"token function"},"initChannel"),n("span",{class:"token punctuation"},"("),n("span",{class:"token class-name"},"Channel"),s(" ch"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
                        ch`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"pipeline"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"addLast"),n("span",{class:"token punctuation"},"("),n("span",{class:"token keyword"},"new"),s(),n("span",{class:"token class-name"},"StringEncoder"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
                    `),n("span",{class:"token punctuation"},"}"),s(`
                `),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},")"),s(`
                `),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"connect"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"127.0.0.1"'),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token number"},"8080"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`

        `),n("span",{class:"token class-name"},"System"),n("span",{class:"token punctuation"},"."),s("out"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"println"),n("span",{class:"token punctuation"},"("),s("channelFuture"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"channel"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(),n("span",{class:"token comment"},"// 1"),s(`
        channelFuture`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"sync"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(),n("span",{class:"token comment"},"// 2"),s(`
        `),n("span",{class:"token class-name"},"System"),n("span",{class:"token punctuation"},"."),s("out"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"println"),n("span",{class:"token punctuation"},"("),s("channelFuture"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"channel"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(),n("span",{class:"token comment"},"// 3"),s(`
    `),n("span",{class:"token punctuation"},"}"),s(`
`),n("span",{class:"token punctuation"},"}"),s(`
`)])]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"})])],-1),G=n("div",{class:"language-java line-numbers-mode","data-ext":"java","data-title":"java"},[n("pre",{class:"language-java"},[n("code",null,[n("span",{class:"token keyword"},"package"),s(),n("span",{class:"token namespace"},[s("com"),n("span",{class:"token punctuation"},"."),s("kingsley"),n("span",{class:"token punctuation"},"."),s("netty"),n("span",{class:"token punctuation"},"."),s("c3")]),n("span",{class:"token punctuation"},";"),s(`

`),n("span",{class:"token keyword"},"import"),s(),n("span",{class:"token import"},[n("span",{class:"token namespace"},[s("io"),n("span",{class:"token punctuation"},"."),s("netty"),n("span",{class:"token punctuation"},"."),s("bootstrap"),n("span",{class:"token punctuation"},".")]),n("span",{class:"token class-name"},"ServerBootstrap")]),n("span",{class:"token punctuation"},";"),s(`
`),n("span",{class:"token keyword"},"import"),s(),n("span",{class:"token import"},[n("span",{class:"token namespace"},[s("io"),n("span",{class:"token punctuation"},"."),s("netty"),n("span",{class:"token punctuation"},"."),s("buffer"),n("span",{class:"token punctuation"},".")]),n("span",{class:"token class-name"},"ByteBuf")]),n("span",{class:"token punctuation"},";"),s(`
`),n("span",{class:"token keyword"},"import"),s(),n("span",{class:"token import"},[n("span",{class:"token namespace"},[s("io"),n("span",{class:"token punctuation"},"."),s("netty"),n("span",{class:"token punctuation"},"."),s("channel"),n("span",{class:"token punctuation"},".")]),n("span",{class:"token class-name"},"ChannelHandlerContext")]),n("span",{class:"token punctuation"},";"),s(`
`),n("span",{class:"token keyword"},"import"),s(),n("span",{class:"token import"},[n("span",{class:"token namespace"},[s("io"),n("span",{class:"token punctuation"},"."),s("netty"),n("span",{class:"token punctuation"},"."),s("channel"),n("span",{class:"token punctuation"},".")]),n("span",{class:"token class-name"},"ChannelInboundHandlerAdapter")]),n("span",{class:"token punctuation"},";"),s(`
`),n("span",{class:"token keyword"},"import"),s(),n("span",{class:"token import"},[n("span",{class:"token namespace"},[s("io"),n("span",{class:"token punctuation"},"."),s("netty"),n("span",{class:"token punctuation"},"."),s("channel"),n("span",{class:"token punctuation"},".")]),n("span",{class:"token class-name"},"ChannelInitializer")]),n("span",{class:"token punctuation"},";"),s(`
`),n("span",{class:"token keyword"},"import"),s(),n("span",{class:"token import"},[n("span",{class:"token namespace"},[s("io"),n("span",{class:"token punctuation"},"."),s("netty"),n("span",{class:"token punctuation"},"."),s("channel"),n("span",{class:"token punctuation"},"."),s("nio"),n("span",{class:"token punctuation"},".")]),n("span",{class:"token class-name"},"NioEventLoopGroup")]),n("span",{class:"token punctuation"},";"),s(`
`),n("span",{class:"token keyword"},"import"),s(),n("span",{class:"token import"},[n("span",{class:"token namespace"},[s("io"),n("span",{class:"token punctuation"},"."),s("netty"),n("span",{class:"token punctuation"},"."),s("channel"),n("span",{class:"token punctuation"},"."),s("socket"),n("span",{class:"token punctuation"},"."),s("nio"),n("span",{class:"token punctuation"},".")]),n("span",{class:"token class-name"},"NioServerSocketChannel")]),n("span",{class:"token punctuation"},";"),s(`
`),n("span",{class:"token keyword"},"import"),s(),n("span",{class:"token import"},[n("span",{class:"token namespace"},[s("io"),n("span",{class:"token punctuation"},"."),s("netty"),n("span",{class:"token punctuation"},"."),s("channel"),n("span",{class:"token punctuation"},"."),s("socket"),n("span",{class:"token punctuation"},"."),s("nio"),n("span",{class:"token punctuation"},".")]),n("span",{class:"token class-name"},"NioSocketChannel")]),n("span",{class:"token punctuation"},";"),s(`
`),n("span",{class:"token keyword"},"import"),s(),n("span",{class:"token import"},[n("span",{class:"token namespace"},[s("lombok"),n("span",{class:"token punctuation"},"."),s("extern"),n("span",{class:"token punctuation"},"."),s("slf4j"),n("span",{class:"token punctuation"},".")]),n("span",{class:"token class-name"},"Slf4j")]),n("span",{class:"token punctuation"},";"),s(`

`),n("span",{class:"token keyword"},"import"),s(),n("span",{class:"token import"},[n("span",{class:"token namespace"},[s("java"),n("span",{class:"token punctuation"},"."),s("nio"),n("span",{class:"token punctuation"},"."),s("charset"),n("span",{class:"token punctuation"},".")]),n("span",{class:"token class-name"},"Charset")]),n("span",{class:"token punctuation"},";"),s(`

`),n("span",{class:"token doc-comment comment"},[s(`/**
 * `),n("span",{class:"token keyword"},"@author"),s(` kingsley
 * `),n("span",{class:"token keyword"},"@date"),s(` 2024/4/17 22:43
 */`)]),s(`
`),n("span",{class:"token annotation punctuation"},"@Slf4j"),s(`
`),n("span",{class:"token keyword"},"public"),s(),n("span",{class:"token keyword"},"class"),s(),n("span",{class:"token class-name"},"EventLoopServer"),s(),n("span",{class:"token punctuation"},"{"),s(`

    `),n("span",{class:"token doc-comment comment"},`/**
     * ä¸»ç¨‹åºå…¥å£ã€‚
     * ä½¿ç”¨ServerBootstrapå¯åŠ¨ä¸€ä¸ªæœåŠ¡å™¨ï¼Œé…ç½®ä½¿ç”¨NIOä¼ è¾“ï¼Œç»‘å®šåˆ°8080ç«¯å£ã€‚
     * å¯¹æ¯ä¸ªæ–°è¿æ¥ï¼Œä½¿ç”¨ChannelInitializeråˆå§‹åŒ–Channelï¼ŒåŠ å…¥è‡ªå®šä¹‰çš„ChannelInboundHandlerAdapterä»¥å¤„ç†å…¥ç«™äº‹ä»¶ã€‚
     */`),s(`
    `),n("span",{class:"token keyword"},"public"),s(),n("span",{class:"token keyword"},"static"),s(),n("span",{class:"token keyword"},"void"),s(),n("span",{class:"token function"},"main"),n("span",{class:"token punctuation"},"("),n("span",{class:"token class-name"},"String"),n("span",{class:"token punctuation"},"["),n("span",{class:"token punctuation"},"]"),s(" args"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
        `),n("span",{class:"token keyword"},"new"),s(),n("span",{class:"token class-name"},"ServerBootstrap"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token comment"},"// åˆ›å»ºServerBootstrapå®ä¾‹ï¼Œç”¨äºå¯åŠ¨æœåŠ¡å™¨"),s(`
                `),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"group"),n("span",{class:"token punctuation"},"("),n("span",{class:"token keyword"},"new"),s(),n("span",{class:"token class-name"},"NioEventLoopGroup"),n("span",{class:"token punctuation"},"("),n("span",{class:"token number"},"1"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token keyword"},"new"),s(),n("span",{class:"token class-name"},"NioEventLoopGroup"),n("span",{class:"token punctuation"},"("),n("span",{class:"token number"},"2"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token comment"},"// æŒ‡å®šä½¿ç”¨NIOäº‹ä»¶å¾ªç¯ç»„"),s(`
                `),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"channel"),n("span",{class:"token punctuation"},"("),n("span",{class:"token class-name"},"NioServerSocketChannel"),n("span",{class:"token punctuation"},"."),n("span",{class:"token keyword"},"class"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token comment"},"// æŒ‡å®šä½¿ç”¨NIOæœåŠ¡å™¨å¥—æ¥å­—é€šé“"),s(`
                `),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"childHandler"),n("span",{class:"token punctuation"},"("),n("span",{class:"token keyword"},"new"),s(),n("span",{class:"token class-name"},"ChannelInitializer"),n("span",{class:"token generics"},[n("span",{class:"token punctuation"},"<"),n("span",{class:"token class-name"},"NioSocketChannel"),n("span",{class:"token punctuation"},">")]),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(),n("span",{class:"token comment"},"// å®šä¹‰å­é€šé“ï¼ˆå³æ¯ä¸ªæ–°è¿æ¥ï¼‰çš„åˆå§‹åŒ–å¤„ç†å™¨"),s(`
                    `),n("span",{class:"token annotation punctuation"},"@Override"),s(`
                    `),n("span",{class:"token keyword"},"protected"),s(),n("span",{class:"token keyword"},"void"),s(),n("span",{class:"token function"},"initChannel"),n("span",{class:"token punctuation"},"("),n("span",{class:"token class-name"},"NioSocketChannel"),s(" ch"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token keyword"},"throws"),s(),n("span",{class:"token class-name"},"Exception"),s(),n("span",{class:"token punctuation"},"{"),s(`
                        ch`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"pipeline"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"addLast"),n("span",{class:"token punctuation"},"("),n("span",{class:"token keyword"},"new"),s(),n("span",{class:"token class-name"},"ChannelInboundHandlerAdapter"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(),n("span",{class:"token comment"},"// å‘é€šé“å¤„ç†é“¾ä¸­æ·»åŠ è‡ªå®šä¹‰çš„å…¥ç«™äº‹ä»¶å¤„ç†å™¨"),s(`
                            `),n("span",{class:"token annotation punctuation"},"@Override"),s(`
                            `),n("span",{class:"token keyword"},"public"),s(),n("span",{class:"token keyword"},"void"),s(),n("span",{class:"token function"},"channelRead"),n("span",{class:"token punctuation"},"("),n("span",{class:"token class-name"},"ChannelHandlerContext"),s(" ctx"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token class-name"},"Object"),s(" msg"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(),n("span",{class:"token comment"},"// å½“æœ‰æ•°æ®è¯»å–æ—¶"),s(`
                                `),n("span",{class:"token class-name"},"ByteBuf"),s(" buf "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token class-name"},"ByteBuf"),n("span",{class:"token punctuation"},")"),s(" msg"),n("span",{class:"token punctuation"},";"),s(),n("span",{class:"token comment"},"// å°†æ¥æ”¶åˆ°çš„æ¶ˆæ¯è½¬æ¢ä¸ºByteBufç±»å‹"),s(`
                                log`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"info"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"receive: {}"'),n("span",{class:"token punctuation"},","),s(" buf"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"toString"),n("span",{class:"token punctuation"},"("),n("span",{class:"token class-name"},"Charset"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"defaultCharset"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(),n("span",{class:"token comment"},"// æ‰“å°æ¥æ”¶åˆ°çš„æ•°æ®"),s(`
                            `),n("span",{class:"token punctuation"},"}"),s(`
                        `),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
                    `),n("span",{class:"token punctuation"},"}"),s(`
                `),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"bind"),n("span",{class:"token punctuation"},"("),n("span",{class:"token number"},"8080"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(),n("span",{class:"token comment"},"// ç»‘å®šåˆ°8080ç«¯å£å¹¶å¯åŠ¨æœåŠ¡å™¨"),s(`
    `),n("span",{class:"token punctuation"},"}"),s(`

`),n("span",{class:"token punctuation"},"}"),s(`
`)])]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"})])],-1),F=o(`<p>å®¢æˆ·ç«¯æ—¥å¿—</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token number">2024</span>-04-19 00:07:32.827 INFO  <span class="token punctuation">[</span>main<span class="token punctuation">]</span> com.kingsley.netty.c4.ChannelFutureClient         <span class="token builtin class-name">:</span> <span class="token punctuation">[</span>id: 0xc8b9a39e<span class="token punctuation">]</span>
<span class="token number">2024</span>-04-19 00:07:32.839 INFO  <span class="token punctuation">[</span>main<span class="token punctuation">]</span> com.kingsley.netty.c4.ChannelFutureClient         <span class="token builtin class-name">:</span> <span class="token punctuation">[</span>id: 0xc8b9a39e, L:/127.0.0.1:52991 - R:/127.0.0.1:8080<span class="token punctuation">]</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>æ‰§è¡Œåˆ° 1 æ—¶ï¼Œè¿æ¥æœªå»ºç«‹ï¼Œæ‰“å° [id: 0xc8b9a39e]</li><li>æ‰§è¡Œåˆ° 2 æ—¶ï¼Œsync æ–¹æ³•æ˜¯åŒæ­¥ç­‰å¾…è¿æ¥å»ºç«‹å®Œæˆ</li><li>æ‰§è¡Œåˆ° 3 æ—¶ï¼Œè¿æ¥è‚¯å®šå»ºç«‹äº†ï¼Œæ‰“å° [id: 0xc8b9a39e, L:/127.0.0.1:52991 - R:/127.0.0.1:8080]</li></ul><p>é™¤äº†å¯ä»¥ç”¨ sync æ–¹æ³•å¾—åˆ°æœ‰æ•ˆçš„Channelä»¥å¤–ï¼Œè¿˜å¯ä»¥ä½¿ç”¨å›è°ƒçš„æ–¹å¼</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * <span class="token keyword">@author</span> kingsley
 * <span class="token keyword">@date</span> 2024/4/18 23:55
 */</span>
<span class="token annotation punctuation">@Slf4j</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ChannelFutureClient</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
        <span class="token class-name">ChannelFuture</span> channelFuture <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Bootstrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">group</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">NioEventLoopGroup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token class-name">NioSocketChannel</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">handler</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ChannelInitializer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">NioSocketChannel</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token annotation punctuation">@Override</span>
                    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">initChannel</span><span class="token punctuation">(</span><span class="token class-name">NioSocketChannel</span> ch<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        ch<span class="token punctuation">.</span><span class="token function">pipeline</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">StringEncoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token string">&quot;127.0.0.1&quot;</span><span class="token punctuation">,</span> <span class="token number">8080</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 1ã€åŒæ­¥é˜»å¡æ–¹å¼è·å–Channel</span>
        <span class="token comment">// log.info(&quot;{}&quot;, channelFuture.channel()); // 1</span>
        <span class="token comment">// channelFuture.sync(); // 2</span>
        <span class="token comment">// log.info(&quot;{}&quot;, channelFuture.channel()); // 3</span>

        <span class="token comment">// 2ã€å¼‚æ­¥éé˜»å¡æ–¹å¼è·å–Channel</span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;{}&quot;</span><span class="token punctuation">,</span> channelFuture<span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 1</span>
        channelFuture<span class="token punctuation">.</span><span class="token function">addListener</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">ChannelFutureListener</span><span class="token punctuation">)</span> future <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token comment">// 1ã€è·å–åˆ°channel</span>
            <span class="token class-name">NioSocketChannel</span> channel <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">NioSocketChannel</span><span class="token punctuation">)</span> future<span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;addListener è·å–çš„Channelï¼š{}&quot;</span><span class="token punctuation">,</span> channel<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å®¢æˆ·ç«¯æ—¥å¿—è¾“å‡º</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token number">2024</span>-04-19 00:16:28.531 INFO  <span class="token punctuation">[</span>main<span class="token punctuation">]</span> com.kingsley.netty.c4.ChannelFutureClient         <span class="token builtin class-name">:</span> <span class="token punctuation">[</span>id: 0x2983cbbf<span class="token punctuation">]</span>
<span class="token number">2024</span>-04-19 00:16:28.612 INFO  <span class="token punctuation">[</span>nioEventLoopGroup-2-1<span class="token punctuation">]</span> com.kingsley.netty.c4.ChannelFutureClient         <span class="token builtin class-name">:</span> addListener è·å–çš„Channelï¼š<span class="token punctuation">[</span>id: 0x2983cbbf, L:/127.0.0.1:53256 - R:/127.0.0.1:8080<span class="token punctuation">]</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>æ‰§è¡Œåˆ° 1 æ—¶ï¼Œè¿æ¥æœªå»ºç«‹ï¼Œæ‰“å° [id: 0x2983cbbf]</li><li>ChannelFutureListener ä¼šåœ¨è¿æ¥å»ºç«‹æ—¶è¢«è°ƒç”¨ï¼ˆå…¶ä¸­ operationComplete æ–¹æ³•ï¼‰ï¼Œå› æ­¤æ‰§è¡Œåˆ° 2 æ—¶ï¼Œè¿æ¥è‚¯å®šå»ºç«‹äº†ï¼Œæ‰“å° [id: 0x2983cbbf, L:/127.0.0.1:53256 - R:/127.0.0.1:8080]</li></ul><p>è§‚å¯Ÿæ—¥å¿—çš„loggeréƒ¨åˆ†å¯ä»¥å‘ç°ï¼šåŒæ­¥é˜»å¡æ–¹å¼æ˜¯åœ¨<strong>ä¸»çº¿ç¨‹</strong>ä¸­è·å–çš„Channelï¼Œå¼‚æ­¥éé˜»å¡æ–¹å¼æ˜¯åœ¨ <strong>nioEventLoopGroup-2-1</strong> çº¿ç¨‹ä¸­è·å–çš„Channelã€‚</p><h4 id="closefuture" tabindex="-1"><a class="header-anchor" href="#closefuture"><span>CloseFuture</span></a></h4><p>æˆ‘ä»¬å¯ä»¥é€šè¿‡ ChannelFuture æ¥åšä¸€äº›èµ„æºé‡Šæ”¾æ“ä½œï¼Œä¾‹å¦‚å…³é—­ Channelã€å…³é—­ EventLoopGroup ç­‰ã€‚</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code>
<span class="token annotation punctuation">@Slf4j</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CloseFutureClient</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
        <span class="token class-name">NioEventLoopGroup</span> group <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">NioEventLoopGroup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">ChannelFuture</span> channelFuture <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Bootstrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">group</span><span class="token punctuation">(</span>group<span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token class-name">NioSocketChannel</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">handler</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ChannelInitializer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">NioSocketChannel</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token annotation punctuation">@Override</span> <span class="token comment">// åœ¨è¿æ¥å»ºç«‹åè¢«è°ƒç”¨</span>
                    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">initChannel</span><span class="token punctuation">(</span><span class="token class-name">NioSocketChannel</span> ch<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
                        ch<span class="token punctuation">.</span><span class="token function">pipeline</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">LoggingHandler</span><span class="token punctuation">(</span><span class="token class-name">LogLevel</span><span class="token punctuation">.</span><span class="token constant">DEBUG</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        ch<span class="token punctuation">.</span><span class="token function">pipeline</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">StringEncoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">InetSocketAddress</span><span class="token punctuation">(</span><span class="token string">&quot;localhost&quot;</span><span class="token punctuation">,</span> <span class="token number">8080</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Channel</span> channel <span class="token operator">=</span> channelFuture<span class="token punctuation">.</span><span class="token function">sync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;{}&quot;</span><span class="token punctuation">,</span> channel<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token class-name">Scanner</span> scanner <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Scanner</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">String</span> line <span class="token operator">=</span> scanner<span class="token punctuation">.</span><span class="token function">nextLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">&quot;q&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>line<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    channel<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// close å¼‚æ­¥æ“ä½œ</span>
                    <span class="token comment">// log.debug(&quot;å¤„ç†å…³é—­ä¹‹åçš„æ“ä½œ&quot;); // ä¸èƒ½åœ¨è¿™é‡Œå–„å</span>
                    <span class="token keyword">break</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                channel<span class="token punctuation">.</span><span class="token function">writeAndFlush</span><span class="token punctuation">(</span>line<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&quot;input&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// è·å– CloseFuture å¯¹è±¡ï¼Œ 1) åŒæ­¥å¤„ç†å…³é—­ï¼Œ 2) å¼‚æ­¥å¤„ç†å…³é—­</span>
        <span class="token class-name">ChannelFuture</span> closeFuture <span class="token operator">=</span> channel<span class="token punctuation">.</span><span class="token function">closeFuture</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">/*log.debug(&quot;waiting close...&quot;);
        closeFuture.sync();
        log.debug(&quot;å¤„ç†å…³é—­ä¹‹åçš„æ“ä½œ&quot;);*/</span>
        closeFuture<span class="token punctuation">.</span><span class="token function">addListener</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ChannelFutureListener</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">operationComplete</span><span class="token punctuation">(</span><span class="token class-name">ChannelFuture</span> future<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
                log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;å¤„ç†å…³é—­ä¹‹åçš„æ“ä½œ&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                group<span class="token punctuation">.</span><span class="token function">shutdownGracefully</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="ğŸ’¡-å¼‚æ­¥æå‡çš„æ˜¯ä»€ä¹ˆ" tabindex="-1"><a class="header-anchor" href="#ğŸ’¡-å¼‚æ­¥æå‡çš„æ˜¯ä»€ä¹ˆ"><span>ğŸ’¡ å¼‚æ­¥æå‡çš„æ˜¯ä»€ä¹ˆ</span></a></h4><ul><li>çœ‹åˆ°è¿™é‡Œå¯èƒ½ä¼šæœ‰ç–‘é—®ï¼šä¸ºä»€ä¹ˆä¸åœ¨ä¸€ä¸ªçº¿ç¨‹ä¸­å»æ‰§è¡Œå»ºç«‹è¿æ¥ã€å…³é—­ channelï¼Œé‚£æ ·ä¸æ˜¯ä¹Ÿå¯ä»¥å—ï¼Ÿéè¦ç”¨è¿™ä¹ˆå¤æ‚çš„å¼‚æ­¥æ–¹å¼ï¼šæ¯”å¦‚ä¸€ä¸ªçº¿ç¨‹å‘èµ·å»ºç«‹è¿æ¥ï¼Œå¦ä¸€ä¸ªçº¿ç¨‹å»çœŸæ­£å»ºç«‹è¿æ¥</li><li>è¿˜æœ‰ä¸€ç§çœ‹æ³•ï¼šnetty å¼‚æ­¥æ–¹å¼å› ä¸ºç”¨äº†å¤šçº¿ç¨‹æ•ˆç‡å°±é«˜ã€‚å…¶å®è¿™ç§è®¤è¯†æ¯”è¾ƒç‰‡é¢ï¼Œå¤šçº¿ç¨‹å’Œå¼‚æ­¥æ‰€æå‡çš„æ•ˆç‡å¹¶ä¸æ˜¯æ‰€è®¤ä¸ºçš„ã€‚</li></ul><p>æ€è€ƒä¸‹é¢çš„åœºæ™¯ï¼Œ4 ä¸ªåŒ»ç”Ÿç»™äººçœ‹ç—…ï¼Œæ¯ä¸ªç—…äººèŠ±è´¹ 20 åˆ†é’Ÿï¼Œè€Œä¸”åŒ»ç”Ÿçœ‹ç—…çš„è¿‡ç¨‹ä¸­æ˜¯ä»¥ç—…äººä¸ºå•ä½çš„ï¼Œä¸€ä¸ªç—…äººçœ‹å®Œäº†ï¼Œæ‰èƒ½çœ‹ä¸‹ä¸€ä¸ªç—…äººã€‚å‡è®¾ç—…äººæºæºä¸æ–­åœ°æ¥ï¼Œå¯ä»¥è®¡ç®—ä¸€ä¸‹ 4 ä¸ªåŒ»ç”Ÿä¸€å¤©å·¥ä½œ 8 å°æ—¶ï¼Œå¤„ç†çš„ç—…äººæ€»æ•°æ˜¯ï¼š <span class="highlight">4 * 8 * (60 / 20) = 96</span></p><p><img src="https://cdn.jsdelivr.net/gh/taozhang1029/static-repository@master/img/202404190034608.png" alt="ç¤ºæ„å›¾"></p><p>ç»ç ”ç©¶å‘ç°ï¼Œçœ‹ç—…å¯ä»¥ç»†åˆ†ä¸ºå››ä¸ªæ­¥éª¤ï¼Œå¦‚ä¸‹</p><p><img src="https://cdn.jsdelivr.net/gh/taozhang1029/static-repository@master/img/202404190036993.png" alt="å››ä¸ªæ­¥éª¤"></p><p>å‡è®¾ç»æ‹†åˆ†åæ¯ä¸ªæ­¥éª¤éœ€è¦ 5 åˆ†é’Ÿï¼Œå¯ä»¥åšå¦‚ä¸‹ä¼˜åŒ–</p><p><img src="https://cdn.jsdelivr.net/gh/taozhang1029/static-repository@master/img/202404190040867.png" alt=""></p><p>åªæœ‰ä¸€å¼€å§‹ï¼ŒåŒ»ç”Ÿ 2ã€3ã€4 åˆ†åˆ«è¦ç­‰å¾… 5ã€10ã€15 åˆ†é’Ÿæ‰èƒ½æ‰§è¡Œå·¥ä½œï¼Œä½†åªè¦åç»­ç—…äººæºæºä¸æ–­åœ°æ¥ï¼Œä»–ä»¬å°±èƒ½å¤Ÿæ»¡è´Ÿè·å·¥ä½œï¼Œå¹¶ä¸”å¤„ç†ç—…äººçš„èƒ½åŠ›æé«˜åˆ°äº†<span class="highlight">4 * 8 * (60 / 5) = 384</span>ï¼Œæ•ˆç‡å‡ ä¹æ˜¯åŸæ¥çš„å››å€ã€‚</p><blockquote><p>è¿™ç§æ–¹æ¡ˆå¹¶æ²¡æœ‰å‡å°‘æ¯ä½ç—…äººçš„çœ‹ç—…æ—¶é—´ï¼Œåè€Œç”šè‡³æœ‰æ‰€å¢åŠ ã€‚ä½†å¯¹äºæ•´ä¸ªæµç¨‹ï¼ˆç³»ç»Ÿï¼‰è€Œè¨€æé«˜äº†ååé‡ï¼Œå³å•ä½æ—¶é—´å†…å¤„ç†çš„äº‹ä»¶æ•°é‡</p></blockquote><p>è¦ç‚¹</p><ul><li>å•çº¿ç¨‹æ²¡æ³•å¼‚æ­¥æé«˜æ•ˆç‡ï¼Œå¿…é¡»é…åˆå¤šçº¿ç¨‹ã€å¤šæ ¸ cpu æ‰èƒ½å‘æŒ¥å¼‚æ­¥çš„ä¼˜åŠ¿</li><li>å¼‚æ­¥å¹¶æ²¡æœ‰ç¼©çŸ­å“åº”æ—¶é—´ï¼Œåè€Œæœ‰æ‰€å¢åŠ </li><li>åˆç†è¿›è¡Œä»»åŠ¡æ‹†åˆ†ï¼Œä¹Ÿæ˜¯åˆ©ç”¨å¼‚æ­¥çš„å…³é”®</li></ul><h3 id="_4ã€future-promise" tabindex="-1"><a class="header-anchor" href="#_4ã€future-promise"><span>4ã€Future &amp; Promise</span></a></h3><p>åœ¨å¼‚æ­¥å¤„ç†æ—¶ç»å¸¸ç”¨åˆ°è¿™ä¸¤ä¸ªæ¥å£ï¼Œé¦–å…ˆè¦è¯´æ˜ Netty ä¸­çš„ Future ä¸ JDK ä¸­çš„ Future åŒåï¼Œä½†æ˜¯æ˜¯ä¸¤ä¸ªæ¥å£ã€‚Netty çš„ Future ç»§æ‰¿è‡ª JDK çš„ Futureï¼Œè€Œ Promise åˆå¯¹ Netty Future è¿›è¡Œäº†æ‰©å±•ã€‚</p><ul><li>JDK Future åªèƒ½åŒæ­¥ç­‰å¾…ä»»åŠ¡ç»“æŸï¼ˆæˆ–æˆåŠŸã€æˆ–å¤±è´¥ï¼‰æ‰èƒ½å¾—åˆ°ç»“æœ</li><li>Netty Future å¯ä»¥åŒæ­¥ç­‰å¾…ä»»åŠ¡ç»“æŸå¾—åˆ°ç»“æœï¼Œä¹Ÿå¯ä»¥å¼‚æ­¥æ–¹å¼å¾—åˆ°ç»“æœï¼Œä½†éƒ½æ˜¯è¦ç­‰ä»»åŠ¡ç»“æŸ</li><li>Netty Promise ä¸ä»…æœ‰ Netty Future çš„åŠŸèƒ½ï¼Œè€Œä¸”è„±ç¦»äº†ä»»åŠ¡ç‹¬ç«‹å­˜åœ¨ï¼Œåªä½œä¸ºä¸¤ä¸ªçº¿ç¨‹é—´ä¼ é€’ç»“æœçš„å®¹å™¨</li></ul><table><thead><tr><th>åŠŸèƒ½/åç§°</th><th>JDK Future</th><th>Netty Future</th><th>Promise</th></tr></thead><tbody><tr><td>cancel</td><td>å–æ¶ˆä»»åŠ¡</td><td>-</td><td>-</td></tr><tr><td>isCanceled</td><td>ä»»åŠ¡æ˜¯å¦å–æ¶ˆ</td><td>-</td><td>-</td></tr><tr><td>isDone</td><td>ä»»åŠ¡æ˜¯å¦å®Œæˆï¼Œä¸èƒ½åŒºåˆ†æˆåŠŸå¤±è´¥</td><td>-</td><td>-</td></tr><tr><td>get</td><td>è·å–ä»»åŠ¡ç»“æœï¼Œé˜»å¡ç­‰å¾…</td><td>-</td><td>-</td></tr><tr><td>getNow</td><td>-</td><td>è·å–ä»»åŠ¡ç»“æœï¼Œéé˜»å¡ï¼Œè¿˜æœªäº§ç”Ÿç»“æœæ—¶è¿”å› null</td><td>-</td></tr><tr><td>await</td><td>-</td><td>ç­‰å¾…ä»»åŠ¡ç»“æŸï¼Œå¦‚æœä»»åŠ¡å¤±è´¥ï¼Œä¸ä¼šæŠ›å¼‚å¸¸ï¼Œè€Œæ˜¯é€šè¿‡ isSuccess åˆ¤æ–­</td><td>-</td></tr><tr><td>sync</td><td>-</td><td>ç­‰å¾…ä»»åŠ¡ç»“æŸï¼Œå¦‚æœä»»åŠ¡å¤±è´¥ï¼ŒæŠ›å‡ºå¼‚å¸¸</td><td>-</td></tr><tr><td>isSuccess</td><td>-</td><td>åˆ¤æ–­ä»»åŠ¡æ˜¯å¦æˆåŠŸ</td><td>-</td></tr><tr><td>cause</td><td>-</td><td>è·å–å¤±è´¥ä¿¡æ¯ï¼Œéé˜»å¡ï¼Œå¦‚æœæ²¡æœ‰å¤±è´¥ï¼Œè¿”å›null</td><td>-</td></tr><tr><td>addListener</td><td>-</td><td>æ·»åŠ å›è°ƒï¼Œå¼‚æ­¥æ¥æ”¶ç»“æœ</td><td>-</td></tr><tr><td>setSuccess</td><td>-</td><td>-</td><td>è®¾ç½®æˆåŠŸç»“æœ</td></tr><tr><td>setFailure</td><td>-</td><td>-</td><td>è®¾ç½®å¤±è´¥ç»“æœ</td></tr></tbody></table><h4 id="ä¾‹1" tabindex="-1"><a class="header-anchor" href="#ä¾‹1"><span>ä¾‹1</span></a></h4><p>åŒæ­¥å¤„ç†ä»»åŠ¡æˆåŠŸ</p>`,30);function B(O,q){const l=p("ExternalLinkIcon"),e=p("CodeGroupItem"),c=p("CodeGroup"),i=p("Badge");return k(),r("div",null,[g,n("p",null,[s("ä»–è¿˜æ˜¯å¦ä¸€ä¸ªè‘—åçš„é«˜æ€§èƒ½ Java ç½‘ç»œæ¡†æ¶ "),n("a",f,[s("Mina"),a(l)]),s(" çš„é‡è¦è´¡çŒ®è€…")]),w,a(c,null,{default:t(()=>[a(e,{title:"å®¢æˆ·ç«¯"},{default:t(()=>[C]),_:1}),a(e,{title:"è¾“å‡º"},{default:t(()=>[E]),_:1})]),_:1}),L,a(c,null,{default:t(()=>[a(e,{title:"æœåŠ¡ç«¯"},{default:t(()=>[S]),_:1}),a(e,{title:"å®¢æˆ·ç«¯"},{default:t(()=>[N]),_:1}),a(e,{title:"è¾“å‡º"},{default:t(()=>[x]),_:1})]),_:1}),_,a(i,{type:"warning",text:"io.netty.channel.AbstractChannelHandlerContext#invokeChannelRead()",vertical:"middle"}),I,a(c,null,{default:t(()=>[a(e,{title:"å®¢æˆ·ç«¯"},{default:t(()=>[j]),_:1}),a(e,{title:"æœåŠ¡ç«¯"},{default:t(()=>[G]),_:1})]),_:1}),F])}const A=u(y,[["render",B],["__file","02-Nettyå…¥é—¨.html.vue"]]),H=JSON.parse('{"path":"/back-end/netty/02-Netty%E5%85%A5%E9%97%A8.html","title":"Nettyå…¥é—¨","lang":"zh-CN","frontmatter":{"author":"kingsley"},"headers":[{"level":2,"title":"ä¸€ã€æ¦‚è¿°","slug":"ä¸€ã€æ¦‚è¿°","link":"#ä¸€ã€æ¦‚è¿°","children":[{"level":3,"title":"1ã€Netty æ˜¯ä»€ä¹ˆï¼Ÿ","slug":"_1ã€netty-æ˜¯ä»€ä¹ˆ","link":"#_1ã€netty-æ˜¯ä»€ä¹ˆ","children":[]},{"level":3,"title":"2ã€Netty çš„ä½œè€…","slug":"_2ã€netty-çš„ä½œè€…","link":"#_2ã€netty-çš„ä½œè€…","children":[]},{"level":3,"title":"3ã€Netty çš„åœ°ä½","slug":"_3ã€netty-çš„åœ°ä½","link":"#_3ã€netty-çš„åœ°ä½","children":[]},{"level":3,"title":"4ã€Netty çš„ä¼˜åŠ¿","slug":"_4ã€netty-çš„ä¼˜åŠ¿","link":"#_4ã€netty-çš„ä¼˜åŠ¿","children":[]}]},{"level":2,"title":"äºŒã€å¿«é€Ÿå…¥é—¨","slug":"äºŒã€å¿«é€Ÿå…¥é—¨","link":"#äºŒã€å¿«é€Ÿå…¥é—¨","children":[{"level":3,"title":"1ã€ç›®æ ‡","slug":"_1ã€ç›®æ ‡","link":"#_1ã€ç›®æ ‡","children":[]},{"level":3,"title":"2ã€æœåŠ¡å™¨ç«¯","slug":"_2ã€æœåŠ¡å™¨ç«¯","link":"#_2ã€æœåŠ¡å™¨ç«¯","children":[]},{"level":3,"title":"3ã€å®¢æˆ·ç«¯","slug":"_3ã€å®¢æˆ·ç«¯","link":"#_3ã€å®¢æˆ·ç«¯","children":[]},{"level":3,"title":"4ã€æµç¨‹æ¢³ç†","slug":"_4ã€æµç¨‹æ¢³ç†","link":"#_4ã€æµç¨‹æ¢³ç†","children":[]}]},{"level":2,"title":"ä¸‰ã€ç»„ä»¶","slug":"ä¸‰ã€ç»„ä»¶","link":"#ä¸‰ã€ç»„ä»¶","children":[{"level":3,"title":"1ã€EventLoop","slug":"_1ã€eventloop","link":"#_1ã€eventloop","children":[]},{"level":3,"title":"2ã€EventLoopGroup","slug":"_2ã€eventloopgroup","link":"#_2ã€eventloopgroup","children":[]},{"level":3,"title":"3ã€Channel","slug":"_3ã€channel","link":"#_3ã€channel","children":[]},{"level":3,"title":"4ã€Future & Promise","slug":"_4ã€future-promise","link":"#_4ã€future-promise","children":[]}]}],"git":{"updatedTime":1713459469000},"filePathRelative":"back-end/netty/02-Nettyå…¥é—¨.md"}');export{A as comp,H as data};
