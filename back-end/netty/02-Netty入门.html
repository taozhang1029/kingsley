<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-rc.9" />
    <style>
      :root {
        --c-bg: #fff;
      }
      html.dark {
        --c-bg: #22272e;
      }
      html,
      body {
        background-color: var(--c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme')
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia('(prefers-color-scheme: dark)').matches
      if (userMode === 'dark' || (userMode !== 'light' && systemDarkMode)) {
        document.documentElement.classList.toggle('dark', true)
      }
    </script>
    <link rel="icon" href="/blog/favicon.ico"><title>Nettyå…¥é—¨ | Codingæ¸¸ä¹åœº</title><meta name="description" content="Codingæ¸¸ä¹åœº">
    <link rel="preload" href="/blog/assets/style-DEFP7AcT.css" as="style"><link rel="stylesheet" href="/blog/assets/style-DEFP7AcT.css">
    <link rel="modulepreload" href="/blog/assets/app-C8q1F3U4.js"><link rel="modulepreload" href="/blog/assets/02-Nettyå…¥é—¨.html-B1_2iwVw.js">
    <link rel="prefetch" href="/blog/assets/index.html-CM_MGe8h.js" as="script"><link rel="prefetch" href="/blog/assets/Docker_Prometheus_Grafanaéƒ¨ç½²ç›‘æ§.html-Bggs-NKw.js" as="script"><link rel="prefetch" href="/blog/assets/github-image-bed.html-C7k0ayiF.js" as="script"><link rel="prefetch" href="/blog/assets/ollama.html-CUY6J5o3.js" as="script"><link rel="prefetch" href="/blog/assets/235.html-Bk-utPBl.js" as="script"><link rel="prefetch" href="/blog/assets/2476.html-BrSrf_Bn.js" as="script"><link rel="prefetch" href="/blog/assets/938.html-Cln_binc.js" as="script"><link rel="prefetch" href="/blog/assets/BM1. åè½¬é“¾è¡¨.html-Blc8rYrj.js" as="script"><link rel="prefetch" href="/blog/assets/01-NIOåŸºç¡€.html-Bcbw18Tv.js" as="script"><link rel="prefetch" href="/blog/assets/Drools.html-65BQ2mcx.js" as="script"><link rel="prefetch" href="/blog/assets/LiteFlow.html-D5qkULfv.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-D3KIKIFw.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-BPehFEjY.js" as="script"><link rel="prefetch" href="/blog/assets/flutter.html-1MJ0FDM9.js" as="script"><link rel="prefetch" href="/blog/assets/react-native.html-B98TmppC.js" as="script"><link rel="prefetch" href="/blog/assets/uni-app.html-B-tKu9xj.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-ByV2eD9O.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-CpGDXsYa.js" as="script"><link rel="prefetch" href="/blog/assets/404.html-Qh14C9k1.js" as="script"><link rel="prefetch" href="/blog/assets/AlgorithmQuestion-CWcLNwMs.js" as="script"><link rel="prefetch" href="/blog/assets/mermaid-wrapper-DlC8BFfk.js" as="script"><link rel="prefetch" href="/blog/assets/giscus-7BMGhbDA.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><!--[--><header class="navbar"><div class="toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a class="route-link" href="/blog/"><!----><span class="site-name" aria-hidden="true">Codingæ¸¸ä¹åœº</span></a></span><div class="navbar-items-wrapper" style=""><!--[--><!--]--><nav class="navbar-items can-hide" aria-label="site navigation"><!--[--><div class="navbar-item"><a class="external-link" href="https://github.com/taozhang1029" rel="noopener noreferrer" target="_blank" aria-label="Github"><!--[--><!--]--> Github <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><button class="toggle-color-mode-button" title="toggle color mode"><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><form class="search-box" role="search"><input type="search" autocomplete="off" spellcheck="false" value><!----></form></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><nav class="navbar-items" aria-label="site navigation"><!--[--><div class="navbar-item"><a class="external-link" href="https://github.com/taozhang1029" rel="noopener noreferrer" target="_blank" aria-label="Github"><!--[--><!--]--> Github <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><ul class="sidebar-items"><!--[--><li><p tabindex="0" class="sidebar-item sidebar-heading active collapsible">åç«¯ <span class="down arrow"></span></p><ul style="" class="sidebar-item-children"><!--[--><li style=""><p tabindex="0" class="sidebar-item active collapsible">Netty <span class="down arrow"></span></p><ul style="" class="sidebar-item-children"><!--[--><li style=""><a class="route-link sidebar-item" href="/blog/back-end/netty/01-NIO%E5%9F%BA%E7%A1%80.html" aria-label="NIOåŸºç¡€"><!--[--><!--]--> NIOåŸºç¡€ <!--[--><!--]--></a><!----></li><li style=""><a class="route-link route-link-active sidebar-item active" href="/blog/back-end/netty/02-Netty%E5%85%A5%E9%97%A8.html" aria-label="Nettyå…¥é—¨"><!--[--><!--]--> Nettyå…¥é—¨ <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li style="display:none;"><a class="route-link sidebar-item" href="#ä¸€ã€æ¦‚è¿°" aria-label="ä¸€ã€æ¦‚è¿°"><!--[--><!--]--> ä¸€ã€æ¦‚è¿° <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li style="display:none;"><a class="route-link sidebar-item" href="#_1ã€netty-æ˜¯ä»€ä¹ˆ" aria-label="1ã€Netty æ˜¯ä»€ä¹ˆï¼Ÿ"><!--[--><!--]--> 1ã€Netty æ˜¯ä»€ä¹ˆï¼Ÿ <!--[--><!--]--></a><!----></li><li style="display:none;"><a class="route-link sidebar-item" href="#_2ã€netty-çš„ä½œè€…" aria-label="2ã€Netty çš„ä½œè€…"><!--[--><!--]--> 2ã€Netty çš„ä½œè€… <!--[--><!--]--></a><!----></li><li style="display:none;"><a class="route-link sidebar-item" href="#_3ã€netty-çš„åœ°ä½" aria-label="3ã€Netty çš„åœ°ä½"><!--[--><!--]--> 3ã€Netty çš„åœ°ä½ <!--[--><!--]--></a><!----></li><li style="display:none;"><a class="route-link sidebar-item" href="#_4ã€netty-çš„ä¼˜åŠ¿" aria-label="4ã€Netty çš„ä¼˜åŠ¿"><!--[--><!--]--> 4ã€Netty çš„ä¼˜åŠ¿ <!--[--><!--]--></a><!----></li><!--]--></ul></li><li style="display:none;"><a class="route-link sidebar-item" href="#äºŒã€å¿«é€Ÿå…¥é—¨" aria-label="äºŒã€å¿«é€Ÿå…¥é—¨"><!--[--><!--]--> äºŒã€å¿«é€Ÿå…¥é—¨ <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li style="display:none;"><a class="route-link sidebar-item" href="#_1ã€ç›®æ ‡" aria-label="1ã€ç›®æ ‡"><!--[--><!--]--> 1ã€ç›®æ ‡ <!--[--><!--]--></a><!----></li><li style="display:none;"><a class="route-link sidebar-item" href="#_2ã€æœåŠ¡å™¨ç«¯" aria-label="2ã€æœåŠ¡å™¨ç«¯"><!--[--><!--]--> 2ã€æœåŠ¡å™¨ç«¯ <!--[--><!--]--></a><!----></li><li style="display:none;"><a class="route-link sidebar-item" href="#_3ã€å®¢æˆ·ç«¯" aria-label="3ã€å®¢æˆ·ç«¯"><!--[--><!--]--> 3ã€å®¢æˆ·ç«¯ <!--[--><!--]--></a><!----></li><li style="display:none;"><a class="route-link sidebar-item" href="#_4ã€æµç¨‹æ¢³ç†" aria-label="4ã€æµç¨‹æ¢³ç†"><!--[--><!--]--> 4ã€æµç¨‹æ¢³ç† <!--[--><!--]--></a><!----></li><!--]--></ul></li><li style="display:none;"><a class="route-link sidebar-item" href="#ä¸‰ã€ç»„ä»¶" aria-label="ä¸‰ã€ç»„ä»¶"><!--[--><!--]--> ä¸‰ã€ç»„ä»¶ <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li style="display:none;"><a class="route-link sidebar-item" href="#_1ã€eventloop" aria-label="1ã€EventLoop"><!--[--><!--]--> 1ã€EventLoop <!--[--><!--]--></a><!----></li><li style="display:none;"><a class="route-link sidebar-item" href="#_2ã€eventloopgroup" aria-label="2ã€EventLoopGroup"><!--[--><!--]--> 2ã€EventLoopGroup <!--[--><!--]--></a><!----></li><li style="display:none;"><a class="route-link sidebar-item" href="#_3ã€channel" aria-label="3ã€Channel"><!--[--><!--]--> 3ã€Channel <!--[--><!--]--></a><!----></li><li style="display:none;"><a class="route-link sidebar-item" href="#_4ã€future-promise" aria-label="4ã€Future &amp; Promise"><!--[--><!--]--> 4ã€Future &amp; Promise <!--[--><!--]--></a><!----></li><!--]--></ul></li><!--]--></ul></li><!--]--></ul></li><li style=""><p tabindex="0" class="sidebar-item collapsible">è§„åˆ™å¼•æ“ <span class="right arrow"></span></p><ul style="display:none;" class="sidebar-item-children"><!--[--><li style=""><a class="route-link sidebar-item" href="/blog/back-end/rule-engine/" aria-label="è§„åˆ™å¼•æ“æ¦‚è¿°"><!--[--><!--]--> è§„åˆ™å¼•æ“æ¦‚è¿° <!--[--><!--]--></a><!----></li><li style=""><a class="route-link sidebar-item" href="/blog/back-end/rule-engine/LiteFlow.html" aria-label="LiteFlowå®æˆ˜"><!--[--><!--]--> LiteFlowå®æˆ˜ <!--[--><!--]--></a><!----></li><li style=""><a class="route-link sidebar-item" href="/blog/back-end/rule-engine/Drools.html" aria-label="Droolså®æˆ˜"><!--[--><!--]--> Droolså®æˆ˜ <!--[--><!--]--></a><!----></li><!--]--></ul></li><!--]--></ul></li><li><p tabindex="0" class="sidebar-item sidebar-heading collapsible">å‰ç«¯ <span class="right arrow"></span></p><!----></li><li><p tabindex="0" class="sidebar-item sidebar-heading collapsible">ç§»åŠ¨ç«¯ <span class="right arrow"></span></p><ul style="display:none;" class="sidebar-item-children"><!--[--><li style=""><p tabindex="0" class="sidebar-item collapsible">å®‰å“å¼€å‘ <span class="right arrow"></span></p><ul style="display:none;" class="sidebar-item-children"><!--[--><li style=""><a class="route-link sidebar-item" href="/blog/mobile/android/" aria-label="åŸç”Ÿå®‰å“"><!--[--><!--]--> åŸç”Ÿå®‰å“ <!--[--><!--]--></a><!----></li><li style=""><a class="route-link sidebar-item" href="/blog/mobile/android/flutter.html" aria-label="flutter"><!--[--><!--]--> flutter <!--[--><!--]--></a><!----></li><li style=""><a class="route-link sidebar-item" href="/blog/mobile/android/react-native.html" aria-label="React Native"><!--[--><!--]--> React Native <!--[--><!--]--></a><!----></li><li style=""><a class="route-link sidebar-item" href="/blog/mobile/android/uni-app.html" aria-label="uni-app"><!--[--><!--]--> uni-app <!--[--><!--]--></a><!----></li><!--]--></ul></li><li style=""><p tabindex="0" class="sidebar-item collapsible">IOSå¼€å‘ <span class="right arrow"></span></p><ul style="display:none;" class="sidebar-item-children"><!--[--><li style=""><a class="route-link sidebar-item" href="/blog/mobile/ios/" aria-label="IOSå­¦ä¹ "><!--[--><!--]--> IOSå­¦ä¹  <!--[--><!--]--></a><!----></li><!--]--></ul></li><li style=""><p tabindex="0" class="sidebar-item collapsible">å°ç¨‹åºå¼€å‘ <span class="right arrow"></span></p><ul style="display:none;" class="sidebar-item-children"><!--[--><li style=""><a class="route-link sidebar-item" href="/blog/mobile/mini-program/" aria-label="å°ç¨‹åºå­¦ä¹ "><!--[--><!--]--> å°ç¨‹åºå­¦ä¹  <!--[--><!--]--></a><!----></li><!--]--></ul></li><!--]--></ul></li><li><p tabindex="0" class="sidebar-item sidebar-heading collapsible">ç®—æ³•é¢˜ <span class="right arrow"></span></p><ul style="display:none;" class="sidebar-item-children"><!--[--><li style=""><p tabindex="0" class="sidebar-item collapsible">Leetcode <span class="right arrow"></span></p><ul style="display:none;" class="sidebar-item-children"><!--[--><li style=""><a class="route-link sidebar-item" href="/blog/algorithm/leetcode/235.html" aria-label="235. äºŒå‰æœç´¢æ ‘çš„æœ€è¿‘å…¬å…±ç¥–å…ˆ"><!--[--><!--]--> 235. äºŒå‰æœç´¢æ ‘çš„æœ€è¿‘å…¬å…±ç¥–å…ˆ <!--[--><!--]--></a><!----></li><li style=""><a class="route-link sidebar-item" href="/blog/algorithm/leetcode/938.html" aria-label="938. äºŒå‰æœç´¢æ ‘çš„èŒƒå›´å’Œ"><!--[--><!--]--> 938. äºŒå‰æœç´¢æ ‘çš„èŒƒå›´å’Œ <!--[--><!--]--></a><!----></li><li style=""><a class="route-link sidebar-item" href="/blog/algorithm/leetcode/2476.html" aria-label="2476. äºŒå‰æœç´¢æ ‘æœ€è¿‘èŠ‚ç‚¹æŸ¥è¯¢"><!--[--><!--]--> 2476. äºŒå‰æœç´¢æ ‘æœ€è¿‘èŠ‚ç‚¹æŸ¥è¯¢ <!--[--><!--]--></a><!----></li><!--]--></ul></li><li style=""><p tabindex="0" class="sidebar-item collapsible">ç‰›å®¢ <span class="right arrow"></span></p><ul style="display:none;" class="sidebar-item-children"><!--[--><li style=""><a class="route-link sidebar-item" href="/blog/algorithm/newcoder/BM1.%20%E5%8F%8D%E8%BD%AC%E9%93%BE%E8%A1%A8.html" aria-label="1. åè½¬é“¾è¡¨"><!--[--><!--]--> 1. åè½¬é“¾è¡¨ <!--[--><!--]--></a><!----></li><!--]--></ul></li><!--]--></ul></li><li><p tabindex="0" class="sidebar-item sidebar-heading collapsible">ç¯å¢ƒæ­å»º <span class="right arrow"></span></p><ul style="display:none;" class="sidebar-item-children"><!--[--><li style=""><a class="route-link sidebar-item" href="/blog/env/Docker_Prometheus_Grafana%E9%83%A8%E7%BD%B2%E7%9B%91%E6%8E%A7.html" aria-label="Prometheus+Grafanaæ­å»ºç›‘æ§"><!--[--><!--]--> Prometheus+Grafanaæ­å»ºç›‘æ§ <!--[--><!--]--></a><!----></li><li style=""><a class="route-link sidebar-item" href="/blog/env/github-image-bed.html" aria-label="å¦‚ä½•åŸºäºGitHubæ­å»ºè‡ªå·±çš„å›¾åºŠï¼Ÿ"><!--[--><!--]--> å¦‚ä½•åŸºäºGitHubæ­å»ºè‡ªå·±çš„å›¾åºŠï¼Ÿ <!--[--><!--]--></a><!----></li><li style=""><a class="route-link sidebar-item" href="/blog/env/ollama.html" aria-label="å¦‚ä½•æ­å»ºä¸€ä¸ªè‡ªå·±çš„å¤§æ¨¡å‹æœåŠ¡ï¼Ÿ"><!--[--><!--]--> å¦‚ä½•æ­å»ºä¸€ä¸ªè‡ªå·±çš„å¤§æ¨¡å‹æœåŠ¡ï¼Ÿ <!--[--><!--]--></a><!----></li><!--]--></ul></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><div class="anchor-right" data-v-b4a30246><div class="anchor-right-content" data-v-b4a30246><ul data-v-b4a30246><!--[--><!--[--><li class="level level-2" data-v-b4a30246><div class="">ä¸€ã€æ¦‚è¿°</div><ul class="menu"><!--[--><!--[--><li class="level level-3">1ã€Netty æ˜¯ä»€ä¹ˆï¼Ÿ</li><!--]--><!--[--><li class="level level-3">2ã€Netty çš„ä½œè€…</li><!--]--><!--[--><li class="level level-3">3ã€Netty çš„åœ°ä½</li><!--]--><!--[--><li class="level level-3">4ã€Netty çš„ä¼˜åŠ¿</li><!--]--><!--]--></ul></li><!--]--><!--[--><li class="level level-2" data-v-b4a30246><div class="">äºŒã€å¿«é€Ÿå…¥é—¨</div><ul class="menu"><!--[--><!--[--><li class="level level-3">1ã€ç›®æ ‡</li><!--]--><!--[--><li class="level level-3">2ã€æœåŠ¡å™¨ç«¯</li><!--]--><!--[--><li class="level level-3">3ã€å®¢æˆ·ç«¯</li><!--]--><!--[--><li class="level level-3">4ã€æµç¨‹æ¢³ç†</li><!--]--><!--]--></ul></li><!--]--><!--[--><li class="level level-2" data-v-b4a30246><div class="">ä¸‰ã€ç»„ä»¶</div><ul class="menu"><!--[--><!--[--><li class="level level-3">1ã€EventLoop</li><!--]--><!--[--><li class="level level-3">2ã€EventLoopGroup</li><!--]--><!--[--><li class="level level-3">3ã€Channel</li><!--]--><!--[--><li class="level level-3">4ã€Future &amp; Promise</li><!--]--><!--]--></ul></li><!--]--><!--]--></ul></div></div><!--[--><!--]--><div><h1 id="nettyå…¥é—¨" tabindex="-1"><a class="header-anchor" href="#nettyå…¥é—¨"><span>Nettyå…¥é—¨</span></a></h1><h2 id="ä¸€ã€æ¦‚è¿°" tabindex="-1"><a class="header-anchor" href="#ä¸€ã€æ¦‚è¿°"><span>ä¸€ã€æ¦‚è¿°</span></a></h2><h3 id="_1ã€netty-æ˜¯ä»€ä¹ˆ" tabindex="-1"><a class="header-anchor" href="#_1ã€netty-æ˜¯ä»€ä¹ˆ"><span>1ã€Netty æ˜¯ä»€ä¹ˆï¼Ÿ</span></a></h3><blockquote><p>Netty is an asynchronous event-driven network application framework for rapid development of maintainable high performance protocol servers &amp; clients.</p></blockquote><p>Netty æ˜¯ä¸€ä¸ª<strong>å¼‚æ­¥</strong>çš„ã€<strong>åŸºäºäº‹ä»¶é©±åŠ¨</strong>çš„<strong>ç½‘ç»œåº”ç”¨æ¡†æ¶</strong>ï¼Œç”¨äºå¿«é€Ÿå¼€å‘å¯ç»´æŠ¤ã€é«˜æ€§èƒ½çš„ç½‘ç»œæœåŠ¡å™¨å’Œå®¢æˆ·ç«¯ã€‚</p><blockquote><p>åº•å±‚åŸºäº NIO ï¼Œæ‰€ä»¥ Netty è¿è¡Œåœ¨ JVM ä¸Šã€‚</p></blockquote><h3 id="_2ã€netty-çš„ä½œè€…" tabindex="-1"><a class="header-anchor" href="#_2ã€netty-çš„ä½œè€…"><span>2ã€Netty çš„ä½œè€…</span></a></h3><p><img src="/blog/assets/19-DjudAkp7.png" alt=""></p><p>ä»–è¿˜æ˜¯å¦ä¸€ä¸ªè‘—åçš„é«˜æ€§èƒ½ Java ç½‘ç»œæ¡†æ¶ <a href="https://mina.apache.org/mina-project/quick-start-guide.html" target="_blank" rel="noopener noreferrer">Mina<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> çš„é‡è¦è´¡çŒ®è€…</p><h3 id="_3ã€netty-çš„åœ°ä½" tabindex="-1"><a class="header-anchor" href="#_3ã€netty-çš„åœ°ä½"><span>3ã€Netty çš„åœ°ä½</span></a></h3><p>Netty åœ¨ Java ç½‘ç»œåº”ç”¨æ¡†æ¶ä¸­çš„åœ°ä½å°±å¥½æ¯”ï¼šSpring æ¡†æ¶åœ¨ JavaEE å¼€å‘ä¸­çš„åœ°ä½</p><p>ä»¥ä¸‹çš„æ¡†æ¶éƒ½ä½¿ç”¨äº† Nettyï¼Œå› ä¸ºå®ƒä»¬æœ‰ç½‘ç»œé€šä¿¡éœ€æ±‚ï¼</p><ul><li>Cassandra - nosql æ•°æ®åº“</li><li>Spark - å¤§æ•°æ®åˆ†å¸ƒå¼è®¡ç®—æ¡†æ¶</li><li>Hadoop - å¤§æ•°æ®åˆ†å¸ƒå¼å­˜å‚¨æ¡†æ¶</li><li>RocketMQ - ali å¼€æºçš„æ¶ˆæ¯é˜Ÿåˆ—</li><li>ElasticSearch - æœç´¢å¼•æ“</li><li>gRPC - rpc æ¡†æ¶</li><li>Dubbo - rpc æ¡†æ¶</li><li>Spring 5.x - flux api å®Œå…¨æŠ›å¼ƒäº† tomcat ï¼Œä½¿ç”¨ netty ä½œä¸ºæœåŠ¡å™¨ç«¯</li><li>Zookeeper - åˆ†å¸ƒå¼åè°ƒæ¡†æ¶</li></ul><h3 id="_4ã€netty-çš„ä¼˜åŠ¿" tabindex="-1"><a class="header-anchor" href="#_4ã€netty-çš„ä¼˜åŠ¿"><span>4ã€Netty çš„ä¼˜åŠ¿</span></a></h3><ul><li>Netty vs NIOï¼Œå·¥ä½œé‡å¤§ï¼Œbug å¤š <ul><li>éœ€è¦è‡ªå·±æ„å»ºåè®®</li><li>è§£å†³ TCP ä¼ è¾“é—®é¢˜ï¼Œå¦‚ç²˜åŒ…ã€åŠåŒ…</li><li>epoll ç©ºè½®è¯¢å¯¼è‡´ CPU 100%</li><li>å¯¹ API è¿›è¡Œå¢å¼ºï¼Œä½¿ä¹‹æ›´æ˜“ç”¨ï¼Œå¦‚ FastThreadLocal =&gt; ThreadLocalï¼ŒByteBuf =&gt; ByteBuffer</li></ul></li><li>Netty vs å…¶å®ƒç½‘ç»œåº”ç”¨æ¡†æ¶ <ul><li>Mina ç”± apache ç»´æŠ¤ï¼Œå°†æ¥ 3.x ç‰ˆæœ¬å¯èƒ½ä¼šæœ‰è¾ƒå¤§é‡æ„ï¼Œç ´å API å‘ä¸‹å…¼å®¹æ€§ï¼ŒNetty çš„å¼€å‘è¿­ä»£æ›´è¿…é€Ÿï¼ŒAPI æ›´ç®€æ´ã€æ–‡æ¡£æ›´ä¼˜ç§€</li><li>ä¹…ç»è€ƒéªŒï¼Œ16å¹´ï¼ŒNetty ç‰ˆæœ¬ <ul><li>2.x 2004</li><li>3.x 2008</li><li>4.x 2013</li><li>5.x å·²åºŸå¼ƒï¼ˆæ²¡æœ‰æ˜æ˜¾çš„æ€§èƒ½æå‡ï¼Œç»´æŠ¤æˆæœ¬é«˜ï¼‰</li></ul></li></ul></li></ul><h2 id="äºŒã€å¿«é€Ÿå…¥é—¨" tabindex="-1"><a class="header-anchor" href="#äºŒã€å¿«é€Ÿå…¥é—¨"><span>äºŒã€å¿«é€Ÿå…¥é—¨</span></a></h2><h3 id="_1ã€ç›®æ ‡" tabindex="-1"><a class="header-anchor" href="#_1ã€ç›®æ ‡"><span>1ã€ç›®æ ‡</span></a></h3><p>å¼€å‘ä¸€ä¸ªç®€å•çš„æœåŠ¡å™¨ç«¯å’Œå®¢æˆ·ç«¯</p><ul><li>å®¢æˆ·ç«¯å‘æœåŠ¡å™¨ç«¯å‘é€ hello, world</li><li>æœåŠ¡å™¨ä»…æ¥æ”¶ï¼Œä¸è¿”å›</li></ul><p>åŠ å…¥ä¾èµ–</p><div class="language-xml line-numbers-mode" data-ext="xml" data-title="xml"><pre class="language-xml"><code>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>io.netty<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>netty-all<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>4.1.59.Final<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2ã€æœåŠ¡å™¨ç«¯" tabindex="-1"><a class="header-anchor" href="#_2ã€æœåŠ¡å™¨ç«¯"><span>2ã€æœåŠ¡å™¨ç«¯</span></a></h3><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>bootstrap<span class="token punctuation">.</span></span><span class="token class-name">ServerBootstrap</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span></span><span class="token class-name">ChannelHandlerContext</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span></span><span class="token class-name">ChannelInboundHandlerAdapter</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span></span><span class="token class-name">ChannelInitializer</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span>nio<span class="token punctuation">.</span></span><span class="token class-name">NioEventLoopGroup</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span>socket<span class="token punctuation">.</span>nio<span class="token punctuation">.</span></span><span class="token class-name">NioServerSocketChannel</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span>socket<span class="token punctuation">.</span>nio<span class="token punctuation">.</span></span><span class="token class-name">NioSocketChannel</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>handler<span class="token punctuation">.</span>codec<span class="token punctuation">.</span>string<span class="token punctuation">.</span></span><span class="token class-name">StringDecoder</span></span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
 * nettyæœåŠ¡ç«¯
 *
 * <span class="token keyword">@author</span> kingsley
 * <span class="token keyword">@date</span> 2024/4/7 21:41
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HelloServer</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 1ã€å¯åŠ¨å™¨ï¼Œè´Ÿè´£ç»„è£…nettyç»„ä»¶ï¼Œå¯åŠ¨æœåŠ¡å™¨</span>
        <span class="token keyword">new</span> <span class="token class-name">ServerBootstrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token comment">/*
                 * 2ã€åˆ›å»º NioEventLoopGroupï¼Œå¯ä»¥ç®€å•ç†è§£ä¸º BossEventLoop å’Œ WorkerEventLoop(selector, thread)
                 * NioEventLoopGroup åŒ…å« BossEventLoop å’Œ WorkerEventLoopï¼Œå¯ç®€å•ç†è§£ä¸ºNIOåŸºç¡€ä¸­å­¦åˆ°çš„ Boss å’Œ Worker
                 * WorkerEventLoopä¸­æœ‰æœ€é‡è¦çš„ä¸¤éƒ¨åˆ†ï¼šselectorï¼Œçº¿ç¨‹ã€‚
                 *  - selectorï¼šç”¨äºç›‘å¬å®¢æˆ·ç«¯è¿æ¥ã€å¤„ç†ç½‘ç»œäº‹ä»¶ï¼ˆå¯è¯»ã€å¯å†™ï¼‰ï¼›
                 *  - threadï¼šå¤„ç†å…·ä½“çš„ç½‘ç»œäº‹ä»¶ï¼Œå……åˆ†åˆ©ç”¨CPU
                 */</span>
                <span class="token punctuation">.</span><span class="token function">group</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">NioEventLoopGroup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token comment">/*
                 * 3ã€é€‰æ‹©æœåŠ¡å™¨çš„ServerSocketChannelå®ç°
                 *  - NioServerSocketChannelï¼šNIO
                 *  - OioServerSocketChannelï¼šBIO
                 * åœ¨å¯åŠ¨æ—¶ä¼šåå°„è°ƒç”¨NioServerSocketChannelçš„æ„é€ æ–¹æ³•ï¼Œåˆ›å»ºå¯¹è±¡
                 */</span>
                <span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token class-name">NioServerSocketChannel</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
                <span class="token comment">/*
                 * 4ã€bossè´Ÿè´£å¤„ç†è¿æ¥ï¼Œworkerï¼ˆchildï¼‰è´Ÿè´£å¤„ç†è¯»å†™ï¼Œå†³å®šäº†workerèƒ½æ‰§è¡Œå“ªäº›æ“ä½œï¼ˆhandlerï¼‰
                 */</span>
                <span class="token punctuation">.</span><span class="token function">childHandler</span><span class="token punctuation">(</span>
                        <span class="token comment">/*
                         * 5ã€æ·»åŠ å’Œå®¢æˆ·ç«¯è¿›è¡Œæ•°æ®è¯»å†™çš„é€šé“çš„åˆå§‹åŒ–å™¨ï¼Œå®ƒæœ¬èº«æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„handlerï¼Œå®ƒçš„ä½œç”¨æ˜¯ç®¡ç†ä¸€ç³»åˆ—çš„handlerï¼Œå¯ä»¥ç†è§£ä¸ºæ‹¦æˆªå™¨
                         * è¯¥æ–¹æ³•ä¸ä¼šç«‹å³æ‰§è¡Œåˆå§‹åŒ–æ“ä½œï¼Œè€Œæ˜¯ç­‰å¾…è¿æ¥å»ºç«‹åæ‰ä¼šæ‰§è¡Œåˆå§‹åŒ–
                         */</span>
                        <span class="token keyword">new</span> <span class="token class-name">ChannelInitializer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">NioSocketChannel</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                            <span class="token annotation punctuation">@Override</span>
                            <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">initChannel</span><span class="token punctuation">(</span><span class="token class-name">NioSocketChannel</span> ch<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                                <span class="token comment">/*
                                 * 6ã€æ·»åŠ å…·ä½“çš„handler
                                 *  - StringDecoderï¼šå°†æ¥æ”¶åˆ°çš„ByteBufè½¬æ¢ä¸ºå­—ç¬¦ä¸²
                                 *  - ChannelInboundHandlerAdapterï¼šè‡ªå®šä¹‰handler
                                 */</span>
                                ch<span class="token punctuation">.</span><span class="token function">pipeline</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">StringDecoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                                ch<span class="token punctuation">.</span><span class="token function">pipeline</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ChannelInboundHandlerAdapter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                                    <span class="token comment">/*
                                     * 7ã€channelReadå¤„ç†è¯»äº‹ä»¶
                                     */</span>
                                    <span class="token annotation punctuation">@Override</span>
                                    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">channelRead</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">,</span> <span class="token class-name">Object</span> msg<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                                        <span class="token comment">/*
                                         * 8ã€æ¥æ”¶åˆ°æ¶ˆæ¯å¹¶å¤„ç†ï¼Œè¿™é‡Œæ‰“å°ä¸Šä¸€æ­¥è½¬æ¢å¥½çš„å­—ç¬¦ä¸²
                                         */</span>
                                        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;æ”¶åˆ°çš„æ¶ˆæ¯ï¼š&quot;</span> <span class="token operator">+</span> msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
                                    <span class="token punctuation">}</span>
                                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                            <span class="token punctuation">}</span>
                        <span class="token punctuation">}</span><span class="token punctuation">)</span>
                <span class="token comment">/*
                 * 9ã€ç»‘å®šç›‘å¬ç«¯å£å¹¶å¯åŠ¨æœåŠ¡å™¨
                 */</span>
                <span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token number">8080</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="ä»£ç è§£è¯»" tabindex="-1"><a class="header-anchor" href="#ä»£ç è§£è¯»"><span>ä»£ç è§£è¯»</span></a></h4><ul><li>2å¤„ï¼Œåˆ›å»º NioEventLoopGroupï¼Œå¯ä»¥ç®€å•ç†è§£ä¸º çº¿ç¨‹æ±  + Selector åé¢ä¼šè¯¦ç»†å±•å¼€</li><li>3å¤„ï¼Œé€‰æ‹©æœåŠ¡ Scoket å®ç°ç±»ï¼Œå…¶ä¸­ NioServerSocketChannel è¡¨ç¤ºåŸºäº NIO çš„æœåŠ¡å™¨ç«¯å®ç°ï¼Œå…¶å®ƒå®ç°è¿˜æœ‰ <img src="/blog/assets/20-C9nmsGvS.png" alt="img.png"></li><li>4å¤„ï¼Œä¸ºå•¥æ–¹æ³•å« childHandlerï¼Œæ˜¯æ¥ä¸‹æ¥æ·»åŠ çš„å¤„ç†å™¨éƒ½æ˜¯ç»™ SocketChannel ç”¨çš„ï¼Œè€Œä¸æ˜¯ç»™ ServerSocketChannelã€‚ChannelInitializer å¤„ç†å™¨ï¼ˆä»…æ‰§è¡Œä¸€æ¬¡ï¼‰ï¼Œå®ƒçš„ä½œç”¨æ˜¯å¾…å®¢æˆ·ç«¯ SocketChannel å»ºç«‹è¿æ¥åï¼Œæ‰§è¡Œ initChannel ä»¥ä¾¿æ·»åŠ æ›´å¤šçš„å¤„ç†å™¨</li><li>6å¤„ï¼ŒSocketChannel çš„å¤„ç†å™¨ï¼Œè§£ç  ByteBuf =&gt; String</li><li>7å¤„ï¼ŒSocketChannel çš„ä¸šåŠ¡å¤„ç†å™¨ï¼Œä½¿ç”¨ä¸Šä¸€ä¸ªå¤„ç†å™¨çš„å¤„ç†ç»“æœ</li></ul><h3 id="_3ã€å®¢æˆ·ç«¯" tabindex="-1"><a class="header-anchor" href="#_3ã€å®¢æˆ·ç«¯"><span>3ã€å®¢æˆ·ç«¯</span></a></h3><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>bootstrap<span class="token punctuation">.</span></span><span class="token class-name">Bootstrap</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span></span><span class="token class-name">ChannelInitializer</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span>nio<span class="token punctuation">.</span></span><span class="token class-name">NioEventLoopGroup</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span>socket<span class="token punctuation">.</span>nio<span class="token punctuation">.</span></span><span class="token class-name">NioSocketChannel</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>handler<span class="token punctuation">.</span>codec<span class="token punctuation">.</span>string<span class="token punctuation">.</span></span><span class="token class-name">StringEncoder</span></span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
 * nettyå®¢æˆ·ç«¯
 * <span class="token keyword">@author</span> kingsley
 * <span class="token keyword">@date</span> 2024/4/7 22:02
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HelloClient</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
        <span class="token comment">// 1ã€åˆ›å»ºå®¢æˆ·ç«¯å¯åŠ¨å¯¹è±¡</span>
        <span class="token keyword">new</span> <span class="token class-name">Bootstrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token comment">// 2ã€æ·»åŠ EventLoop</span>
                <span class="token punctuation">.</span><span class="token function">group</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">NioEventLoopGroup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token comment">// 3ã€é€‰æ‹©å®¢æˆ·ç«¯channelå®ç°ç±»</span>
                <span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token class-name">NioSocketChannel</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
                <span class="token comment">// 4ã€æ·»åŠ å¤„ç†å™¨</span>
                <span class="token punctuation">.</span><span class="token function">handler</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ChannelInitializer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">NioSocketChannel</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token comment">// åˆå§‹åŒ–channelï¼Œåœ¨è¿æ¥æˆåŠŸä¹‹åè°ƒç”¨</span>
                    <span class="token annotation punctuation">@Override</span>
                    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">initChannel</span><span class="token punctuation">(</span><span class="token class-name">NioSocketChannel</span> ch<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token comment">// 5ã€å¾€pipelineé“¾ä¸­æ·»åŠ ä¸€ä¸ªhandlerå¤„ç†å™¨ï¼Œè¿™é‡Œä½¿ç”¨ StringEncoder å°†å­—ç¬¦ä¸²ç¼–ç æˆ ByteBuf</span>
                        ch<span class="token punctuation">.</span><span class="token function">pipeline</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">StringEncoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span>
                <span class="token comment">// 6ã€å¯åŠ¨å®¢æˆ·ç«¯è¿æ¥æœåŠ¡å™¨ï¼Œç­‰å¾…è¿æ¥æˆåŠŸ</span>
                <span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token string">&quot;127.0.0.1&quot;</span><span class="token punctuation">,</span> <span class="token number">8080</span><span class="token punctuation">)</span>
                <span class="token comment">// 7ã€é˜»å¡æ–¹æ³•ï¼Œç­‰å¾…è¿æ¥æˆåŠŸ</span>
                <span class="token punctuation">.</span><span class="token function">sync</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token comment">// 8ã€ä»£è¡¨è¿æ¥å¯¹è±¡ï¼Œå¯ä»¥ç†è§£ä¸ºé€šé“ï¼Œé€šè¿‡è¯¥å¯¹è±¡å¯ä»¥å‘é€æ¶ˆæ¯ç»™æœåŠ¡å™¨</span>
                <span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token comment">// 9ã€å‘æœåŠ¡å™¨å‘é€æ•°æ®</span>
                <span class="token punctuation">.</span><span class="token function">writeAndFlush</span><span class="token punctuation">(</span><span class="token string">&quot;hello, netty&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="ä»£ç è§£è¯»-1" tabindex="-1"><a class="header-anchor" href="#ä»£ç è§£è¯»-1"><span>ä»£ç è§£è¯»</span></a></h4><ul><li>2å¤„ï¼Œåˆ›å»º NioEventLoopGroupï¼ŒåŒ Server</li><li>3å¤„ï¼Œé€‰æ‹©å®¢æˆ·ç«¯ Socket å®ç°ç±»ï¼ŒNioSocketChannel è¡¨ç¤ºåŸºäº NIO çš„å®¢æˆ·ç«¯å®ç°ï¼Œå…¶å®ƒå®ç°è¿˜æœ‰ <img src="/blog/assets/21-C7h4pZcj.png" alt="img.png"></li><li>4å¤„ï¼Œæ·»åŠ  SocketChannel çš„å¤„ç†å™¨ï¼ŒChannelInitializer å¤„ç†å™¨ï¼ˆä»…æ‰§è¡Œä¸€æ¬¡ï¼‰ï¼Œå®ƒçš„ä½œç”¨æ˜¯å¾…å®¢æˆ·ç«¯ SocketChannel å»ºç«‹è¿æ¥åï¼Œæ‰§è¡Œ initChannel ä»¥ä¾¿æ·»åŠ æ›´å¤šçš„å¤„ç†å™¨</li><li>5å¤„ï¼Œæ¶ˆæ¯ä¼šç»è¿‡é€šé“ handler å¤„ç†ï¼Œè¿™é‡Œæ˜¯å°† String =&gt; ByteBuf å‘å‡º</li><li>6å¤„ï¼Œå¯åŠ¨å®¢æˆ·ç«¯è¿æ¥æœåŠ¡å™¨ï¼Œç­‰å¾…è¿æ¥æˆåŠŸ</li><li>7å¤„ï¼ŒNetty ä¸­å¾ˆå¤šæ–¹æ³•éƒ½æ˜¯å¼‚æ­¥çš„ï¼Œå¦‚ connectï¼Œè¿™æ—¶éœ€è¦ä½¿ç”¨ sync æ–¹æ³•ç­‰å¾… connect å»ºç«‹è¿æ¥å®Œæ¯•</li><li>8å¤„ï¼Œè·å– channel å¯¹è±¡ï¼Œå®ƒå³ä¸ºé€šé“æŠ½è±¡ï¼Œå¯ä»¥è¿›è¡Œæ•°æ®è¯»å†™æ“ä½œ</li><li>9å¤„ï¼Œå†™å…¥æ¶ˆæ¯å¹¶æ¸…ç©ºç¼“å†²åŒº</li></ul><h3 id="_4ã€æµç¨‹æ¢³ç†" tabindex="-1"><a class="header-anchor" href="#_4ã€æµç¨‹æ¢³ç†"><span>4ã€æµç¨‹æ¢³ç†</span></a></h3><p><img src="/blog/assets/22-jTVPEuhQ.png" alt="img.png"></p><p>ğŸ’¡ æç¤º</p><blockquote><p><strong>ä¸€å¼€å§‹éœ€è¦æ ‘ç«‹æ­£ç¡®çš„è§‚å¿µ</strong></p><ul><li>æŠŠ channel ç†è§£ä¸ºæ•°æ®çš„é€šé“</li><li>æŠŠ msg ç†è§£ä¸ºæµåŠ¨çš„æ•°æ®ï¼Œæœ€å¼€å§‹è¾“å…¥æ˜¯ ByteBufï¼Œä½†ç»è¿‡ pipeline çš„åŠ å·¥ï¼Œä¼šå˜æˆå…¶å®ƒç±»å‹å¯¹è±¡ï¼Œæœ€åè¾“å‡ºåˆå˜æˆ ByteBuf</li><li>æŠŠ handler ç†è§£ä¸ºæ•°æ®çš„å¤„ç†å·¥åº</li></ul></blockquote><ul><li>å·¥åºæœ‰å¤šé“ï¼Œåˆåœ¨ä¸€èµ·å°±æ˜¯ pipelineï¼Œpipeline è´Ÿè´£å‘å¸ƒäº‹ä»¶ï¼ˆè¯»ã€è¯»å–å®Œæˆ...ï¼‰ä¼ æ’­ç»™æ¯ä¸ª handlerï¼Œ handler å¯¹è‡ªå·±æ„Ÿå…´è¶£çš„äº‹ä»¶è¿›è¡Œå¤„ç†ï¼ˆé‡å†™äº†ç›¸åº”äº‹ä»¶å¤„ç†æ–¹æ³•ï¼‰</li></ul><blockquote><ul><li>handler åˆ† Inbound å’Œ Outbound ä¸¤ç±»</li><li>æŠŠ eventLoop ç†è§£ä¸ºå¤„ç†æ•°æ®çš„å·¥äºº</li></ul></blockquote><ul><li>å·¥äººå¯ä»¥ç®¡ç†å¤šä¸ª channel çš„ IO æ“ä½œï¼Œå¹¶ä¸”ä¸€æ—¦å·¥äººè´Ÿè´£äº†æŸä¸ª channelï¼Œå°±è¦è´Ÿè´£åˆ°åº•ï¼ˆç»‘å®šï¼‰ï¼Œç›®çš„æ˜¯ä¸ºäº†çº¿ç¨‹å®‰å…¨ã€‚ <blockquote><p>æ€»ç»“èµ·æ¥å°±è¯´æ˜¯ï¼š<strong>ä¸€ä¸ª eventLoop åªè´Ÿè´£ä¸€ä¸ª NioEventLoopGroup ä¸­çš„ä¸€ä¸ªçº¿ç¨‹ï¼Œè¿™ä¸ªçº¿ç¨‹å¯ä»¥ç®¡ç†å¤šä¸ª channelï¼Œä½†ä¸€ä¸ª channel åªèƒ½ç”±ä¸€ä¸ª eventLoop ç®¡ç†</strong></p></blockquote></li></ul><blockquote><ul><li>å·¥äººæ—¢å¯ä»¥æ‰§è¡Œ IO æ“ä½œï¼Œä¹Ÿå¯ä»¥è¿›è¡Œä»»åŠ¡å¤„ç†ï¼Œæ¯ä½å·¥äººæœ‰ä»»åŠ¡é˜Ÿåˆ—ï¼Œé˜Ÿåˆ—é‡Œå¯ä»¥å †æ”¾å¤šä¸ª channel çš„å¾…å¤„ç†ä»»åŠ¡ï¼Œä»»åŠ¡åˆ†ä¸ºæ™®é€šä»»åŠ¡ã€å®šæ—¶ä»»åŠ¡</li></ul></blockquote><ul><li>å·¥äººæŒ‰ç…§ pipeline é¡ºåºï¼Œä¾æ¬¡æŒ‰ç…§ handler çš„è§„åˆ’ï¼ˆä»£ç ï¼‰å¤„ç†æ•°æ®ï¼Œå¯ä»¥ä¸ºæ¯é“å·¥åºæŒ‡å®šä¸åŒçš„å·¥äºº</li></ul><h2 id="ä¸‰ã€ç»„ä»¶" tabindex="-1"><a class="header-anchor" href="#ä¸‰ã€ç»„ä»¶"><span>ä¸‰ã€ç»„ä»¶</span></a></h2><h3 id="_1ã€eventloop" tabindex="-1"><a class="header-anchor" href="#_1ã€eventloop"><span>1ã€EventLoop</span></a></h3><p>äº‹ä»¶å¾ªç¯å¯¹è±¡ï¼Œæœ¬è´¨æ˜¯ä¸€ä¸ªå•çº¿ç¨‹æ‰§è¡Œå™¨ï¼ˆåŒæ—¶ç»´æŠ¤äº†ä¸€ä¸ª Selectorï¼‰ï¼Œé‡Œé¢æœ‰ run æ–¹æ³•å¤„ç† Channel ä¸Šæºæºä¸æ–­çš„ IO äº‹ä»¶ã€‚</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">OrderedEventExecutor</span></span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
 * Will handle all the I/O operations for a <span class="token punctuation">{</span><span class="token keyword">@link</span> <span class="token reference"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span></span><span class="token class-name">Channel</span></span><span class="token punctuation">}</span> once registered.
 * One <span class="token punctuation">{</span><span class="token keyword">@link</span> <span class="token reference"><span class="token class-name">EventLoop</span></span><span class="token punctuation">}</span> instance will usually handle more than one <span class="token punctuation">{</span><span class="token keyword">@link</span> <span class="token reference"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span></span><span class="token class-name">Channel</span></span><span class="token punctuation">}</span> but this may depend on
 * implementation details and internals.
 *
 */</span>
<span class="token annotation punctuation">@SuppressWarnings</span><span class="token punctuation">(</span><span class="token string">&quot;all&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">EventLoop</span> <span class="token keyword">extends</span> <span class="token class-name">OrderedEventExecutor</span><span class="token punctuation">,</span> <span class="token class-name">EventLoopGroup</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token class-name">EventLoopGroup</span> <span class="token function">parent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å®ƒçš„ç»§æ‰¿å…³ç³»æ¯”è¾ƒå¤æ‚</p><ul><li>ä¸€æ¡çº¿æ˜¯ç»§æ‰¿è‡ª java.util.concurrent.ScheduledExecutorServiceï¼Œå› æ­¤åŒ…å«äº†çº¿ç¨‹æ± ä¸­æ‰€æœ‰çš„æ–¹æ³•</li><li>å¦ä¸€æ¡çº¿æ˜¯ç»§æ‰¿è‡ª netty è‡ªå·±çš„ OrderedEventExecutor <ul><li>æä¾›äº† boolean inEventLoop(Thread thread) æ–¹æ³•åˆ¤æ–­ä¸€ä¸ªçº¿ç¨‹æ˜¯å¦å±äºæ­¤ EventLoop</li><li>æä¾›äº† parent æ–¹æ³•æ¥çœ‹çœ‹è‡ªå·±å±äºå“ªä¸ª EventLoopGroup</li></ul></li></ul><h3 id="_2ã€eventloopgroup" tabindex="-1"><a class="header-anchor" href="#_2ã€eventloopgroup"><span>2ã€EventLoopGroup</span></a></h3><p>äº‹ä»¶å¾ªç¯ç»„ï¼Œæ˜¯ä¸€ç»„ EventLoopã€‚Channel ä¸€èˆ¬ä¼šè°ƒç”¨ EventLoopGroup çš„ register æ–¹æ³•æ¥ç»‘å®šå…¶ä¸­ä¸€ä¸ª EventLoopï¼Œåç»­è¿™ä¸ª Channel ä¸Šçš„ IO äº‹ä»¶éƒ½ç”±æ­¤ EventLoop æ¥å¤„ç†ï¼ˆä¿è¯äº† IO äº‹ä»¶å¤„ç†æ—¶çš„çº¿ç¨‹å®‰å…¨ï¼‰</p><ul><li>ç»§æ‰¿è‡ª netty è‡ªå·±çš„ EventExecutorGroup <ul><li>å®ç°äº† Iterable æ¥å£æä¾›éå† EventLoop çš„èƒ½åŠ›</li><li>å¦æœ‰ next æ–¹æ³•è·å–é›†åˆä¸­ä¸‹ä¸€ä¸ª EventLoop</li></ul></li></ul><p>ä»¥ä¸€ä¸ªç®€å•çš„å®ç°ä¸ºä¾‹ï¼š</p><div class="code-group"><div class="code-group__nav" role="tablist"><button class="code-group__nav-tab code-group__nav-tab-active" role="tab" ariaselected="true">å®¢æˆ·ç«¯</button><button class="code-group__nav-tab" role="tab" ariaselected="false">è¾“å‡º</button></div><!--[--><div class="code-group-item" role="tabpanel"><!--[--><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>kingsley<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>c2</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span></span><span class="token class-name">EventLoopGroup</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span>nio<span class="token punctuation">.</span></span><span class="token class-name">NioEventLoopGroup</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">EventExecutor</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">lombok<span class="token punctuation">.</span>extern<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span></span><span class="token class-name">Slf4j</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">TimeUnit</span></span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
 * EventLoopæµ‹è¯•
 *
 * <span class="token keyword">@author</span> kingsley
 * <span class="token keyword">@date</span> 2024/4/7 23:46
 */</span>
<span class="token annotation punctuation">@Slf4j</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestEventLoop</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
        <span class="token comment">/*
         * 1ã€åˆ›å»ºäº‹ä»¶å¾ªç¯ç»„ï¼Œè¿™é‡Œè®¾ç½®2ä¸ªçº¿ç¨‹ï¼Œ2ä¸ªçº¿ç¨‹å°±æ˜¯2ä¸ªEventLoop
         * NioEventLoopGroupï¼šå¯å¤„ç†IOäº‹ä»¶ã€æ™®é€šä»»åŠ¡ã€å®šæ—¶ä»»åŠ¡
         * DefaultEventLoopGroupï¼šå¤„ç†æ™®é€šä»»åŠ¡ã€å®šæ—¶ä»»åŠ¡
         */</span>
        <span class="token class-name">EventLoopGroup</span> group <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">NioEventLoopGroup</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 2ã€è·å–ä¸‹ä¸€ä¸ªäº‹ä»¶å¾ªç¯å¯¹è±¡</span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;EventLoop: {}&quot;</span><span class="token punctuation">,</span> group<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;EventLoop: {}&quot;</span><span class="token punctuation">,</span> group<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;EventLoop: {}&quot;</span><span class="token punctuation">,</span> group<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;---------&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// ä¹Ÿå¯ä»¥ä½¿ç”¨ for å¾ªç¯</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">EventExecutor</span> eventLoop <span class="token operator">:</span> group<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;EventLoop: {}&quot;</span><span class="token punctuation">,</span> eventLoop<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// å¤„ç†æ™®é€šä»»åŠ¡</span>
        group<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;æ‰§è¡Œæ™®é€šä»»åŠ¡&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// å¤„ç†å®šæ—¶ä»»åŠ¡</span>
        group<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">schedule</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;æ‰§è¡Œå®šæ—¶ä»»åŠ¡1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span><span class="token constant">MILLISECONDS</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        group<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">schedule</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;æ‰§è¡Œå®šæ—¶ä»»åŠ¡2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span><span class="token constant">MILLISECONDS</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// é˜»å¡ä¸»çº¿ç¨‹</span>
        <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span><span class="token constant">MILLISECONDS</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 3ã€ä¼˜é›…çš„å…³é—­</span>
        group<span class="token punctuation">.</span><span class="token function">shutdownGracefully</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;main&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><!--]--></div><div class="code-group-item" role="tabpanel"><!--[--><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token number">2024</span>-04-08 00:09:05.465 INFO  <span class="token punctuation">[</span>main<span class="token punctuation">]</span> com.kingsley.netty.c2.TestEventLoop               <span class="token builtin class-name">:</span> EventLoop: io.netty.channel.nio.NioEventLoop@28feb3fa
<span class="token number">2024</span>-04-08 00:09:05.465 INFO  <span class="token punctuation">[</span>main<span class="token punctuation">]</span> com.kingsley.netty.c2.TestEventLoop               <span class="token builtin class-name">:</span> EventLoop: io.netty.channel.nio.NioEventLoop@675d3402
<span class="token number">2024</span>-04-08 00:09:05.465 INFO  <span class="token punctuation">[</span>main<span class="token punctuation">]</span> com.kingsley.netty.c2.TestEventLoop               <span class="token builtin class-name">:</span> EventLoop: io.netty.channel.nio.NioEventLoop@28feb3fa
<span class="token number">2024</span>-04-08 00:09:05.465 INFO  <span class="token punctuation">[</span>main<span class="token punctuation">]</span> com.kingsley.netty.c2.TestEventLoop               <span class="token builtin class-name">:</span> ---------
<span class="token number">2024</span>-04-08 00:09:05.465 INFO  <span class="token punctuation">[</span>main<span class="token punctuation">]</span> com.kingsley.netty.c2.TestEventLoop               <span class="token builtin class-name">:</span> EventLoop: io.netty.channel.nio.NioEventLoop@28feb3fa
<span class="token number">2024</span>-04-08 00:09:05.465 INFO  <span class="token punctuation">[</span>main<span class="token punctuation">]</span> com.kingsley.netty.c2.TestEventLoop               <span class="token builtin class-name">:</span> EventLoop: io.netty.channel.nio.NioEventLoop@675d3402
<span class="token number">2024</span>-04-08 00:09:05.551 INFO  <span class="token punctuation">[</span>nioEventLoopGroup-2-2<span class="token punctuation">]</span> com.kingsley.netty.c2.TestEventLoop               <span class="token builtin class-name">:</span> æ‰§è¡Œå®šæ—¶ä»»åŠ¡1
<span class="token number">2024</span>-04-08 00:09:05.741 INFO  <span class="token punctuation">[</span>main<span class="token punctuation">]</span> com.kingsley.netty.c2.TestEventLoop               <span class="token builtin class-name">:</span> main
<span class="token number">2024</span>-04-08 00:09:06.545 INFO  <span class="token punctuation">[</span>nioEventLoopGroup-2-1<span class="token punctuation">]</span> com.kingsley.netty.c2.TestEventLoop               <span class="token builtin class-name">:</span> æ‰§è¡Œæ™®é€šä»»åŠ¡
<span class="token number">2024</span>-04-08 00:09:06.546 INFO  <span class="token punctuation">[</span>nioEventLoopGroup-2-1<span class="token punctuation">]</span> com.kingsley.netty.c2.TestEventLoop               <span class="token builtin class-name">:</span> æ‰§è¡Œå®šæ—¶ä»»åŠ¡2
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><!--]--></div><!--]--></div><h4 id="ğŸ’¡-ä¼˜é›…å…³é—­" tabindex="-1"><a class="header-anchor" href="#ğŸ’¡-ä¼˜é›…å…³é—­"><span>ğŸ’¡ ä¼˜é›…å…³é—­</span></a></h4><p>ä¼˜é›…å…³é—­ shutdownGracefully æ–¹æ³•ã€‚è¯¥æ–¹æ³•ä¼šé¦–å…ˆåˆ‡æ¢ EventLoopGroup åˆ°å…³é—­çŠ¶æ€ä»è€Œæ‹’ç»æ–°çš„ä»»åŠ¡çš„åŠ å…¥ï¼Œç„¶ååœ¨ä»»åŠ¡é˜Ÿåˆ—çš„ä»»åŠ¡éƒ½å¤„ç†å®Œæˆåï¼Œåœæ­¢çº¿ç¨‹çš„è¿è¡Œã€‚ä»è€Œç¡®ä¿æ•´ä½“åº”ç”¨æ˜¯åœ¨æ­£å¸¸æœ‰åºçš„çŠ¶æ€ä¸‹é€€å‡ºçš„</p><h4 id="nioeventloop-å¤„ç†-io-äº‹ä»¶" tabindex="-1"><a class="header-anchor" href="#nioeventloop-å¤„ç†-io-äº‹ä»¶"><span>NioEventLoop å¤„ç† io äº‹ä»¶</span></a></h4><p>æœåŠ¡å™¨ç«¯ä¸¤ä¸ª nio worker å·¥äººï¼Œé…ç½®å››ä¸ªå®¢æˆ·ç«¯ï¼Œé€šè¿‡å‘½ä»¤è¡Œå‚æ•°è®¾ç½®å®¢æˆ·ç«¯IDï¼Œç„¶åå¿«é€Ÿä¾æ¬¡å¯åŠ¨</p><p><img src="/blog/assets/clientCnnfig-Dw3hu83V.png" alt="img.png"><img src="https://cdn.jsdelivr.net/gh/taozhang1029/static-repository@master/img/202404172353544.png" alt=""></p><div class="code-group"><div class="code-group__nav" role="tablist"><button class="code-group__nav-tab code-group__nav-tab-active" role="tab" ariaselected="true">æœåŠ¡ç«¯</button><button class="code-group__nav-tab" role="tab" ariaselected="false">å®¢æˆ·ç«¯</button><button class="code-group__nav-tab" role="tab" ariaselected="false">è¾“å‡º</button></div><!--[--><div class="code-group-item" role="tabpanel"><!--[--><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>kingsley<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>c3</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>bootstrap<span class="token punctuation">.</span></span><span class="token class-name">ServerBootstrap</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>buffer<span class="token punctuation">.</span></span><span class="token class-name">ByteBuf</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span></span><span class="token class-name">ChannelHandlerContext</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span></span><span class="token class-name">ChannelInboundHandlerAdapter</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span></span><span class="token class-name">ChannelInitializer</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span>nio<span class="token punctuation">.</span></span><span class="token class-name">NioEventLoopGroup</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span>socket<span class="token punctuation">.</span>nio<span class="token punctuation">.</span></span><span class="token class-name">NioServerSocketChannel</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span>socket<span class="token punctuation">.</span>nio<span class="token punctuation">.</span></span><span class="token class-name">NioSocketChannel</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">lombok<span class="token punctuation">.</span>extern<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span></span><span class="token class-name">Slf4j</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>nio<span class="token punctuation">.</span>charset<span class="token punctuation">.</span></span><span class="token class-name">Charset</span></span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
 * <span class="token keyword">@author</span> kingsley
 * <span class="token keyword">@date</span> 2024/4/17 22:43
 */</span>
<span class="token annotation punctuation">@Slf4j</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">EventLoopServer</span> <span class="token punctuation">{</span>

    <span class="token doc-comment comment">/**
     * ä¸»ç¨‹åºå…¥å£ã€‚
     * ä½¿ç”¨ServerBootstrapå¯åŠ¨ä¸€ä¸ªæœåŠ¡å™¨ï¼Œé…ç½®ä½¿ç”¨NIOä¼ è¾“ï¼Œç»‘å®šåˆ°8080ç«¯å£ã€‚
     * å¯¹æ¯ä¸ªæ–°è¿æ¥ï¼Œä½¿ç”¨ChannelInitializeråˆå§‹åŒ–Channelï¼ŒåŠ å…¥è‡ªå®šä¹‰çš„ChannelInboundHandlerAdapterä»¥å¤„ç†å…¥ç«™äº‹ä»¶ã€‚
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">new</span> <span class="token class-name">ServerBootstrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// åˆ›å»ºServerBootstrapå®ä¾‹ï¼Œç”¨äºå¯åŠ¨æœåŠ¡å™¨</span>
                <span class="token punctuation">.</span><span class="token function">group</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">NioEventLoopGroup</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">NioEventLoopGroup</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// æŒ‡å®šä½¿ç”¨NIOäº‹ä»¶å¾ªç¯ç»„</span>
                <span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token class-name">NioServerSocketChannel</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span> <span class="token comment">// æŒ‡å®šä½¿ç”¨NIOæœåŠ¡å™¨å¥—æ¥å­—é€šé“</span>
                <span class="token punctuation">.</span><span class="token function">childHandler</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ChannelInitializer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">NioSocketChannel</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// å®šä¹‰å­é€šé“ï¼ˆå³æ¯ä¸ªæ–°è¿æ¥ï¼‰çš„åˆå§‹åŒ–å¤„ç†å™¨</span>
                    <span class="token annotation punctuation">@Override</span>
                    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">initChannel</span><span class="token punctuation">(</span><span class="token class-name">NioSocketChannel</span> ch<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
                        ch<span class="token punctuation">.</span><span class="token function">pipeline</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ChannelInboundHandlerAdapter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// å‘é€šé“å¤„ç†é“¾ä¸­æ·»åŠ è‡ªå®šä¹‰çš„å…¥ç«™äº‹ä»¶å¤„ç†å™¨</span>
                            <span class="token annotation punctuation">@Override</span>
                            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">channelRead</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">,</span> <span class="token class-name">Object</span> msg<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// å½“æœ‰æ•°æ®è¯»å–æ—¶</span>
                                <span class="token class-name">ByteBuf</span> buf <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">ByteBuf</span><span class="token punctuation">)</span> msg<span class="token punctuation">;</span> <span class="token comment">// å°†æ¥æ”¶åˆ°çš„æ¶ˆæ¯è½¬æ¢ä¸ºByteBufç±»å‹</span>
                                log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;receive: {}&quot;</span><span class="token punctuation">,</span> buf<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token class-name">Charset</span><span class="token punctuation">.</span><span class="token function">defaultCharset</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// æ‰“å°æ¥æ”¶åˆ°çš„æ•°æ®</span>
                            <span class="token punctuation">}</span>
                        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token number">8080</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ç»‘å®šåˆ°8080ç«¯å£å¹¶å¯åŠ¨æœåŠ¡å™¨</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><!--]--></div><div class="code-group-item" role="tabpanel"><!--[--><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>kingsley<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>c3</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>bootstrap<span class="token punctuation">.</span></span><span class="token class-name">Bootstrap</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span></span><span class="token class-name">Channel</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span></span><span class="token class-name">ChannelInitializer</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span>nio<span class="token punctuation">.</span></span><span class="token class-name">NioEventLoopGroup</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span>socket<span class="token punctuation">.</span>nio<span class="token punctuation">.</span></span><span class="token class-name">NioSocketChannel</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>handler<span class="token punctuation">.</span>codec<span class="token punctuation">.</span>string<span class="token punctuation">.</span></span><span class="token class-name">StringEncoder</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">lombok<span class="token punctuation">.</span>extern<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span></span><span class="token class-name">Slf4j</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Arrays</span></span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
 * nettyå®¢æˆ·ç«¯
 *
 * <span class="token keyword">@author</span> kingsley
 * <span class="token keyword">@date</span> 2024/4/7 22:02
 */</span>
<span class="token annotation punctuation">@Slf4j</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">EventLoopClient</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
        <span class="token comment">// 1ã€åˆ›å»ºå®¢æˆ·ç«¯å¯åŠ¨å¯¹è±¡</span>
        <span class="token class-name">Channel</span> channel <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Bootstrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token comment">// 2ã€æ·»åŠ EventLoop</span>
                <span class="token punctuation">.</span><span class="token function">group</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">NioEventLoopGroup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token comment">// 3ã€é€‰æ‹©å®¢æˆ·ç«¯channelå®ç°ç±»</span>
                <span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token class-name">NioSocketChannel</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
                <span class="token comment">// 4ã€æ·»åŠ å¤„ç†å™¨</span>
                <span class="token punctuation">.</span><span class="token function">handler</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ChannelInitializer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">NioSocketChannel</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token comment">// åˆå§‹åŒ–channelï¼Œåœ¨è¿æ¥æˆåŠŸä¹‹åè°ƒç”¨</span>
                    <span class="token annotation punctuation">@Override</span>
                    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">initChannel</span><span class="token punctuation">(</span><span class="token class-name">NioSocketChannel</span> ch<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token comment">// 5ã€å¾€pipelineé“¾ä¸­æ·»åŠ ä¸€ä¸ªhandlerå¤„ç†å™¨ï¼Œè¿™é‡Œä½¿ç”¨ StringEncoder å°†å­—ç¬¦ä¸²ç¼–ç æˆ ByteBuf</span>
                        ch<span class="token punctuation">.</span><span class="token function">pipeline</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">StringEncoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span>
                <span class="token comment">// 6ã€å¯åŠ¨å®¢æˆ·ç«¯è¿æ¥æœåŠ¡å™¨ï¼Œç­‰å¾…è¿æ¥æˆåŠŸ</span>
                <span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token string">&quot;127.0.0.1&quot;</span><span class="token punctuation">,</span> <span class="token number">8080</span><span class="token punctuation">)</span>
                <span class="token comment">// é˜»å¡æ–¹æ³•ï¼Œç­‰å¾…è¿æ¥æˆåŠŸ</span>
                <span class="token punctuation">.</span><span class="token function">sync</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token comment">// ä»£è¡¨è¿æ¥å¯¹è±¡</span>
                <span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> clientId <span class="token operator">=</span> args<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;å®¢æˆ·ç«¯è¿æ¥æˆåŠŸï¼Œchannel: {}, clientId: {}&quot;</span><span class="token punctuation">,</span> channel<span class="token punctuation">,</span> clientId<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 7ã€å‘æœåŠ¡å™¨å‘é€æ•°æ®</span>
        channel<span class="token punctuation">.</span><span class="token function">writeAndFlush</span><span class="token punctuation">(</span>clientId <span class="token operator">+</span> <span class="token string">&quot; ===&gt; hello, netty1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">10000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        channel<span class="token punctuation">.</span><span class="token function">writeAndFlush</span><span class="token punctuation">(</span>clientId <span class="token operator">+</span> <span class="token string">&quot;hello, netty2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><!--]--></div><div class="code-group-item" role="tabpanel"><!--[--><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token number">2024</span>-04-17 <span class="token number">23</span>:55:39.875 DEBUG <span class="token punctuation">[</span>nioEventLoopGroup-3-1<span class="token punctuation">]</span> io.netty.util.Recycler                            <span class="token builtin class-name">:</span> -Dio.netty.recycler.maxCapacityPerThread: <span class="token number">4096</span>
<span class="token number">2024</span>-04-17 <span class="token number">23</span>:55:39.876 DEBUG <span class="token punctuation">[</span>nioEventLoopGroup-3-1<span class="token punctuation">]</span> io.netty.util.Recycler                            <span class="token builtin class-name">:</span> -Dio.netty.recycler.maxSharedCapacityFactor: <span class="token number">2</span>
<span class="token number">2024</span>-04-17 <span class="token number">23</span>:55:39.876 DEBUG <span class="token punctuation">[</span>nioEventLoopGroup-3-1<span class="token punctuation">]</span> io.netty.util.Recycler                            <span class="token builtin class-name">:</span> -Dio.netty.recycler.linkCapacity: <span class="token number">16</span>
<span class="token number">2024</span>-04-17 <span class="token number">23</span>:55:39.876 DEBUG <span class="token punctuation">[</span>nioEventLoopGroup-3-1<span class="token punctuation">]</span> io.netty.util.Recycler                            <span class="token builtin class-name">:</span> -Dio.netty.recycler.ratio: <span class="token number">8</span>
<span class="token number">2024</span>-04-17 <span class="token number">23</span>:55:39.876 DEBUG <span class="token punctuation">[</span>nioEventLoopGroup-3-1<span class="token punctuation">]</span> io.netty.util.Recycler                            <span class="token builtin class-name">:</span> -Dio.netty.recycler.delayedQueue.ratio: <span class="token number">8</span>
<span class="token number">2024</span>-04-17 <span class="token number">23</span>:55:39.889 DEBUG <span class="token punctuation">[</span>nioEventLoopGroup-3-1<span class="token punctuation">]</span> io.netty.buffer.AbstractByteBuf                   <span class="token builtin class-name">:</span> -Dio.netty.buffer.checkAccessible: <span class="token boolean">true</span>
<span class="token number">2024</span>-04-17 <span class="token number">23</span>:55:39.890 DEBUG <span class="token punctuation">[</span>nioEventLoopGroup-3-1<span class="token punctuation">]</span> io.netty.buffer.AbstractByteBuf                   <span class="token builtin class-name">:</span> -Dio.netty.buffer.checkBounds: <span class="token boolean">true</span>
<span class="token number">2024</span>-04-17 <span class="token number">23</span>:55:39.893 DEBUG <span class="token punctuation">[</span>nioEventLoopGroup-3-1<span class="token punctuation">]</span> io.netty.util.ResourceLeakDetectorFactory         <span class="token builtin class-name">:</span> Loaded default ResourceLeakDetector: io.netty.util.ResourceLeakDetector@452b789e
<span class="token number">2024</span>-04-17 <span class="token number">23</span>:55:39.899 INFO  <span class="token punctuation">[</span>nioEventLoopGroup-3-1<span class="token punctuation">]</span> com.kingsley.netty.c3.EventLoopServer             <span class="token builtin class-name">:</span> receive: client2 <span class="token operator">==</span><span class="token operator">=</span><span class="token operator">&gt;</span> hello, netty1
<span class="token number">2024</span>-04-17 <span class="token number">23</span>:55:40.430 INFO  <span class="token punctuation">[</span>nioEventLoopGroup-3-2<span class="token punctuation">]</span> com.kingsley.netty.c3.EventLoopServer             <span class="token builtin class-name">:</span> receive: client3 <span class="token operator">==</span><span class="token operator">=</span><span class="token operator">&gt;</span> hello, netty1
<span class="token number">2024</span>-04-17 <span class="token number">23</span>:55:41.053 INFO  <span class="token punctuation">[</span>nioEventLoopGroup-3-1<span class="token punctuation">]</span> com.kingsley.netty.c3.EventLoopServer             <span class="token builtin class-name">:</span> receive: client4 <span class="token operator">==</span><span class="token operator">=</span><span class="token operator">&gt;</span> hello, netty1
<span class="token number">2024</span>-04-17 <span class="token number">23</span>:55:41.603 INFO  <span class="token punctuation">[</span>nioEventLoopGroup-3-2<span class="token punctuation">]</span> com.kingsley.netty.c3.EventLoopServer             <span class="token builtin class-name">:</span> receive: client1 <span class="token operator">==</span><span class="token operator">=</span><span class="token operator">&gt;</span> hello, netty1
<span class="token number">2024</span>-04-17 <span class="token number">23</span>:55:49.858 INFO  <span class="token punctuation">[</span>nioEventLoopGroup-3-1<span class="token punctuation">]</span> com.kingsley.netty.c3.EventLoopServer             <span class="token builtin class-name">:</span> receive: client2 <span class="token operator">==</span><span class="token operator">=</span><span class="token operator">&gt;</span> hello, netty2
<span class="token number">2024</span>-04-17 <span class="token number">23</span>:55:50.419 INFO  <span class="token punctuation">[</span>nioEventLoopGroup-3-2<span class="token punctuation">]</span> com.kingsley.netty.c3.EventLoopServer             <span class="token builtin class-name">:</span> receive: client3 <span class="token operator">==</span><span class="token operator">=</span><span class="token operator">&gt;</span> hello, netty2
<span class="token number">2024</span>-04-17 <span class="token number">23</span>:55:51.045 INFO  <span class="token punctuation">[</span>nioEventLoopGroup-3-1<span class="token punctuation">]</span> com.kingsley.netty.c3.EventLoopServer             <span class="token builtin class-name">:</span> receive: client4 <span class="token operator">==</span><span class="token operator">=</span><span class="token operator">&gt;</span> hello, netty2
<span class="token number">2024</span>-04-17 <span class="token number">23</span>:55:51.599 INFO  <span class="token punctuation">[</span>nioEventLoopGroup-3-2<span class="token punctuation">]</span> com.kingsley.netty.c3.EventLoopServer             <span class="token builtin class-name">:</span> receive: client1 <span class="token operator">==</span><span class="token operator">=</span><span class="token operator">&gt;</span> hello, netty2
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><!--]--></div><!--]--></div><blockquote><ul><li>ä»å‰å››ä¸ªè¯»äº‹ä»¶æ—¥å¿—å¯ä»¥çœ‹å‡ºï¼ŒæœåŠ¡ç«¯ä¾æ¬¡ä½¿ç”¨ nioEventLoopGroup-3-1ã€nioEventLoopGroup-3-2 çº¿ç¨‹å¤„ç†å®¢æˆ·ç«¯çš„è¯·æ±‚ã€‚è¯æ˜ä¸€ä¸ªçº¿ç¨‹(EventLoop) å¯ä»¥å¤„ç†å¤šä¸ªå®¢æˆ·ç«¯çš„è¯·æ±‚ï¼Œå¹¶ä¸”æ˜¯é€šè¿‡è½®è¯¢çš„æ–¹å¼è·å–çº¿ç¨‹(EventLoop)æ¥å¤„ç†å®¢æˆ·ç«¯çš„è¯·æ±‚</li><li>æ ¹æ®åå››æ¬¡è¯»äº‹ä»¶æ—¥å¿—å¯ä»¥çœ‹å‡ºï¼Œå¯¹äºåŒä¸€ä¸ªå®¢æˆ·ç«¯è¿æ¥é€šé“ï¼ŒæœåŠ¡ç«¯ä½¿ç”¨ç›¸åŒçš„çº¿ç¨‹(EventLoop)å¤„ç†è¯·æ±‚</li></ul></blockquote><p><img src="https://cdn.jsdelivr.net/gh/taozhang1029/static-repository@master/img/202404180052346.png" alt=""></p><h4 id="â“ä¸Šè¿°æœåŠ¡ç«¯çš„ä»£ç æ˜¯å¦å­˜åœ¨é—®é¢˜å‘¢" tabindex="-1"><a class="header-anchor" href="#â“ä¸Šè¿°æœåŠ¡ç«¯çš„ä»£ç æ˜¯å¦å­˜åœ¨é—®é¢˜å‘¢"><span>â“ä¸Šè¿°æœåŠ¡ç«¯çš„ä»£ç æ˜¯å¦å­˜åœ¨é—®é¢˜å‘¢ï¼Ÿ</span></a></h4><p>ç”±äºæœåŠ¡ç«¯çš„ä¸€ä¸ªçº¿ç¨‹å¯èƒ½è¦å¤„ç†å¤šä¸ªå®¢æˆ·ç«¯çš„è¯·æ±‚ï¼Œå¦‚æœæŸä¸€ä¸ªå®¢æˆ·ç«¯çš„è¯·æ±‚å¤„ç†æ—¶é—´è¿‡é•¿ï¼Œé‚£ä¹ˆæœåŠ¡ç«¯çº¿ç¨‹å°±ä¼šé˜»å¡ï¼Œå¯¼è‡´å…¶ä»–å®¢æˆ·ç«¯çš„è¯·æ±‚æ— æ³•å¤„ç†ã€‚è¿™ç§æƒ…å†µä¸‹æœåŠ¡ç«¯çš„ååé‡å°±ä¼šå› ä¸ºä¸€ä¸ªå®¢æˆ·ç«¯çš„å½±å“è€Œä¸‹é™ã€‚</p><p>ğŸ’¡ è§£å†³æ–¹æ¡ˆ</p><p>åˆ›å»ºä¸€ä¸ªç‹¬ç«‹çš„ EventLoopGroup ä¸“é—¨å¤„ç†ä¸šåŠ¡é€»è¾‘</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>kingsley<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>c3</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>bootstrap<span class="token punctuation">.</span></span><span class="token class-name">ServerBootstrap</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>buffer<span class="token punctuation">.</span></span><span class="token class-name">ByteBuf</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span>nio<span class="token punctuation">.</span></span><span class="token class-name">NioEventLoopGroup</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span>socket<span class="token punctuation">.</span>nio<span class="token punctuation">.</span></span><span class="token class-name">NioServerSocketChannel</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span>socket<span class="token punctuation">.</span>nio<span class="token punctuation">.</span></span><span class="token class-name">NioSocketChannel</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">lombok<span class="token punctuation">.</span>extern<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span></span><span class="token class-name">Slf4j</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>nio<span class="token punctuation">.</span>charset<span class="token punctuation">.</span></span><span class="token class-name">Charset</span></span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
 * <span class="token keyword">@author</span> kingsley
 * <span class="token keyword">@date</span> 2024/4/17 22:43
 */</span>
<span class="token annotation punctuation">@Slf4j</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">EventLoopServer2</span> <span class="token punctuation">{</span>

    <span class="token doc-comment comment">/**
     * ä¸»ç¨‹åºå…¥å£ã€‚
     * ä½¿ç”¨ServerBootstrapå¯åŠ¨ä¸€ä¸ªæœåŠ¡å™¨ï¼Œé…ç½®ä½¿ç”¨NIOä¼ è¾“ï¼Œç»‘å®šåˆ°8080ç«¯å£ã€‚
     * å¯¹æ¯ä¸ªæ–°è¿æ¥ï¼Œä½¿ç”¨ChannelInitializeråˆå§‹åŒ–Channelï¼ŒåŠ å…¥è‡ªå®šä¹‰çš„ChannelInboundHandlerAdapterä»¥å¤„ç†å…¥ç«™äº‹ä»¶ã€‚
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// åˆ›å»ºä¸€ä¸ªç‹¬ç«‹çš„ EventLoopGroup</span>
        <span class="token class-name">EventLoopGroup</span> group <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DefaultEventLoopGroup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">new</span> <span class="token class-name">ServerBootstrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">group</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">NioEventLoopGroup</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">NioEventLoopGroup</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token class-name">NioServerSocketChannel</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">childHandler</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ChannelInitializer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">NioSocketChannel</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token annotation punctuation">@Override</span>
                    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">initChannel</span><span class="token punctuation">(</span><span class="token class-name">NioSocketChannel</span> ch<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        ch<span class="token punctuation">.</span><span class="token function">pipeline</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                                <span class="token comment">// ä½¿ç”¨ NioEventLoopGroup å¤„ç†</span>
                                <span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ChannelInboundHandlerAdapter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                                    <span class="token annotation punctuation">@Override</span>
                                    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">channelRead</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">,</span> <span class="token class-name">Object</span> msg<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                                        <span class="token class-name">ByteBuf</span> buf <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">ByteBuf</span><span class="token punctuation">)</span> msg<span class="token punctuation">;</span>
                                        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;receive: {}&quot;</span><span class="token punctuation">,</span> buf<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token class-name">Charset</span><span class="token punctuation">.</span><span class="token function">defaultCharset</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                                        <span class="token comment">// å°†æ¶ˆæ¯ä¼ é€’åˆ°ä¸‹ä¸€ä¸ª handler å¤„ç†ï¼Œå¿…é¡»åŠ è¿™ä¸€è¡Œä»£ç  ï¼ï¼ï¼ å¦åˆ™åœ¨è¿™å°±æ–­äº†ï¼Œä¸ä¼šå°†æ¶ˆæ¯äº¤ç»™åç»­ handler å¤„ç†</span>
                                        ctx<span class="token punctuation">.</span><span class="token function">fireChannelRead</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
                                    <span class="token punctuation">}</span>
                                <span class="token punctuation">}</span><span class="token punctuation">)</span>
                                <span class="token comment">// ä½¿ç”¨ DefaultEventLoop å¤„ç†</span>
                                <span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span>group<span class="token punctuation">,</span> <span class="token string">&quot;handler2&quot;</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">ChannelInboundHandlerAdapter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                                    <span class="token annotation punctuation">@Override</span>
                                    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">channelRead</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">,</span> <span class="token class-name">Object</span> msg<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                                        <span class="token class-name">ByteBuf</span> buf <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">ByteBuf</span><span class="token punctuation">)</span> msg<span class="token punctuation">;</span> <span class="token comment">// å°†æ¥æ”¶åˆ°çš„æ¶ˆæ¯è½¬æ¢ä¸ºByteBufç±»å‹</span>
                                        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;handler2 use defaultEventLoop process receive: {}&quot;</span><span class="token punctuation">,</span> buf<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token class-name">Charset</span><span class="token punctuation">.</span><span class="token function">defaultCharset</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                                    <span class="token punctuation">}</span>
                                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token number">8080</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å…ˆå¯åŠ¨æœåŠ¡ç«¯ï¼Œç„¶ååŒæ—¶å¯åŠ¨å®¢æˆ·ç«¯1ã€å®¢æˆ·ç«¯2ï¼ŒæœåŠ¡ç«¯è¾“å‡ºï¼š</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token number">2024</span>-04-18 00:28:42.995 INFO  <span class="token punctuation">[</span>nioEventLoopGroup-4-1<span class="token punctuation">]</span> com.kingsley.netty.c3.EventLoopServer2            <span class="token builtin class-name">:</span> receive: client2 <span class="token operator">==</span><span class="token operator">=</span><span class="token operator">&gt;</span> hello, netty1
<span class="token number">2024</span>-04-18 00:28:42.996 INFO  <span class="token punctuation">[</span>defaultEventLoopGroup-2-1<span class="token punctuation">]</span> com.kingsley.netty.c3.EventLoopServer2            <span class="token builtin class-name">:</span> handler2 use defaultEventLoop process receive: client2 <span class="token operator">==</span><span class="token operator">=</span><span class="token operator">&gt;</span> hello, netty1
<span class="token number">2024</span>-04-18 00:28:43.585 INFO  <span class="token punctuation">[</span>nioEventLoopGroup-4-2<span class="token punctuation">]</span> com.kingsley.netty.c3.EventLoopServer2            <span class="token builtin class-name">:</span> receive: client1 <span class="token operator">==</span><span class="token operator">=</span><span class="token operator">&gt;</span> hello, netty1
<span class="token number">2024</span>-04-18 00:28:43.586 INFO  <span class="token punctuation">[</span>defaultEventLoopGroup-2-2<span class="token punctuation">]</span> com.kingsley.netty.c3.EventLoopServer2            <span class="token builtin class-name">:</span> handler2 use defaultEventLoop process receive: client1 <span class="token operator">==</span><span class="token operator">=</span><span class="token operator">&gt;</span> hello, netty1
<span class="token number">2024</span>-04-18 00:28:52.970 INFO  <span class="token punctuation">[</span>nioEventLoopGroup-4-1<span class="token punctuation">]</span> com.kingsley.netty.c3.EventLoopServer2            <span class="token builtin class-name">:</span> receive: client2 <span class="token operator">==</span><span class="token operator">=</span><span class="token operator">&gt;</span> hello, netty2
<span class="token number">2024</span>-04-18 00:28:52.972 INFO  <span class="token punctuation">[</span>defaultEventLoopGroup-2-1<span class="token punctuation">]</span> com.kingsley.netty.c3.EventLoopServer2            <span class="token builtin class-name">:</span> handler2 use defaultEventLoop process receive: client2 <span class="token operator">==</span><span class="token operator">=</span><span class="token operator">&gt;</span> hello, netty2
<span class="token number">2024</span>-04-18 00:28:53.580 INFO  <span class="token punctuation">[</span>nioEventLoopGroup-4-2<span class="token punctuation">]</span> com.kingsley.netty.c3.EventLoopServer2            <span class="token builtin class-name">:</span> receive: client1 <span class="token operator">==</span><span class="token operator">=</span><span class="token operator">&gt;</span> hello, netty2
<span class="token number">2024</span>-04-18 00:28:53.583 INFO  <span class="token punctuation">[</span>defaultEventLoopGroup-2-2<span class="token punctuation">]</span> com.kingsley.netty.c3.EventLoopServer2            <span class="token builtin class-name">:</span> handler2 use defaultEventLoop process receive: client1 <span class="token operator">==</span><span class="token operator">=</span><span class="token operator">&gt;</span> hello, netty2
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¯ä»¥å‘ç°ç¬¬äºŒä¸ªhandlerä½¿ç”¨çš„æ˜¯ defaultEventLoopGroupï¼Œå¹¶ä¸”ä¹Ÿæ˜¯è½®è¯¢ç»‘å®šæœºåˆ¶</p><p><img src="https://cdn.jsdelivr.net/gh/taozhang1029/static-repository@master/img/202404180053271.png" alt=""></p><h4 id="ğŸ’¡-handler-æ‰§è¡Œä¸­å¦‚ä½•æ¢çº¿ç¨‹-eventloopgroup-å¤„ç†" tabindex="-1"><a class="header-anchor" href="#ğŸ’¡-handler-æ‰§è¡Œä¸­å¦‚ä½•æ¢çº¿ç¨‹-eventloopgroup-å¤„ç†"><span>ğŸ’¡ handler æ‰§è¡Œä¸­å¦‚ä½•æ¢çº¿ç¨‹ï¼ˆEventLoopGroupï¼‰å¤„ç†ï¼Ÿ</span></a></h4><p>å…³é”®ä»£ç </p><span class="badge warning" style="vertical-align:middle;"><!--[-->io.netty.channel.AbstractChannelHandlerContext#invokeChannelRead()<!--]--></span><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">invokeChannelRead</span><span class="token punctuation">(</span><span class="token keyword">final</span> <span class="token class-name">AbstractChannelHandlerContext</span> next<span class="token punctuation">,</span> <span class="token class-name">Object</span> msg<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">final</span> <span class="token class-name">Object</span> m <span class="token operator">=</span> next<span class="token punctuation">.</span>pipeline<span class="token punctuation">.</span><span class="token function">touch</span><span class="token punctuation">(</span><span class="token class-name">ObjectUtil</span><span class="token punctuation">.</span><span class="token function">checkNotNull</span><span class="token punctuation">(</span>msg<span class="token punctuation">,</span> <span class="token string">&quot;msg&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> next<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">EventExecutor</span> executor <span class="token operator">=</span> next<span class="token punctuation">.</span><span class="token function">executor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// ä¸‹ä¸€ä¸ª handler çš„äº‹ä»¶å¾ªç¯æ˜¯å¦ä¸å½“å‰çš„äº‹ä»¶å¾ªç¯æ˜¯åŒä¸€ä¸ªçº¿ç¨‹</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>executor<span class="token punctuation">.</span><span class="token function">inEventLoop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// æ˜¯ï¼Œç›´æ¥è°ƒç”¨</span>
        next<span class="token punctuation">.</span><span class="token function">invokeChannelRead</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token comment">// ä¸æ˜¯ï¼Œå°†è¦æ‰§è¡Œçš„ä»£ç ä½œä¸ºä»»åŠ¡æäº¤ç»™ä¸‹ä¸€ä¸ªäº‹ä»¶å¾ªç¯å¤„ç†ï¼ˆæ¢äººï¼‰</span>
        executor<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Runnable</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                next<span class="token punctuation">.</span><span class="token function">invokeChannelRead</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>å¦‚æœä¸¤ä¸ª handler ç»‘å®šçš„æ˜¯åŒä¸€ä¸ªçº¿ç¨‹ï¼Œé‚£ä¹ˆå°±ç›´æ¥è°ƒç”¨</li><li>å¦åˆ™ï¼ŒæŠŠè¦è°ƒç”¨çš„ä»£ç å°è£…ä¸ºä¸€ä¸ªä»»åŠ¡å¯¹è±¡ï¼Œç”±ä¸‹ä¸€ä¸ª handler çš„çº¿ç¨‹æ¥è°ƒç”¨</li></ul><h3 id="_3ã€channel" tabindex="-1"><a class="header-anchor" href="#_3ã€channel"><span>3ã€Channel</span></a></h3><p>channel çš„ä¸»è¦ä½œç”¨</p><ul><li>close() å¯ä»¥ç”¨æ¥å…³é—­ channel</li><li>closeFuture() ç”¨æ¥å¤„ç† channel çš„å…³é—­ <ul><li>sync æ–¹æ³•ä½œç”¨æ˜¯åŒæ­¥ç­‰å¾… channel å…³é—­</li><li>è€Œ addListener æ–¹æ³•æ˜¯å¼‚æ­¥ç­‰å¾… channel å…³é—­</li></ul></li><li>pipeline() æ–¹æ³•æ·»åŠ å¤„ç†å™¨</li><li>write() æ–¹æ³•å°†æ•°æ®å†™å…¥</li><li>writeAndFlush() æ–¹æ³•å°†æ•°æ®å†™å…¥å¹¶åˆ·å‡º</li></ul><h4 id="channelfuture" tabindex="-1"><a class="header-anchor" href="#channelfuture"><span>ChannelFuture</span></a></h4><p>å°†ä¹‹å‰çš„å®¢æˆ·ç«¯ä»£ç æ‹†å¼€æ¥çœ‹</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code>
<span class="token annotation punctuation">@Slf4j</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">EventLoopClient</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
        <span class="token class-name">ChannelFuture</span> channelFuture <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Bootstrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">group</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">NioEventLoopGroup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token class-name">NioSocketChannel</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">handler</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ChannelInitializer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">NioSocketChannel</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token annotation punctuation">@Override</span>
                    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">initChannel</span><span class="token punctuation">(</span><span class="token class-name">NioSocketChannel</span> ch<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        ch<span class="token punctuation">.</span><span class="token function">pipeline</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">StringEncoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token string">&quot;127.0.0.1&quot;</span><span class="token punctuation">,</span> <span class="token number">8080</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 1</span>

        channelFuture<span class="token punctuation">.</span><span class="token function">sync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">writeAndFlush</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;: hello netty!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>1 å¤„è¿”å›çš„æ˜¯ ChannelFuture å¯¹è±¡ï¼Œå®ƒçš„ä½œç”¨æ˜¯åˆ©ç”¨ channel() æ–¹æ³•æ¥è·å– Channel å¯¹è±¡</p></blockquote><p><strong>æ³¨æ„</strong> connect æ–¹æ³•æ˜¯å¼‚æ­¥çš„ï¼Œæ„å‘³ç€ä¸ç­‰è¿æ¥å»ºç«‹ï¼Œæ–¹æ³•æ‰§è¡Œå°±è¿”å›äº†ã€‚å› æ­¤ channelFuture å¯¹è±¡ä¸­ä¸èƒ½ã€ç«‹åˆ»ã€‘è·å¾—åˆ°æ­£ç¡®çš„ Channel å¯¹è±¡</p><p><strong>éªŒè¯ä»£ç </strong></p><div class="code-group"><div class="code-group__nav" role="tablist"><button class="code-group__nav-tab code-group__nav-tab-active" role="tab" ariaselected="true">å®¢æˆ·ç«¯</button><button class="code-group__nav-tab" role="tab" ariaselected="false">æœåŠ¡ç«¯</button></div><!--[--><div class="code-group-item" role="tabpanel"><!--[--><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code>
<span class="token annotation punctuation">@Slf4j</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ChannelFutureClient</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">ChannelFuture</span> channelFuture <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Bootstrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">group</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">NioEventLoopGroup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token class-name">NioSocketChannel</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">handler</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ChannelInitializer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Channel</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token annotation punctuation">@Override</span>
                    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">initChannel</span><span class="token punctuation">(</span><span class="token class-name">Channel</span> ch<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        ch<span class="token punctuation">.</span><span class="token function">pipeline</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">StringEncoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token string">&quot;127.0.0.1&quot;</span><span class="token punctuation">,</span> <span class="token number">8080</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>channelFuture<span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 1</span>
        channelFuture<span class="token punctuation">.</span><span class="token function">sync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 2</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>channelFuture<span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 3</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><!--]--></div><div class="code-group-item" role="tabpanel"><!--[--><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>kingsley<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>c3</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>bootstrap<span class="token punctuation">.</span></span><span class="token class-name">ServerBootstrap</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>buffer<span class="token punctuation">.</span></span><span class="token class-name">ByteBuf</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span></span><span class="token class-name">ChannelHandlerContext</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span></span><span class="token class-name">ChannelInboundHandlerAdapter</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span></span><span class="token class-name">ChannelInitializer</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span>nio<span class="token punctuation">.</span></span><span class="token class-name">NioEventLoopGroup</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span>socket<span class="token punctuation">.</span>nio<span class="token punctuation">.</span></span><span class="token class-name">NioServerSocketChannel</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span>socket<span class="token punctuation">.</span>nio<span class="token punctuation">.</span></span><span class="token class-name">NioSocketChannel</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">lombok<span class="token punctuation">.</span>extern<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span></span><span class="token class-name">Slf4j</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>nio<span class="token punctuation">.</span>charset<span class="token punctuation">.</span></span><span class="token class-name">Charset</span></span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
 * <span class="token keyword">@author</span> kingsley
 * <span class="token keyword">@date</span> 2024/4/17 22:43
 */</span>
<span class="token annotation punctuation">@Slf4j</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">EventLoopServer</span> <span class="token punctuation">{</span>

    <span class="token doc-comment comment">/**
     * ä¸»ç¨‹åºå…¥å£ã€‚
     * ä½¿ç”¨ServerBootstrapå¯åŠ¨ä¸€ä¸ªæœåŠ¡å™¨ï¼Œé…ç½®ä½¿ç”¨NIOä¼ è¾“ï¼Œç»‘å®šåˆ°8080ç«¯å£ã€‚
     * å¯¹æ¯ä¸ªæ–°è¿æ¥ï¼Œä½¿ç”¨ChannelInitializeråˆå§‹åŒ–Channelï¼ŒåŠ å…¥è‡ªå®šä¹‰çš„ChannelInboundHandlerAdapterä»¥å¤„ç†å…¥ç«™äº‹ä»¶ã€‚
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">new</span> <span class="token class-name">ServerBootstrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// åˆ›å»ºServerBootstrapå®ä¾‹ï¼Œç”¨äºå¯åŠ¨æœåŠ¡å™¨</span>
                <span class="token punctuation">.</span><span class="token function">group</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">NioEventLoopGroup</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">NioEventLoopGroup</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// æŒ‡å®šä½¿ç”¨NIOäº‹ä»¶å¾ªç¯ç»„</span>
                <span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token class-name">NioServerSocketChannel</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span> <span class="token comment">// æŒ‡å®šä½¿ç”¨NIOæœåŠ¡å™¨å¥—æ¥å­—é€šé“</span>
                <span class="token punctuation">.</span><span class="token function">childHandler</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ChannelInitializer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">NioSocketChannel</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// å®šä¹‰å­é€šé“ï¼ˆå³æ¯ä¸ªæ–°è¿æ¥ï¼‰çš„åˆå§‹åŒ–å¤„ç†å™¨</span>
                    <span class="token annotation punctuation">@Override</span>
                    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">initChannel</span><span class="token punctuation">(</span><span class="token class-name">NioSocketChannel</span> ch<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
                        ch<span class="token punctuation">.</span><span class="token function">pipeline</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ChannelInboundHandlerAdapter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// å‘é€šé“å¤„ç†é“¾ä¸­æ·»åŠ è‡ªå®šä¹‰çš„å…¥ç«™äº‹ä»¶å¤„ç†å™¨</span>
                            <span class="token annotation punctuation">@Override</span>
                            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">channelRead</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">,</span> <span class="token class-name">Object</span> msg<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// å½“æœ‰æ•°æ®è¯»å–æ—¶</span>
                                <span class="token class-name">ByteBuf</span> buf <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">ByteBuf</span><span class="token punctuation">)</span> msg<span class="token punctuation">;</span> <span class="token comment">// å°†æ¥æ”¶åˆ°çš„æ¶ˆæ¯è½¬æ¢ä¸ºByteBufç±»å‹</span>
                                log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;receive: {}&quot;</span><span class="token punctuation">,</span> buf<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token class-name">Charset</span><span class="token punctuation">.</span><span class="token function">defaultCharset</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// æ‰“å°æ¥æ”¶åˆ°çš„æ•°æ®</span>
                            <span class="token punctuation">}</span>
                        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token number">8080</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ç»‘å®šåˆ°8080ç«¯å£å¹¶å¯åŠ¨æœåŠ¡å™¨</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><!--]--></div><!--]--></div><p>å®¢æˆ·ç«¯æ—¥å¿—</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token number">2024</span>-04-19 00:07:32.827 INFO  <span class="token punctuation">[</span>main<span class="token punctuation">]</span> com.kingsley.netty.c4.ChannelFutureClient         <span class="token builtin class-name">:</span> <span class="token punctuation">[</span>id: 0xc8b9a39e<span class="token punctuation">]</span>
<span class="token number">2024</span>-04-19 00:07:32.839 INFO  <span class="token punctuation">[</span>main<span class="token punctuation">]</span> com.kingsley.netty.c4.ChannelFutureClient         <span class="token builtin class-name">:</span> <span class="token punctuation">[</span>id: 0xc8b9a39e, L:/127.0.0.1:52991 - R:/127.0.0.1:8080<span class="token punctuation">]</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>æ‰§è¡Œåˆ° 1 æ—¶ï¼Œè¿æ¥æœªå»ºç«‹ï¼Œæ‰“å° [id: 0xc8b9a39e]</li><li>æ‰§è¡Œåˆ° 2 æ—¶ï¼Œsync æ–¹æ³•æ˜¯åŒæ­¥ç­‰å¾…è¿æ¥å»ºç«‹å®Œæˆ</li><li>æ‰§è¡Œåˆ° 3 æ—¶ï¼Œè¿æ¥è‚¯å®šå»ºç«‹äº†ï¼Œæ‰“å° [id: 0xc8b9a39e, L:/127.0.0.1:52991 - R:/127.0.0.1:8080]</li></ul><p>é™¤äº†å¯ä»¥ç”¨ sync æ–¹æ³•å¾—åˆ°æœ‰æ•ˆçš„Channelä»¥å¤–ï¼Œè¿˜å¯ä»¥ä½¿ç”¨å›è°ƒçš„æ–¹å¼</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * <span class="token keyword">@author</span> kingsley
 * <span class="token keyword">@date</span> 2024/4/18 23:55
 */</span>
<span class="token annotation punctuation">@Slf4j</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ChannelFutureClient</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
        <span class="token class-name">ChannelFuture</span> channelFuture <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Bootstrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">group</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">NioEventLoopGroup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token class-name">NioSocketChannel</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">handler</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ChannelInitializer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">NioSocketChannel</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token annotation punctuation">@Override</span>
                    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">initChannel</span><span class="token punctuation">(</span><span class="token class-name">NioSocketChannel</span> ch<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        ch<span class="token punctuation">.</span><span class="token function">pipeline</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">StringEncoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token string">&quot;127.0.0.1&quot;</span><span class="token punctuation">,</span> <span class="token number">8080</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 1ã€åŒæ­¥é˜»å¡æ–¹å¼è·å–Channel</span>
        <span class="token comment">// log.info(&quot;{}&quot;, channelFuture.channel()); // 1</span>
        <span class="token comment">// channelFuture.sync(); // 2</span>
        <span class="token comment">// log.info(&quot;{}&quot;, channelFuture.channel()); // 3</span>

        <span class="token comment">// 2ã€å¼‚æ­¥éé˜»å¡æ–¹å¼è·å–Channel</span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;{}&quot;</span><span class="token punctuation">,</span> channelFuture<span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 1</span>
        channelFuture<span class="token punctuation">.</span><span class="token function">addListener</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">ChannelFutureListener</span><span class="token punctuation">)</span> future <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token comment">// 1ã€è·å–åˆ°channel</span>
            <span class="token class-name">NioSocketChannel</span> channel <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">NioSocketChannel</span><span class="token punctuation">)</span> future<span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;addListener è·å–çš„Channelï¼š{}&quot;</span><span class="token punctuation">,</span> channel<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å®¢æˆ·ç«¯æ—¥å¿—è¾“å‡º</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token number">2024</span>-04-19 00:16:28.531 INFO  <span class="token punctuation">[</span>main<span class="token punctuation">]</span> com.kingsley.netty.c4.ChannelFutureClient         <span class="token builtin class-name">:</span> <span class="token punctuation">[</span>id: 0x2983cbbf<span class="token punctuation">]</span>
<span class="token number">2024</span>-04-19 00:16:28.612 INFO  <span class="token punctuation">[</span>nioEventLoopGroup-2-1<span class="token punctuation">]</span> com.kingsley.netty.c4.ChannelFutureClient         <span class="token builtin class-name">:</span> addListener è·å–çš„Channelï¼š<span class="token punctuation">[</span>id: 0x2983cbbf, L:/127.0.0.1:53256 - R:/127.0.0.1:8080<span class="token punctuation">]</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>æ‰§è¡Œåˆ° 1 æ—¶ï¼Œè¿æ¥æœªå»ºç«‹ï¼Œæ‰“å° [id: 0x2983cbbf]</li><li>ChannelFutureListener ä¼šåœ¨è¿æ¥å»ºç«‹æ—¶è¢«è°ƒç”¨ï¼ˆå…¶ä¸­ operationComplete æ–¹æ³•ï¼‰ï¼Œå› æ­¤æ‰§è¡Œåˆ° 2 æ—¶ï¼Œè¿æ¥è‚¯å®šå»ºç«‹äº†ï¼Œæ‰“å° [id: 0x2983cbbf, L:/127.0.0.1:53256 - R:/127.0.0.1:8080]</li></ul><p>è§‚å¯Ÿæ—¥å¿—çš„loggeréƒ¨åˆ†å¯ä»¥å‘ç°ï¼šåŒæ­¥é˜»å¡æ–¹å¼æ˜¯åœ¨<strong>ä¸»çº¿ç¨‹</strong>ä¸­è·å–çš„Channelï¼Œå¼‚æ­¥éé˜»å¡æ–¹å¼æ˜¯åœ¨ <strong>nioEventLoopGroup-2-1</strong> çº¿ç¨‹ä¸­è·å–çš„Channelã€‚</p><h4 id="closefuture" tabindex="-1"><a class="header-anchor" href="#closefuture"><span>CloseFuture</span></a></h4><p>æˆ‘ä»¬å¯ä»¥é€šè¿‡ ChannelFuture æ¥åšä¸€äº›èµ„æºé‡Šæ”¾æ“ä½œï¼Œä¾‹å¦‚å…³é—­ Channelã€å…³é—­ EventLoopGroup ç­‰ã€‚</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code>
<span class="token annotation punctuation">@Slf4j</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CloseFutureClient</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
        <span class="token class-name">NioEventLoopGroup</span> group <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">NioEventLoopGroup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">ChannelFuture</span> channelFuture <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Bootstrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">group</span><span class="token punctuation">(</span>group<span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token class-name">NioSocketChannel</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">handler</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ChannelInitializer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">NioSocketChannel</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token annotation punctuation">@Override</span> <span class="token comment">// åœ¨è¿æ¥å»ºç«‹åè¢«è°ƒç”¨</span>
                    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">initChannel</span><span class="token punctuation">(</span><span class="token class-name">NioSocketChannel</span> ch<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
                        ch<span class="token punctuation">.</span><span class="token function">pipeline</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">LoggingHandler</span><span class="token punctuation">(</span><span class="token class-name">LogLevel</span><span class="token punctuation">.</span><span class="token constant">DEBUG</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        ch<span class="token punctuation">.</span><span class="token function">pipeline</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">StringEncoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">InetSocketAddress</span><span class="token punctuation">(</span><span class="token string">&quot;localhost&quot;</span><span class="token punctuation">,</span> <span class="token number">8080</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Channel</span> channel <span class="token operator">=</span> channelFuture<span class="token punctuation">.</span><span class="token function">sync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;{}&quot;</span><span class="token punctuation">,</span> channel<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token class-name">Scanner</span> scanner <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Scanner</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">String</span> line <span class="token operator">=</span> scanner<span class="token punctuation">.</span><span class="token function">nextLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">&quot;q&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>line<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    channel<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// close å¼‚æ­¥æ“ä½œ</span>
                    <span class="token comment">// log.debug(&quot;å¤„ç†å…³é—­ä¹‹åçš„æ“ä½œ&quot;); // ä¸èƒ½åœ¨è¿™é‡Œå–„å</span>
                    <span class="token keyword">break</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                channel<span class="token punctuation">.</span><span class="token function">writeAndFlush</span><span class="token punctuation">(</span>line<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&quot;input&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// è·å– CloseFuture å¯¹è±¡ï¼Œ 1) åŒæ­¥å¤„ç†å…³é—­ï¼Œ 2) å¼‚æ­¥å¤„ç†å…³é—­</span>
        <span class="token class-name">ChannelFuture</span> closeFuture <span class="token operator">=</span> channel<span class="token punctuation">.</span><span class="token function">closeFuture</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">/*log.debug(&quot;waiting close...&quot;);
        closeFuture.sync();
        log.debug(&quot;å¤„ç†å…³é—­ä¹‹åçš„æ“ä½œ&quot;);*/</span>
        closeFuture<span class="token punctuation">.</span><span class="token function">addListener</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ChannelFutureListener</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">operationComplete</span><span class="token punctuation">(</span><span class="token class-name">ChannelFuture</span> future<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
                log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;å¤„ç†å…³é—­ä¹‹åçš„æ“ä½œ&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                group<span class="token punctuation">.</span><span class="token function">shutdownGracefully</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="ğŸ’¡-å¼‚æ­¥æå‡çš„æ˜¯ä»€ä¹ˆ" tabindex="-1"><a class="header-anchor" href="#ğŸ’¡-å¼‚æ­¥æå‡çš„æ˜¯ä»€ä¹ˆ"><span>ğŸ’¡ å¼‚æ­¥æå‡çš„æ˜¯ä»€ä¹ˆ</span></a></h4><ul><li>çœ‹åˆ°è¿™é‡Œå¯èƒ½ä¼šæœ‰ç–‘é—®ï¼šä¸ºä»€ä¹ˆä¸åœ¨ä¸€ä¸ªçº¿ç¨‹ä¸­å»æ‰§è¡Œå»ºç«‹è¿æ¥ã€å…³é—­ channelï¼Œé‚£æ ·ä¸æ˜¯ä¹Ÿå¯ä»¥å—ï¼Ÿéè¦ç”¨è¿™ä¹ˆå¤æ‚çš„å¼‚æ­¥æ–¹å¼ï¼šæ¯”å¦‚ä¸€ä¸ªçº¿ç¨‹å‘èµ·å»ºç«‹è¿æ¥ï¼Œå¦ä¸€ä¸ªçº¿ç¨‹å»çœŸæ­£å»ºç«‹è¿æ¥</li><li>è¿˜æœ‰ä¸€ç§çœ‹æ³•ï¼šnetty å¼‚æ­¥æ–¹å¼å› ä¸ºç”¨äº†å¤šçº¿ç¨‹æ•ˆç‡å°±é«˜ã€‚å…¶å®è¿™ç§è®¤è¯†æ¯”è¾ƒç‰‡é¢ï¼Œå¤šçº¿ç¨‹å’Œå¼‚æ­¥æ‰€æå‡çš„æ•ˆç‡å¹¶ä¸æ˜¯æ‰€è®¤ä¸ºçš„ã€‚</li></ul><p>æ€è€ƒä¸‹é¢çš„åœºæ™¯ï¼Œ4 ä¸ªåŒ»ç”Ÿç»™äººçœ‹ç—…ï¼Œæ¯ä¸ªç—…äººèŠ±è´¹ 20 åˆ†é’Ÿï¼Œè€Œä¸”åŒ»ç”Ÿçœ‹ç—…çš„è¿‡ç¨‹ä¸­æ˜¯ä»¥ç—…äººä¸ºå•ä½çš„ï¼Œä¸€ä¸ªç—…äººçœ‹å®Œäº†ï¼Œæ‰èƒ½çœ‹ä¸‹ä¸€ä¸ªç—…äººã€‚å‡è®¾ç—…äººæºæºä¸æ–­åœ°æ¥ï¼Œå¯ä»¥è®¡ç®—ä¸€ä¸‹ 4 ä¸ªåŒ»ç”Ÿä¸€å¤©å·¥ä½œ 8 å°æ—¶ï¼Œå¤„ç†çš„ç—…äººæ€»æ•°æ˜¯ï¼š <span class="highlight">4 * 8 * (60 / 20) = 96</span></p><p><img src="https://cdn.jsdelivr.net/gh/taozhang1029/static-repository@master/img/202404190034608.png" alt="ç¤ºæ„å›¾"></p><p>ç»ç ”ç©¶å‘ç°ï¼Œçœ‹ç—…å¯ä»¥ç»†åˆ†ä¸ºå››ä¸ªæ­¥éª¤ï¼Œå¦‚ä¸‹</p><p><img src="https://cdn.jsdelivr.net/gh/taozhang1029/static-repository@master/img/202404190036993.png" alt="å››ä¸ªæ­¥éª¤"></p><p>å‡è®¾ç»æ‹†åˆ†åæ¯ä¸ªæ­¥éª¤éœ€è¦ 5 åˆ†é’Ÿï¼Œå¯ä»¥åšå¦‚ä¸‹ä¼˜åŒ–</p><p><img src="https://cdn.jsdelivr.net/gh/taozhang1029/static-repository@master/img/202404190040867.png" alt=""></p><p>åªæœ‰ä¸€å¼€å§‹ï¼ŒåŒ»ç”Ÿ 2ã€3ã€4 åˆ†åˆ«è¦ç­‰å¾… 5ã€10ã€15 åˆ†é’Ÿæ‰èƒ½æ‰§è¡Œå·¥ä½œï¼Œä½†åªè¦åç»­ç—…äººæºæºä¸æ–­åœ°æ¥ï¼Œä»–ä»¬å°±èƒ½å¤Ÿæ»¡è´Ÿè·å·¥ä½œï¼Œå¹¶ä¸”å¤„ç†ç—…äººçš„èƒ½åŠ›æé«˜åˆ°äº†<span class="highlight">4 * 8 * (60 / 5) = 384</span>ï¼Œæ•ˆç‡å‡ ä¹æ˜¯åŸæ¥çš„å››å€ã€‚</p><blockquote><p>è¿™ç§æ–¹æ¡ˆå¹¶æ²¡æœ‰å‡å°‘æ¯ä½ç—…äººçš„çœ‹ç—…æ—¶é—´ï¼Œåè€Œç”šè‡³æœ‰æ‰€å¢åŠ ã€‚ä½†å¯¹äºæ•´ä¸ªæµç¨‹ï¼ˆç³»ç»Ÿï¼‰è€Œè¨€æé«˜äº†ååé‡ï¼Œå³å•ä½æ—¶é—´å†…å¤„ç†çš„äº‹ä»¶æ•°é‡</p></blockquote><p>è¦ç‚¹</p><ul><li>å•çº¿ç¨‹æ²¡æ³•å¼‚æ­¥æé«˜æ•ˆç‡ï¼Œå¿…é¡»é…åˆå¤šçº¿ç¨‹ã€å¤šæ ¸ cpu æ‰èƒ½å‘æŒ¥å¼‚æ­¥çš„ä¼˜åŠ¿</li><li>å¼‚æ­¥å¹¶æ²¡æœ‰ç¼©çŸ­å“åº”æ—¶é—´ï¼Œåè€Œæœ‰æ‰€å¢åŠ </li><li>åˆç†è¿›è¡Œä»»åŠ¡æ‹†åˆ†ï¼Œä¹Ÿæ˜¯åˆ©ç”¨å¼‚æ­¥çš„å…³é”®</li></ul><h3 id="_4ã€future-promise" tabindex="-1"><a class="header-anchor" href="#_4ã€future-promise"><span>4ã€Future &amp; Promise</span></a></h3><p>åœ¨å¼‚æ­¥å¤„ç†æ—¶ç»å¸¸ç”¨åˆ°è¿™ä¸¤ä¸ªæ¥å£ï¼Œé¦–å…ˆè¦è¯´æ˜ Netty ä¸­çš„ Future ä¸ JDK ä¸­çš„ Future åŒåï¼Œä½†æ˜¯æ˜¯ä¸¤ä¸ªæ¥å£ã€‚Netty çš„ Future ç»§æ‰¿è‡ª JDK çš„ Futureï¼Œè€Œ Promise åˆå¯¹ Netty Future è¿›è¡Œäº†æ‰©å±•ã€‚</p><ul><li>JDK Future åªèƒ½åŒæ­¥ç­‰å¾…ä»»åŠ¡ç»“æŸï¼ˆæˆ–æˆåŠŸã€æˆ–å¤±è´¥ï¼‰æ‰èƒ½å¾—åˆ°ç»“æœ</li><li>Netty Future å¯ä»¥åŒæ­¥ç­‰å¾…ä»»åŠ¡ç»“æŸå¾—åˆ°ç»“æœï¼Œä¹Ÿå¯ä»¥å¼‚æ­¥æ–¹å¼å¾—åˆ°ç»“æœï¼Œä½†éƒ½æ˜¯è¦ç­‰ä»»åŠ¡ç»“æŸ</li><li>Netty Promise ä¸ä»…æœ‰ Netty Future çš„åŠŸèƒ½ï¼Œè€Œä¸”è„±ç¦»äº†ä»»åŠ¡ç‹¬ç«‹å­˜åœ¨ï¼Œåªä½œä¸ºä¸¤ä¸ªçº¿ç¨‹é—´ä¼ é€’ç»“æœçš„å®¹å™¨</li></ul><table><thead><tr><th>åŠŸèƒ½/åç§°</th><th>JDK Future</th><th>Netty Future</th><th>Promise</th></tr></thead><tbody><tr><td>cancel</td><td>å–æ¶ˆä»»åŠ¡</td><td>-</td><td>-</td></tr><tr><td>isCanceled</td><td>ä»»åŠ¡æ˜¯å¦å–æ¶ˆ</td><td>-</td><td>-</td></tr><tr><td>isDone</td><td>ä»»åŠ¡æ˜¯å¦å®Œæˆï¼Œä¸èƒ½åŒºåˆ†æˆåŠŸå¤±è´¥</td><td>-</td><td>-</td></tr><tr><td>get</td><td>è·å–ä»»åŠ¡ç»“æœï¼Œé˜»å¡ç­‰å¾…</td><td>-</td><td>-</td></tr><tr><td>getNow</td><td>-</td><td>è·å–ä»»åŠ¡ç»“æœï¼Œéé˜»å¡ï¼Œè¿˜æœªäº§ç”Ÿç»“æœæ—¶è¿”å› null</td><td>-</td></tr><tr><td>await</td><td>-</td><td>ç­‰å¾…ä»»åŠ¡ç»“æŸï¼Œå¦‚æœä»»åŠ¡å¤±è´¥ï¼Œä¸ä¼šæŠ›å¼‚å¸¸ï¼Œè€Œæ˜¯é€šè¿‡ isSuccess åˆ¤æ–­</td><td>-</td></tr><tr><td>sync</td><td>-</td><td>ç­‰å¾…ä»»åŠ¡ç»“æŸï¼Œå¦‚æœä»»åŠ¡å¤±è´¥ï¼ŒæŠ›å‡ºå¼‚å¸¸</td><td>-</td></tr><tr><td>isSuccess</td><td>-</td><td>åˆ¤æ–­ä»»åŠ¡æ˜¯å¦æˆåŠŸ</td><td>-</td></tr><tr><td>cause</td><td>-</td><td>è·å–å¤±è´¥ä¿¡æ¯ï¼Œéé˜»å¡ï¼Œå¦‚æœæ²¡æœ‰å¤±è´¥ï¼Œè¿”å›null</td><td>-</td></tr><tr><td>addListener</td><td>-</td><td>æ·»åŠ å›è°ƒï¼Œå¼‚æ­¥æ¥æ”¶ç»“æœ</td><td>-</td></tr><tr><td>setSuccess</td><td>-</td><td>-</td><td>è®¾ç½®æˆåŠŸç»“æœ</td></tr><tr><td>setFailure</td><td>-</td><td>-</td><td>è®¾ç½®å¤±è´¥ç»“æœ</td></tr></tbody></table><h4 id="ä¾‹1" tabindex="-1"><a class="header-anchor" href="#ä¾‹1"><span>ä¾‹1</span></a></h4><p>åŒæ­¥å¤„ç†ä»»åŠ¡æˆåŠŸ</p></div><!--[--><!--]--></div><footer class="page-meta"><!----><div class="meta-item last-updated"><span class="meta-item-label">æœ€åæ›´æ–°äº: </span><!----></div><!----></footer><nav class="page-nav" aria-label="page navigation"><p class="inner"><span class="prev"><a class="route-link" href="/blog/back-end/netty/01-NIO%E5%9F%BA%E7%A1%80.html" aria-label="NIOåŸºç¡€"><!--[--><!--]--> NIOåŸºç¡€ <!--[--><!--]--></a></span><!----></p></nav><!--[--><!--[--><div id="comment" class="giscus-wrapper input-top" style="display:block;"><div class="loading-icon-wrapper" style="display:flex;align-items:center;justify-content:center;height:96px"><svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" preserveAspectRatio="xMidYMid" viewBox="25 25 50 50"><animateTransform attributeName="transform" type="rotate" dur="2s" keyTimes="0;1" repeatCount="indefinite" values="0;360"></animateTransform><circle cx="50" cy="50" r="20" fill="none" stroke="currentColor" stroke-width="4" stroke-linecap="round"><animate attributeName="stroke-dasharray" dur="1.5s" keyTimes="0;0.5;1" repeatCount="indefinite" values="1,200;90,200;1,200"></animate><animate attributeName="stroke-dashoffset" dur="1.5s" keyTimes="0;0.5;1" repeatCount="indefinite" values="0;-35px;-125px"></animate></circle></svg></div></div><!--]--><!--]--></main><!--]--></div><!--[--><!----><!--]--><!--]--></div>
    <script type="module" src="/blog/assets/app-C8q1F3U4.js" defer></script>
  </body>
</html>
